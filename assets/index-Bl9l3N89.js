(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}})();class z{static async hashPassword(e){const t=new TextEncoder().encode(e+"salt_cloud_notes_2026"),i=await crypto.subtle.digest("SHA-512",t);return Array.from(new Uint8Array(i)).map(r=>r.toString(16).padStart(2,"0")).join("")}static async deriveKey(e,o){const t=new TextEncoder,i=await crypto.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode(o),iterations:25e4,hash:"SHA-512"},i,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}static async encrypt(e,o){try{const t=crypto.getRandomValues(new Uint8Array(16)),i=crypto.getRandomValues(new Uint8Array(12)),a=await this.deriveKey(o,this.bufToHex(t)),r=new TextEncoder,s=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},a,r.encode(typeof e=="string"?e:JSON.stringify(e)));return{payload:this.bufToHex(new Uint8Array(s)),iv:this.bufToHex(i),salt:this.bufToHex(t)}}catch(t){throw console.error("Encryption failed",t),t}}static async decrypt(e,o){try{const{payload:t,iv:i,salt:a}=e,r=await this.deriveKey(o,a),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:this.hexToBuf(i)},r,this.hexToBuf(t)),d=new TextDecoder().decode(s);try{return JSON.parse(d)}catch{return d}}catch(t){throw console.error("Decryption failed. Wrong password?",t),t}}static bufToHex(e){return Array.from(new Uint8Array(e)).map(o=>o.toString(16).padStart(2,"0")).join("")}static hexToBuf(e){return new Uint8Array(e.match(/.{1,2}/g).map(o=>parseInt(o,16)))}}const f={notes:[],categories:[],settings:{theme:"dark",drivePath:"/backup/notes/",algo:"aes-256-gcm"},currentView:"all",editingNoteId:null,unlockedNotes:new Set,unlockedCategories:new Set,gapiLoaded:!1,tokenClient:null};async function V(){const n=sessionStorage.getItem("cn_pass_plain_v3");if(n){const e=await z.encrypt(f.notes,n),o=await z.encrypt(f.categories,n);localStorage.setItem("cn_notes_v3_enc",JSON.stringify(e)),localStorage.setItem("cn_categories_v3_enc",JSON.stringify(o)),localStorage.removeItem("cn_notes_v3"),localStorage.removeItem("cn_categories_v3")}localStorage.setItem("cn_settings_v3",JSON.stringify(f.settings))}async function Zt(n){try{const e=localStorage.getItem("cn_notes_v3_enc"),o=localStorage.getItem("cn_categories_v3_enc");if(e)f.notes=await z.decrypt(JSON.parse(e),n);else{const t=localStorage.getItem("cn_notes_v3");t&&(f.notes=JSON.parse(t))}if(o)f.categories=await z.decrypt(JSON.parse(o),n);else{const t=localStorage.getItem("cn_categories_v3");t&&(f.categories=JSON.parse(t))}}catch(e){throw console.error("Failed to load encrypted data",e),e}}function In(){const n=localStorage.getItem("cn_settings_v3");n&&(f.settings={...f.settings,...JSON.parse(n)})}const Ne="v3.6.19",Ue=[{id:"default",light:"#ffffff",dark:"#09090b"},{id:"red",light:"#fef2f2",dark:"#450a0a"},{id:"orange",light:"#fff7ed",dark:"#431407"},{id:"yellow",light:"#fefce8",dark:"#422006"},{id:"green",light:"#f0fdf4",dark:"#064e3b"},{id:"teal",light:"#f0fdfa",dark:"#134e4a"},{id:"blue",light:"#eff6ff",dark:"#1e3a8a"},{id:"darkblue",light:"#eef2ff",dark:"#1e1b4b"},{id:"purple",light:"#faf5ff",dark:"#3b0764"},{id:"pink",light:"#fdf2f8",dark:"#500724"},{id:"brown",light:"#fffaf5",dark:"#2d1a10"},{id:"gray",light:"#f8fafc",dark:"#0f172a"}],_n=["#ffffff","#f28b82","#fbbc04","#fff475","#ccff90","#a7ffeb","#cbf0f8","#aecbfa","#d7aefb","#fdcfe8","#e6c9a8","#e8eaed","#1e293b","#450a0a","#422006","#064e3b","#134e4a","#1e3a8a","#1e1b4b","#4c1d95","#500724","#27272a","#09090b","#000000"],Cn=["üòä","üòÇ","ü•∞","üòé","ü§î","üò¥","üî•","‚ú®","üöÄ","üéâ","‚ù§Ô∏è","üëç","üí°","üìÖ","‚úÖ","‚ùå","üîí","üîë","üìå","üé®","üìÅ","üè†","üåü","üåç","üíª","üì±","üçé","üçï","üç∫","üåà","‚òÄÔ∏è","üåô","‚ö°","üíé","üéÅ","üéà","üéµ","üì∑","üîç","üõ∏","üëæ","ü§ñ","üëª","ü¶Ñ","üêæ","üèÄ","‚öΩ","üöó","‚úàÔ∏è","üïπÔ∏è","üéÆ","üé≤","üß©","üé≠","üé¨","üé§","üéß","üéπ","üé∏","üéª","üé∫","üé∑","ü•Å","üèπ","üé£","üöµ","üßó","üßò","üõÅ","üõå","üóùÔ∏è","üõ°Ô∏è","‚öîÔ∏è","üó∫Ô∏è","üïØÔ∏è","‚åõ","‚öñÔ∏è","‚öôÔ∏è","‚öíÔ∏è","üõ†Ô∏è","‚õèÔ∏è","‚õìÔ∏è","üî≠","üî¨","üíä","üíâ","üß¨","ü©∏","üß™","üå°Ô∏è","üß¥","üßπ","üß∫","üßº","üßΩ","ü™£","ü™í","üßª","üõÄ","üöø","üöΩ"],Tn=["tag","briefcase","home","user","heart","star","shopping-cart","book","code","coffee","graduation-cap","music","camera","plane","bike","gift","bell","calendar","map-pin","search","folder","database","globe","terminal","cpu","layers","layout","activity","archive","award","bar-chart","bookmark","box","briefcase","check-circle","clock","cloud","compass","edit","external-link","eye","file-text","flag","folder-open","image","info","key","life-buoy","link","list","mail","message-circle","mic","monitor","moon","mouse-pointer","package","paperclip","phone","pie-chart","play","plus","printer","save","send","settings","share-2","shield","shopping-bag","slack","smartphone","speaker","sun","tablet","target","tool","truck","tv","umbrella","video","watch","wifi","zap"];function I(n,e=3e3){const o=document.getElementById("toast");o&&(o.querySelector("div").innerText=n,o.classList.add("show"),setTimeout(()=>o.classList.remove("show"),e))}function oe(n,e,o=!0){return new Promise(t=>{const i=document.getElementById("prompt-modal"),a=document.getElementById("prompt-input");if(!i||!a)return t(null);document.getElementById("prompt-title").innerText=n,document.getElementById("prompt-desc").innerText=e,a.type=o?"password":"text",a.value="",i.classList.remove("hidden"),$(),a.focus();const r=()=>{i.classList.add("hidden"),window.removeEventListener("keydown",s)},s=u=>{u.key==="Enter"&&l(),u.key==="Escape"&&d()};window.addEventListener("keydown",s);const l=()=>{const u=a.value;r(),t(u)},d=()=>{r(),t(null)};document.getElementById("prompt-confirm").onclick=l,document.getElementById("prompt-cancel").onclick=d})}function Dn(n){if(!n)return!0;const e=n.replace("#",""),o=parseInt(e.substr(0,2),16),t=parseInt(e.substr(2,2),16),i=parseInt(e.substr(4,2),16);return isNaN(o)||isNaN(t)||isNaN(i)?!0:(o*299+t*587+i*114)/1e3<128}function $(){typeof lucide<"u"&&lucide.createIcons&&lucide.createIcons()}class Qt{constructor(e="chunk_",o="/backup/notes/"){this.basePath=o,this.dbPrefix=e,this.chunkSizeLimit=100*1024}async getOrCreateFolder(e){const o=e.split("/").filter(i=>i);let t="root";for(const i of o){const a=`name = '${i}' and mimeType = 'application/vnd.google-apps.folder' and '${t}' in parents and trashed = false`,s=(await gapi.client.drive.files.list({q:a,fields:"files(id, name)"})).result.files;if(s.length>0)t=s[0].id;else{const l={name:i,mimeType:"application/vnd.google-apps.folder",parents:[t]};t=(await gapi.client.drive.files.create({resource:l,fields:"id"})).result.id}}return t}async saveChunks(e,o){const t=JSON.stringify(e),i=[];for(let a=0;a<t.length;a+=this.chunkSizeLimit)i.push(t.substring(a,a+this.chunkSizeLimit));for(let a=0;a<i.length;a++){const r=`${this.dbPrefix}${a}.json`;await this.uploadFile(r,i[a],o)}return i.length}async uploadFile(e,o,t){const i=`name = '${e}' and '${t}' in parents and trashed = false`,r=(await gapi.client.drive.files.list({q:i,fields:"files(id)"})).result.files,s=r.length>0?r[0].id:null,l={name:e,parents:s?[]:[t]},d=new Blob([o],{type:"application/json"}),u=gapi.auth.getToken().access_token,c=s?"PATCH":"POST",g=s?`https://www.googleapis.com/upload/drive/v3/files/${s}?uploadType=media`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart";if(s)await fetch(g,{method:c,headers:{Authorization:`Bearer ${u}`},body:d});else{const h=new FormData;h.append("metadata",new Blob([JSON.stringify(l)],{type:"application/json"})),h.append("file",d),await fetch(g,{method:c,headers:{Authorization:`Bearer ${u}`},body:h})}}async loadChunks(e){const o=`name contains '${this.dbPrefix}' and '${e}' in parents and trashed = false`,i=(await gapi.client.drive.files.list({q:o,fields:"files(id, name)",orderBy:"name"})).result.files;let a="";for(const r of i){const s=await gapi.client.drive.files.get({fileId:r.id,alt:"media"});a+=typeof s.result=="string"?s.result:JSON.stringify(s.result)}return a?JSON.parse(a):null}}function Bn(){const n=!!(sessionStorage.getItem("cn_pass_plain_v3")||localStorage.getItem("cn_pass_plain_v3"));return`
    <div id="auth-shield" class="fixed inset-0 z-[100] flex items-center justify-center bg-background/95 backdrop-blur-sm transition-opacity duration-300 ${n?"opacity-0 pointer-events-none":""}" style="${n?"display: none":""}">
        <div class="w-full max-w-sm p-8 space-y-6 bg-card border rounded-lg shadow-lg">
            <div class="text-center space-y-2">
                <div class="mx-auto w-10 h-10 bg-primary rounded-md flex items-center justify-center text-primary-foreground">
                    <i data-lucide="lock" class="w-5 h-5"></i>
                </div>
                <h1 class="text-2xl font-semibold tracking-tight" id="auth-title">B√≥veda Protegida</h1>
                <p class="text-sm text-muted-foreground" id="auth-desc">Ingresa tu contrase√±a maestra para continuar</p>
            </div>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="password" id="master-password" placeholder="Tu contrase√±a" class="h-11 w-full pl-4 pr-12 text-base">
                    <button type="button" class="absolute right-0 top-0 h-11 w-11 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass" data-target="master-password">
                        <i data-lucide="eye" class="w-4 h-4 icon-show"></i>
                    </button>
                </div>
                <div class="relative group hidden" id="confirm-password-wrapper">
                    <input type="password" id="confirm-password" placeholder="Repite la contrase√±a" class="h-11 w-full pl-4 pr-12 text-base">
                    <button type="button" class="absolute right-0 top-0 h-11 w-11 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass" data-target="confirm-password">
                        <i data-lucide="eye" class="w-4 h-4 icon-show"></i>
                    </button>
                </div>
                
                <div class="flex items-center gap-2 py-1">
                    <input type="checkbox" id="auth-remember" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary">
                    <label for="auth-remember" class="text-xs text-muted-foreground cursor-pointer select-none">Recordar mi contrase√±a en este navegador</label>
                </div>

                <button id="auth-submit" class="btn-shad btn-shad-primary w-full h-11 font-bold">Desbloquear</button>
            </div>
        </div>
    </div>`}async function Ln(n){const e=document.getElementById("auth-shield"),o=!localStorage.getItem("cn_master_hash_v3"),t=sessionStorage.getItem("cn_pass_plain_v3");o?An():t?await z.hashPassword(t)===localStorage.getItem("cn_master_hash_v3")?(e.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>e.style.display="none",300),document.getElementById("app").classList.remove("opacity-0"),await Zt(t),n()):(sessionStorage.removeItem("cn_pass_plain_v3"),Ot()):Ot()}function An(){const n=document.getElementById("auth-title"),e=document.getElementById("auth-desc"),o=document.getElementById("confirm-password-wrapper"),t=document.getElementById("auth-submit");n&&(n.innerText="Configura tu B√≥veda"),e&&(e.innerText="Crea una contrase√±a maestra. Introduce la contrase√±a dos veces para asegurar que es correcta."),o&&o.classList.remove("hidden"),t&&(t.innerText="Crear mi B√≥veda",t.classList.remove("btn-shad-primary"),t.classList.add("btn-shad-success")),$()}function Ot(){const n=document.getElementById("auth-title"),e=document.getElementById("auth-desc"),o=document.getElementById("confirm-password-wrapper"),t=document.getElementById("auth-submit");n&&(n.innerText="B√≥veda Protegida"),e&&(e.innerText="Ingresa tu contrase√±a maestra para continuar"),o&&o.classList.add("hidden"),t&&(t.innerText="Desbloquear",t.classList.add("btn-shad-primary"),t.classList.remove("btn-shad-success")),$()}async function Mt(n){const e=document.getElementById("master-password").value,o=document.getElementById("confirm-password").value,t=!localStorage.getItem("cn_master_hash_v3");if(!e)return I("Ingresa una contrase√±a");if(t){if(!o)return I("Confirma tu contrase√±a");if(e!==o)return I("‚ö†Ô∏è ¬°Las contrase√±as no coinciden!");if(e.length<4)return I("La contrase√±a debe tener al menos 4 caracteres")}const i=await z.hashPassword(e),a=localStorage.getItem("cn_master_hash_v3"),r=document.getElementById("auth-remember").checked;if(!a)localStorage.setItem("cn_master_hash_v3",i),sessionStorage.setItem("cn_pass_plain_v3",e),r&&localStorage.setItem("cn_pass_plain_v3",e),I("‚úÖ B√≥veda creada con √©xito");else if(a===i)sessionStorage.setItem("cn_pass_plain_v3",e),r?localStorage.setItem("cn_pass_plain_v3",e):localStorage.removeItem("cn_pass_plain_v3"),I("B√≥veda abierta");else return I("‚ùå Contrase√±a incorrecta");const s=document.getElementById("auth-shield");s.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>s.style.display="none",300),document.getElementById("app").classList.remove("opacity-0"),await Zt(e),n()}function Nn(){return`
    <div id="app" class="flex h-screen overflow-hidden opacity-100 transition-opacity duration-300">
        <!-- Sidebar Desktop -->
        <aside class="w-64 hidden md:flex flex-col border-r bg-sidebar">
            <style>
                @keyframes logo-rainbow {
                    0% { color: #6366f1; filter: drop-shadow(0 0 2px #6366f1); }
                    33% { color: #ec4899; filter: drop-shadow(0 0 2px #ec4899); }
                    66% { color: #10b981; filter: drop-shadow(0 0 2px #10b981); }
                    100% { color: #6366f1; filter: drop-shadow(0 0 2px #6366f1); }
                }
                .logo-animate { animation: logo-rainbow 8s infinite linear; }
            </style>
            <div class="p-6 flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 overflow-hidden" id="sidebar-logo-container">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 p-2 flex items-center justify-center border border-primary/20 shadow-inner shrink-0">
                        <svg viewBox="0 0 24 24" fill="none" class="w-full h-full logo-animate" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                        </svg>
                    </div>
                    <div class="sidebar-title-text transition-opacity duration-300">
                        <h1 class="text-sm font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent truncate">Private Notes</h1>
                    </div>
                </div>
                <button id="sidebar-collapse-btn" class="p-2 hover:bg-accent rounded-md text-muted-foreground transition-all shrink-0" title="Contraer men√∫">
                    <i data-lucide="chevrons-left" class="w-4 h-4" id="sidebar-collapse-icon"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto px-4 space-y-8">
                <div class="space-y-1">
                    <button class="nav-link active w-full" data-view="all">
                        <i data-lucide="layout-grid" class="w-4 h-4"></i> <span class="sidebar-label text-foreground/90 font-bold">Todas las notas</span>
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center justify-between px-4" id="sidebar-categories-header">
                        <h3 class="sidebar-section-title text-[11px] font-bold text-muted-foreground uppercase tracking-wider">Etiquetas</h3>
                    </div>
                    <div id="sidebar-categories" class="space-y-1"></div>
                </div>
            </div>

            <div class="p-6 space-y-2 mt-auto">
                <button id="sidebar-manage-cats" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="tag" class="w-3.5 h-3.5"></i> <span class="sidebar-label">Gestionar Etiquetas</span>
                </button>
                <button id="settings-trigger" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="settings" class="w-3.5 h-3.5"></i> <span class="sidebar-label">Configuraci√≥n</span>
                </button>
                <button id="sidebar-pwa-install-btn" class="hidden nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="download" class="w-3.5 h-3.5"></i> <span class="sidebar-label">Instalar Aplicaci√≥n</span>
                </button>
                <div class="mt-auto pt-4 border-t border-border/20 px-4">
                    <div id="app-version" class="text-[9px] text-muted-foreground font-mono opacity-50">v3.6.0</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col bg-background relative overflow-hidden h-full">
            <!-- Desktop Header -->
            <header class="hidden md:flex h-16 items-center justify-between px-8 border-b shrink-0">
                <div class="flex items-center gap-4 flex-1">
                    <div class="relative w-full max-w-sm">
                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                        <input type="text" id="search-input" placeholder="Buscar notas..." class="pl-12 h-9 w-full" autocomplete="off">
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="sync-btn" class="p-2 hover:bg-accent rounded-md text-muted-foreground transition-colors" title="Sincronizar ahora">
                        <i data-lucide="refresh-cw" class="w-5 h-5" id="sync-icon"></i>
                    </button>
                    <button id="pwa-install-btn" class="hidden btn-shad btn-shad-outline h-9 px-3">
                        <i data-lucide="download" class="w-4 h-4 mr-2"></i> Instalar
                    </button>
                    <button id="add-note-btn" class="btn-shad btn-shad-primary h-9">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Nueva Nota
                    </button>
                </div>
            </header>

            <!-- Mobile Top Bar Removed -->

            <!-- Grid -->
            <div id="notes-viewport" class="flex-1 overflow-y-auto p-4 md:p-8 pb-24 md:pb-8">
                <div class="max-w-7xl mx-auto space-y-8">
                    <div class="flex items-end justify-between">
                        <div>
                            <h1 id="view-title" class="text-3xl font-bold tracking-tight">Todas las notas</h1>
                        </div>
                    </div>
                    <div id="notes-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                </div>
            </div>

            <!-- Mobile Bottom Nav -->
            <nav class="md:hidden fixed bottom-0 left-0 right-0 h-16 bg-background/95 backdrop-blur-2xl border-t flex items-center justify-around z-40 pb-safe">
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-sidebar-trigger-bottom">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors nav-link-mobile" data-view="all">
                    <i data-lucide="home" class="w-6 h-6"></i>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-content text-muted-foreground active:text-primary transition-colors relative" id="mobile-add-btn">
                    <div class="w-12 h-12 bg-primary text-primary-foreground rounded-full flex items-center justify-center shadow-lg hover:scale-105 transition-transform -translate-y-2">
                        <i data-lucide="plus" class="w-6 h-6"></i>
                    </div>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-sync-btn-bottom">
                    <i data-lucide="refresh-cw" class="w-6 h-6"></i>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-search-trigger">
                    <i data-lucide="search" class="w-6 h-6"></i>
                </button>
            </nav>
        </main>

        <!-- Mobile Sidebar Drawer -->
        <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-background/80 backdrop-blur-sm z-[100] hidden">
            <div id="mobile-sidebar-drawer" class="w-[80vw] h-full bg-card border-r flex flex-col animate-in slide-in-from-left duration-300">
                <div class="p-6 flex items-center justify-between border-b">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 p-2 flex items-center justify-center border border-primary/20 shadow-inner shrink-0">
                            <svg viewBox="0 0 24 24" fill="none" class="w-full h-full logo-animate" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                        </div>
                        <h1 class="text-sm font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent truncate">Private Notes</h1>
                    </div>
                    <button id="close-mobile-sidebar" class="p-2 hover:bg-accent rounded-md">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-8">
                    <div class="space-y-1">
                        <button class="nav-link-mobile-drawer active w-full" data-view="all">
                            <i data-lucide="layout-grid" class="w-4 h-4"></i> Todas las notas
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2" id="mobile-sidebar-categories-header">
                            <h3 class="sidebar-section-title">Etiquetas</h3>
                        </div>
                        <div id="mobile-sidebar-categories" class="space-y-1 px-2"></div>
                    </div>
                </div>
                <div class="p-6 border-t space-y-2">
                    <button id="mobile-pwa-install-btn" class="hidden flex items-center gap-3 w-full p-3 rounded-md bg-primary/10 text-primary text-sm font-bold border border-primary/20">
                        <i data-lucide="download" class="w-4 h-4"></i> Instalar Aplicaci√≥n
                    </button>
                    <button id="mobile-manage-cats" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="tag" class="w-4 h-4"></i> Gestionar Etiquetas
                    </button>
                    <button id="mobile-settings-btn" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="settings" class="w-4 h-4"></i> Configuraci√≥n
                    </button>
                    <div class="pt-4 border-t space-y-3">
                        <div class="flex items-center justify-between px-3">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground/50">Sistema</span>
                            <span class="text-[10px] font-bold font-mono px-2 py-0.5 rounded bg-primary/10 text-primary">v3.6.0</span>
                        </div>
                        <button id="mobile-force-reload-btn" class="flex items-center gap-3 w-full p-3 rounded-md bg-destructive/5 text-destructive text-sm font-medium border border-destructive/10">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i> Forzar Limpieza y Recarga
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>`}let St=null;function Pn(){return`
    <div id="editor-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-background/80 backdrop-blur-sm dialog-overlay"></div>
        <div class="dialog-content max-w-2xl h-[80vh] flex flex-col p-0">
            <div class="flex items-center gap-2 border-b pb-3 px-4 pt-4">
                <button id="close-editor" class="text-muted-foreground hover:text-foreground p-2 -ml-2" title="Volver">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <input type="text" id="edit-title" placeholder="T√≠tulo de la nota"
                    class="bg-transparent text-xl font-bold outline-none border-none placeholder:text-muted-foreground w-full">
                
                <div class="flex items-center gap-1">
                    <button id="toggle-fullscreen" class="hidden md:flex editor-tool" title="Modo Pantalla Completa">
                        <i data-lucide="maximize-2" class="w-4 h-4"></i>
                    </button>
                    <div class="relative">
                        <button id="note-options-btn" class="editor-tool" title="M√°s opciones">
                            <i data-lucide="more-vertical" class="w-5 h-5"></i>
                        </button>
                        <div id="note-options-menu" class="hidden absolute right-0 top-full mt-1 bg-popover border shadow-2xl rounded-xl p-1 z-[120] min-w-[160px]">
                            <button id="opt-copy-all" class="flex items-center gap-3 w-full px-3 py-2 text-sm hover:bg-accent rounded-md transition-colors">
                                <i data-lucide="copy" class="w-4 h-4"></i> Copiar todo
                            </button>
                            <button id="opt-download" class="flex items-center gap-3 w-full px-3 py-2 text-sm hover:bg-accent rounded-md transition-colors">
                                <i data-lucide="download" class="w-4 h-4"></i> Descargar .txt
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex-1 py-2 overflow-y-auto px-4">
                <div class="flex items-center gap-3 w-full md:w-auto mb-3">
                    <div class="editor-toolbar-container flex-1 justify-start md:flex-initial hidden md:flex items-center gap-1 p-1 border rounded-md bg-muted/30 w-fit shrink-0">
                        <button class="editor-tool" data-cmd="bold" title="Negrita (Ctrl+B)">
                            <i data-lucide="bold" class="w-4 h-4"></i>
                        </button>
                        <button class="editor-tool" data-cmd="italic" title="Cursiva (Ctrl+I)">
                            <i data-lucide="italic" class="w-4 h-4"></i>
                        </button>
                        <button class="editor-tool" data-cmd="underline" title="Subrayado (Ctrl+U)">
                            <i data-lucide="underline" class="w-4 h-4"></i>
                        </button>
                        <div class="w-px h-4 bg-border mx-1"></div>
                        <button class="editor-tool" data-cmd="insertUnorderedList" title="Lista de vi√±etas">
                            <i data-lucide="list" class="w-4 h-4"></i>
                        </button>
                        <button class="editor-tool" data-cmd="insertOrderedList" title="Lista numerada">
                            <i data-lucide="list-ordered" class="w-4 h-4"></i>
                        </button>
                        <button id="checklist-btn" class="editor-tool" title="Checklist">
                            <i data-lucide="check-square" class="w-4 h-4"></i>
                        </button>
                        <div class="w-px h-4 bg-border mx-1"></div>
                        <button id="add-link" class="editor-tool" title="Hiperv√≠nculo">
                            <i data-lucide="link" class="w-4 h-4"></i>
                        </button>
                        <button id="open-text-colors" class="editor-tool relative" title="Color de texto">
                            <div class="flex flex-col items-center">
                                <i data-lucide="type" class="w-4 h-4"></i>
                                <div class="w-3 h-[2px] bg-red-500 rounded-full -mt-0.5"></div>
                            </div>
                        </button>
                        <button id="open-emojis" class="editor-tool" title="Emojis"><i data-lucide="smile" class="w-4 h-4"></i></button>
                    </div>
                </div>

                <div id="edit-content" contenteditable="true"
                    class="min-h-[200px] md:min-h-[400px] outline-none text-base leading-relaxed prose prose-slate dark:prose-invert max-w-none"
                    placeholder="Empieza a escribir..."></div>
            </div>

            <div class="border-t py-3 px-4 flex items-center justify-between gap-2 editor-bottom-bar shrink-0">
                <div class="flex md:hidden items-center gap-1.5 flex-1 min-w-0 overflow-x-auto pb-1 no-scrollbar">
                         <!-- Mobile Toolbar -->
                        <button id="mobile-format-trigger" class="editor-tool border border-input bg-background/50 transition-all shrink-0" title="Formato">
                            <i data-lucide="type" class="w-4 h-4"></i>
                        </button>
                        <div id="mobile-tools-menu" class="hidden absolute left-0 bottom-full mb-3 bg-popover border shadow-2xl rounded-2xl p-1.5 z-[150] flex flex-col gap-1 min-w-[200px] animate-in slide-in-from-bottom-2 duration-200 overflow-hidden">
                            <button data-command="bold" class="flex items-center gap-3 w-full px-4 py-2.5 text-sm hover:bg-accent rounded-xl transition-colors font-medium"><i data-lucide="bold" class="w-4 h-4"></i> Negrita</button>
                            <button data-command="italic" class="flex items-center gap-3 w-full px-4 py-2.5 text-sm hover:bg-accent rounded-xl transition-colors font-medium"><i data-lucide="italic" class="w-4 h-4"></i> Cursiva</button>
                            <button data-command="underline" class="flex items-center gap-3 w-full px-4 py-2.5 text-sm hover:bg-accent rounded-xl transition-colors font-medium"><i data-lucide="underline" class="w-4 h-4"></i> Subrayado</button>
                            <div class="h-px bg-border my-1.5 mx-2"></div>
                            <button data-command="insertUnorderedList" class="flex items-center gap-3 w-full px-4 py-2.5 text-sm hover:bg-accent rounded-xl transition-colors font-medium"><i data-lucide="list" class="w-4 h-4"></i> Lista</button>
                            <button data-command="insertOrderedList" class="flex items-center gap-3 w-full px-4 py-2.5 text-sm hover:bg-accent rounded-xl transition-colors font-medium"><i data-lucide="list-ordered" class="w-4 h-4"></i> Numeraci√≥n</button>
                            <div class="h-px bg-border my-1.5 mx-2"></div>
                            <button id="mobile-link-btn" class="flex items-center gap-3 w-full px-4 py-2.5 text-sm hover:bg-accent rounded-xl transition-colors font-medium"><i data-lucide="link" class="w-4 h-4"></i> Enlace</button>
                        </div>

                        <div class="w-px h-6 bg-border mx-0.5"></div>

                        <button id="checklist-btn-mobile" class="editor-tool border border-input bg-background/50 transition-all shrink-0">
                            <i data-lucide="check-square" class="w-4 h-4"></i>
                        </button>
                        <button id="mobile-text-color-btn" class="editor-tool border border-input bg-background/50 transition-all shrink-0">
                            <i data-lucide="palette" class="w-4 h-4 text-red-500"></i>
                        </button>
                        
                         <div class="w-px h-6 bg-border mx-0.5"></div>

                        <button id="toggle-pin" class="editor-tool border border-input bg-background/50 transition-all shrink-0">
                            <i data-lucide="pin" class="w-4 h-4"></i>
                        </button>
                        <button id="toggle-lock" class="editor-tool border border-input bg-background/50 transition-all shrink-0">
                            <i data-lucide="lock" class="w-4 h-4"></i>
                        </button>
                        <button id="delete-note" class="editor-tool border border-destructive/20 bg-destructive/5 text-destructive hover:bg-destructive hover:text-white shrink-0 ml-auto" title="Eliminar nota">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                </div>

                <div class="hidden md:flex items-center gap-1.5 flex-1 min-w-0">
                    <button id="open-colors" class="editor-tool border border-input bg-background/50 transition-all shrink-0" title="Fondo">
                        <i data-lucide="palette" class="w-4 h-4"></i>
                    </button>

                    <div class="relative flex-1 min-w-0" id="cat-select-wrapper">
                        <button id="cat-dropdown-trigger"
                            class="h-9 w-full px-2 rounded-md border border-input bg-background/50 text-xs flex items-center justify-between gap-1 hover:bg-accent transition-all">
                            <i data-lucide="tag" id="selected-cat-icon" class="w-3.5 h-3.5 text-muted-foreground/60"></i>
                            <span id="selected-cat-label" class="truncate flex-1 text-left">Sin categor√≠a</span>
                            <i data-lucide="chevron-down" class="w-3 h-3 text-muted-foreground shrink-0"></i>
                        </button>
                        <div id="cat-dropdown-menu"
                            class="absolute bottom-full mb-2 left-0 w-48 bg-popover border rounded-md shadow-xl hidden z-50 py-1 overflow-hidden">
                        </div>
                        <select id="edit-category" class="hidden">
                            <option value="">Sin categor√≠a</option>
                        </select>
                    </div>
                </div>

                <div class="hidden md:flex gap-1.5 shrink-0">
                     <button id="delete-note-desktop" class="btn-shad bg-destructive/10 text-destructive hover:bg-destructive hover:text-white h-9 w-9 p-0" title="Eliminar nota">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                    <button id="save-note" class="btn-shad btn-shad-primary h-9 px-4 font-bold">Hecho</button>
                </div>
                
                <button id="save-note-mobile" class="md:hidden btn-shad btn-shad-primary h-9 px-3 font-bold ml-2">OK</button>
            </div>
        </div>
    </div>
    
    <!-- Popovers -->
    <div id="color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="bg-color-grid"></div>
    </div>
    <div id="text-color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="text-color-grid"></div>
    </div>
    <div id="emoji-popover" class="fixed z-[60] hidden popover-content w-80">
        <div class="grid grid-cols-8 gap-2 h-64 overflow-y-auto" id="emoji-grid"></div>
    </div>`}function On(n){const e=document.getElementById("editor-modal");document.getElementById("edit-title");const o=document.getElementById("edit-content"),t=document.getElementById("close-editor"),i=document.getElementById("save-note"),a=document.getElementById("delete-note");t.onclick=()=>me();const r=async()=>{await me(),n()};i.onclick=r;const s=document.getElementById("save-note-mobile");s&&(s.onclick=r);const l=async()=>{f.editingNoteId&&confirm("¬øEliminar esta nota?")&&(f.notes=f.notes.filter(b=>b.id!==f.editingNoteId),await V(),en(),n())};a&&(a.onclick=l);const d=document.getElementById("delete-note-desktop");d&&(d.onclick=l),document.querySelectorAll(".editor-tool[data-cmd]").forEach(b=>{b.dataset.cmd&&(b.onmousedown=k=>{k.preventDefault(),ve(),document.execCommand(b.dataset.cmd,!1,b.dataset.val||null),pe()})}),document.querySelectorAll("#mobile-tools-menu button[data-command]").forEach(b=>{b.onmousedown=k=>{k.preventDefault(),ve(),document.execCommand(b.dataset.command,!1,null),document.getElementById("mobile-tools-menu").classList.add("hidden"),pe()}}),Hn(),o.onkeyup=()=>{qe(),pe()},o.onmouseup=()=>{qe(),pe()},o.onfocus=()=>{qe(),pe()};const u=document.getElementById("edit-title");u.onfocus=()=>u.select(),u.onclick=()=>u.select(),document.getElementById("toggle-fullscreen").onclick=()=>{const k=document.getElementById("editor-modal").querySelector(".dialog-content"),B=k.classList.contains("fullscreen-mode"),O=document.getElementById("toggle-fullscreen"),A=O.querySelector("i");B?(k.classList.remove("fullscreen-mode"),A.setAttribute("data-lucide","maximize-2"),O.classList.remove("active")):(k.classList.add("fullscreen-mode"),A.setAttribute("data-lucide","minimize-2"),O.classList.add("active")),$()},document.getElementById("toggle-pin").onclick=()=>{const b=document.getElementById("toggle-pin").dataset.active==="true";tn(!b),me(!1)},document.getElementById("toggle-lock").onclick=async()=>{if(document.getElementById("toggle-lock").dataset.active==="true")kt(!1),f.tempEditorPassword=null,me(!1);else{const k=await oe("Proteger Nota","Crea una contrase√±a para esta nota:");k&&(f.tempEditorPassword=k,kt(!0),me(!1))}};const c=document.getElementById("checklist-btn-mobile");c&&(c.onclick=()=>M());const g=document.getElementById("mobile-format-trigger"),h=document.getElementById("mobile-tools-menu");g&&(g.onclick=b=>{b.preventDefault(),b.stopPropagation(),h.classList.toggle("hidden")}),document.getElementById("mobile-link-btn").onclick=()=>{D(),h.classList.add("hidden")},document.getElementById("mobile-text-color-btn").onclick=b=>{ve(),et(b,"text-color-popover"),h.classList.add("hidden")};const v=document.getElementById("note-options-btn"),m=document.getElementById("note-options-menu");v.onclick=b=>{b.stopPropagation(),m.classList.toggle("hidden")},document.getElementById("opt-copy-all").onclick=()=>{const b=document.getElementById("edit-content").innerText;navigator.clipboard.writeText(b).then(()=>{I("‚úÖ Contenido copiado"),m.classList.add("hidden")})},document.getElementById("opt-download").onclick=()=>{const b=document.getElementById("edit-title").value||"nota",k=document.getElementById("edit-content").innerText,B=new Blob([k],{type:"text/plain"}),O=URL.createObjectURL(B),A=document.createElement("a");A.href=O,A.download=`${b}.txt`,A.click(),m.classList.add("hidden")},document.addEventListener("click",()=>{h&&h.classList.add("hidden"),m&&m.classList.add("hidden")});const D=async()=>{const b=await oe("Insertar Enlace","Ingresa la URL:",!1);b&&(ve(),document.execCommand("createLink",!1,b.startsWith("http")?b:"https://"+b),o.querySelectorAll("a").forEach(B=>B.target="_blank"))};document.getElementById("add-link").onclick=D,document.getElementById("checklist-btn").onclick=()=>M();const M=()=>{var k;ve();const b=window.getSelection();if(b.rangeCount>0){const O=(k=b.getRangeAt(0).commonAncestorContainer.parentElement)==null?void 0:k.closest("li");O&&O.parentElement.classList.contains("checklist")?O.parentElement.classList.remove("checklist"):(document.execCommand("insertUnorderedList"),setTimeout(()=>{const A=window.getSelection();if(A.rangeCount>0){let H=A.focusNode;for(;H&&H.nodeName!=="UL"&&H!==o;)H=H.parentNode;H&&H.nodeName==="UL"&&(H.classList.add("checklist"),H.querySelectorAll("li").forEach(re=>{re.dataset.checked||(re.dataset.checked="false")}))}},10))}pe()};o.onkeydown=b=>{b.key==="Tab"&&(b.preventDefault(),b.shiftKey?document.execCommand("outdent"):document.execCommand("indent"))},o.addEventListener("click",b=>{const k=b.target.closest(".checklist li");if(k){const B=k.getBoundingClientRect();b.clientX-B.left<35&&(b.preventDefault(),k.dataset.checked=k.dataset.checked==="true"?"false":"true",me(!1),pe())}}),e.querySelector(".dialog-overlay").onclick=()=>{me()}}function pe(){document.querySelectorAll(".editor-tool[data-cmd]").forEach(a=>{const r=a.dataset.cmd;try{const s=document.queryCommandState(r);a.classList.toggle("active",s)}catch{}});const n=document.getElementById("toggle-pin");n&&n.classList.toggle("active",n.dataset.active==="true");const e=document.getElementById("toggle-lock");e&&e.classList.toggle("active",e.dataset.active==="true");const o=document.getElementById("checklist-btn");if(o){let a=!1;try{const r=window.getSelection();if(r.rangeCount>0){let s=r.anchorNode;for(;s&&s.id!=="edit-content";){if(s.nodeName==="UL"&&s.classList.contains("checklist")){a=!0;break}s=s.parentNode}}}catch{}o.classList.toggle("active",a)}const t=document.getElementById("checklist-btn-mobile");if(t){let a=!1;try{const r=window.getSelection();if(r.rangeCount>0){let s=r.anchorNode;for(;s&&s.id!=="edit-content";){if(s.nodeName==="UL"&&s.classList.contains("checklist")){a=!0;break}s=s.parentNode}}}catch{}t.classList.toggle("active",a)}const i=document.getElementById("mobile-format-trigger");if(i){const a=!document.getElementById("mobile-tools-menu").classList.contains("hidden");i.classList.toggle("active",a)}}function je(n=null){const e=document.getElementById("editor-modal"),o=document.getElementById("edit-title"),t=document.getElementById("edit-content"),i=document.getElementById("edit-category"),a=e.querySelector(".dialog-content");f.editingNoteId=n?n.id:null,o.value=(n==null?void 0:n.title)||"",t.innerHTML=(n==null?void 0:n.content)===void 0||(n==null?void 0:n.content)==="undefined"?"":(n==null?void 0:n.content)||"";let r="";!n&&f.currentView!=="all"&&(r=f.currentView),i.value=n?n.categoryId||"":r;const s=Ue.find(c=>c.id===(n?n.themeId:"default"))||Ue[0],l=f.settings.theme==="dark"?s.dark:s.light,d=s.id==="default"?f.settings.theme==="dark":Dn(l);a.style.backgroundColor=l,a.style.color=d?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",a.dataset.themeId=s.id,o.style.color=d?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",t.style.color=d?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",e.querySelectorAll(".editor-tool:not(.active), #cat-dropdown-trigger").forEach(c=>{c.style.color=d?"rgba(255,255,255,0.7)":"rgba(0,0,0,0.7)",c.style.borderColor=d?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",c.style.backgroundColor=d?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}),e.querySelectorAll(".editor-tool.active").forEach(c=>{c.style.backgroundColor="",c.style.color="",c.style.borderColor=""}),tn(n?n.pinned:!1),kt(n?!!n.passwordHash:!1),Mn(),e.classList.remove("hidden"),t.focus()}function en(){const n=document.getElementById("editor-modal"),e=n.querySelector(".dialog-content");e.classList.add("dialog-hide"),setTimeout(()=>{n.classList.add("hidden"),e.classList.remove("dialog-hide"),f.editingNoteId=null,f.tempEditorPassword=null,document.getElementById("toggle-lock").dataset.tempHash="",document.getElementById("edit-title").value="",document.getElementById("edit-content").innerHTML="",window.refreshUI&&window.refreshUI()},200)}async function me(n=!0){let e=document.getElementById("edit-title").value.trim();const o=document.getElementById("edit-content").innerHTML,t=document.getElementById("edit-category").value,i=document.getElementById("toggle-pin").dataset.active==="true",a=document.getElementById("toggle-lock").dataset.active==="true",r=document.querySelector("#editor-modal .dialog-content").dataset.themeId;if(!e){const u=new Date;e=u.getFullYear()+"-"+String(u.getMonth()+1).padStart(2,"0")+"-"+String(u.getDate()).padStart(2,"0")+", "+String(u.getHours()).padStart(2,"0")+":"+String(u.getMinutes()).padStart(2,"0")+":"+String(u.getSeconds()).padStart(2,"0")}if(o===void 0||o==="undefined"||o.trim()==="")return I("La nota est√° vac√≠a");const s=f.notes.findIndex(u=>u.id===f.editingNoteId),l=document.getElementById("toggle-lock").dataset.tempHash,d={id:f.editingNoteId||Date.now().toString(),title:e,content:o,categoryId:t||null,pinned:i,themeId:r||"default",passwordHash:a?l||(s>=0?f.notes[s].passwordHash:null):null,updatedAt:Date.now()};if(a&&!d.passwordHash){const u=await oe("Seguridad","Establece una contrase√±a para esta nota:");if(u)d.passwordHash=await z.hashPassword(u);else return}s>=0?f.notes[s]=d:f.notes.unshift(d),f.editingNoteId||(f.editingNoteId=d.id),await V(),n&&en(),window.refreshUI&&window.refreshUI(),window.triggerAutoSync&&window.triggerAutoSync()}function qe(){const n=window.getSelection();n.rangeCount>0&&(St=n.getRangeAt(0))}function ve(){if(St){const n=window.getSelection();n.removeAllRanges(),n.addRange(St)}}function Mn(){const n=document.getElementById("edit-category").value,e=f.categories.find(o=>o.id===n);document.getElementById("selected-cat-label")&&(document.getElementById("selected-cat-label").innerText=e?e.name:"Sin categor√≠a"),document.getElementById("selected-cat-icon")&&(document.getElementById("selected-cat-icon").setAttribute("data-lucide",e&&e.icon||"tag"),$())}function tn(n){const e=document.getElementById("toggle-pin");e.dataset.active=n,e.classList.toggle("active",n),n&&(e.style.backgroundColor="",e.style.color="",e.style.borderColor="")}function kt(n){const e=document.getElementById("toggle-lock");e.dataset.active=n,e.classList.toggle("active",n),n&&(e.style.backgroundColor="",e.style.color="",e.style.borderColor="");const o=e.querySelector("[data-lucide]");o&&(o.setAttribute("data-lucide",n?"lock":"lock-open"),$())}function Hn(){document.getElementById("open-colors").onclick=i=>et(i,"color-popover"),document.getElementById("open-text-colors").onmousedown=i=>{i.preventDefault(),qe()},document.getElementById("open-text-colors").onclick=i=>et(i,"text-color-popover"),document.getElementById("open-emojis").onmousedown=i=>{i.preventDefault(),qe()},document.getElementById("open-emojis").onclick=i=>et(i,"emoji-popover");const n=document.getElementById("bg-color-grid");Ue.forEach(i=>{const a=document.createElement("div");a.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",a.style.backgroundColor=f.settings.theme==="dark"?i.dark:i.light,a.onclick=()=>{const r=document.querySelector("#editor-modal .dialog-content");r.style.backgroundColor=f.settings.theme==="dark"?i.dark:i.light,r.dataset.themeId=i.id,Pe()},n.appendChild(a)});const e=document.getElementById("text-color-grid");_n.forEach(i=>{const a=document.createElement("div");a.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",a.style.backgroundColor=i,a.onmousedown=r=>r.preventDefault(),a.onclick=()=>{ve(),document.execCommand("foreColor",!1,i),Pe()},e.appendChild(a)});const o=document.getElementById("emoji-grid");Cn.forEach(i=>{const a=document.createElement("span");a.className="cursor-pointer hover:bg-accent p-2 rounded text-xl text-center",a.innerText=i,a.onclick=()=>{ve(),document.execCommand("insertHTML",!1,i),Pe()},o.appendChild(a)}),document.addEventListener("click",i=>{!i.target.closest(".editor-tool")&&!i.target.closest(".popover-content")&&!i.target.closest("#cat-dropdown-trigger")&&Pe()});const t=document.getElementById("cat-dropdown-trigger");t.onclick=i=>{i.stopPropagation(),document.getElementById("cat-dropdown-menu").classList.toggle("hidden")}}function et(n,e){n.stopPropagation();const o=document.getElementById(e),t=n.currentTarget.getBoundingClientRect();Pe(e),o.classList.remove("hidden"),window.innerHeight-t.bottom<250?(o.style.top=`${t.top-o.offsetHeight-8}px`,o.style.bottom=`${window.innerHeight-t.top+8}px`,o.style.top="auto"):(o.style.top=`${t.bottom+8}px`,o.style.bottom="auto"),o.style.left=`${Math.min(t.left,window.innerWidth-o.offsetWidth-20)}px`,t.left+300>window.innerWidth&&(o.style.left="auto",o.style.right="20px")}function Pe(n=null){["color-popover","text-color-popover","emoji-popover","cat-dropdown-menu"].forEach(e=>{const o=document.getElementById(e);e!==n&&o&&o.classList.add("hidden")})}function jn(){return`
    <div id="categories-modal" class="fixed inset-0 z-[70] hidden">
        <div class="dialog-overlay"></div>
        <div class="dialog-content max-w-lg p-0 overflow-hidden h-[500px] flex flex-col">
            <div class="p-6 flex justify-between items-center border-b">
                <div>
                    <h2 class="text-lg font-semibold text-foreground">Gestionar Etiquetas</h2>
                    <p class="text-xs text-muted-foreground">Organiza tus notas con categor√≠as personalizadas</p>
                </div>
                <button class="close-categories p-2 hover:bg-accent rounded-md transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>

            <div class="p-4 bg-muted/30 border-b">
                <div class="flex items-center gap-2">
                    <div class="relative flex-1">
                        <i data-lucide="tag" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                        <input type="text" id="new-cat-name" placeholder="Nueva etiqueta..." 
                               class="pl-12 h-10 w-full bg-background" autocomplete="off">
                    </div>
                    <button id="add-cat-btn" class="btn-shad btn-shad-primary h-10 px-6">Crear</button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-2" id="cat-manager-list">
                <!-- Items injected here -->
            </div>
        </div>
        <div id="cat-icon-picker" class="fixed z-[80] hidden popover-content p-2 w-64 bg-popover border shadow-2xl rounded-xl">
            <div class="grid grid-cols-6 gap-1 max-h-48 overflow-y-auto p-1" id="cat-icons-grid"></div>
        </div>
    </div>`}function We(n,e=null){const o=document.getElementById("cat-manager-list");o&&(o.innerHTML="",e&&(f.categories=e),f.categories.forEach(t=>{const i=document.createElement("div");i.className="flex items-center gap-3 p-2 rounded-lg border bg-card/50 hover:bg-accent/30 transition-all group",i.innerHTML=`
            <div class="w-10 h-10 rounded-lg cursor-pointer hover:bg-accent border flex items-center justify-center shrink-0 transition-all hover:scale-105" 
                 id="icon-trigger-${t.id}" title="Cambiar icono">
                 <i data-lucide="${t.icon||"tag"}" class="w-5 h-5 text-primary"></i>
            </div>
            
            <input type="text" value="${t.name}" 
                   class="bg-transparent border-none outline-none font-medium text-sm flex-1 focus:ring-0 transition-colors h-9 px-2 rounded hover:bg-background/50 focus:bg-background"
                   id="cn-${t.id}" autocomplete="off">
            
            <div class="flex items-center gap-1 opacity-60 group-hover:opacity-100 transition-opacity">
                <button class="p-2 rounded-md hover:bg-background border border-transparent hover:border-border transition-all ${t.passwordHash?"text-primary":"text-muted-foreground"}"
                        id="lock-${t.id}" title="${t.passwordHash?"Protegido":"Protecci√≥n"}">
                    <i data-lucide="${t.passwordHash?"lock":"unlock"}" class="w-4 h-4"></i>
                </button>
                <button class="p-2 rounded-md hover:bg-destructive/10 hover:text-destructive text-muted-foreground transition-all"
                        id="del-${t.id}" title="Eliminar">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        `,o.appendChild(i),document.getElementById(`icon-trigger-${t.id}`).onclick=r=>{r.stopPropagation(),qn(t.id,n,r.currentTarget)};const a=document.getElementById(`cn-${t.id}`);a.oninput=r=>{t.name=r.target.value,n()},a.onchange=async()=>{await V(),n(),window.triggerAutoSync&&window.triggerAutoSync()},document.getElementById(`lock-${t.id}`).onclick=()=>$n(t.id,n),document.getElementById(`del-${t.id}`).onclick=()=>zn(t.id,n)}),$())}async function qn(n,e,o){const t=f.categories.find(l=>l.id===n);if(!t)return;const i=document.getElementById("cat-icon-picker"),a=document.getElementById("cat-icons-grid");a.innerHTML="",Tn.forEach(l=>{const d=document.createElement("button");d.className="w-9 h-9 flex items-center justify-center rounded-md hover:bg-primary/10 hover:text-primary transition-all text-muted-foreground",d.innerHTML=`<i data-lucide="${l}" class="w-5 h-5"></i>`,d.onclick=async()=>{t.icon=l,await V(),We(e),e(),i.classList.add("hidden"),window.triggerAutoSync&&window.triggerAutoSync()},a.appendChild(d)}),$();const r=o.getBoundingClientRect();i.style.top=`${r.bottom+8}px`,i.style.left=`${r.left}px`,i.classList.remove("hidden");const s=l=>{!i.contains(l.target)&&!o.contains(l.target)&&(i.classList.add("hidden"),document.removeEventListener("click",s))};setTimeout(()=>document.addEventListener("click",s),10)}async function zn(n,e){const o=f.categories.find(t=>t.id===n);if(o){if(o.passwordHash){const t=await oe("Seguridad","Etiqueta protegida. Ingresa contrase√±a para eliminar:");if(!t)return;if(await z.hashPassword(t)!==o.passwordHash)return I("‚ùå Error: Contrase√±a incorrecta")}confirm(`¬øEliminar la etiqueta "${o.name}"? Las notas no se borrar√°n.`)&&(f.categories=f.categories.filter(t=>t.id!==n),f.notes.forEach(t=>{t.categoryId===n&&(t.categoryId=null)}),f.currentView===n&&(f.currentView="all"),await V(),We(e),e(),window.triggerAutoSync&&window.triggerAutoSync())}}async function $n(n,e){const o=f.categories.find(t=>t.id===n);if(o){if(o.passwordHash){const t=await oe("Seguridad","Ingresa la contrase√±a para quitar la protecci√≥n:");if(!t)return;if(await z.hashPassword(t)!==o.passwordHash)return I("‚ùå Error: Contrase√±a incorrecta");o.passwordHash=null,I("üîì Protecci√≥n quitada")}else{const t=await oe("Seguridad","Define una contrase√±a para proteger esta etiqueta:");t&&(o.passwordHash=await z.hashPassword(t),I("üîí Etiqueta protegida"))}await V(),We(e),e(),window.triggerAutoSync&&window.triggerAutoSync()}}function Fn(){return`
    <div id="settings-modal" class="fixed inset-0 z-[80] hidden">
        <div class="dialog-overlay"></div>
        <div class="dialog-content max-w-2xl p-0 overflow-hidden flex flex-col md:flex-row h-[90vh] md:h-[500px]">
            <!-- Sidebar Settings -->
            <div id="settings-sidebar" class="w-full md:w-48 bg-muted/50 border-b md:border-b-0 md:border-r p-4 flex flex-col gap-1 overflow-y-auto">
                <button class="settings-tab" data-tab="appearance">
                    <i data-lucide="palette" class="w-4 h-4"></i> General
                </button>
                <button class="settings-tab" data-tab="sync">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i> Sincronizaci√≥n
                </button>
                <button class="settings-tab" data-tab="security">
                    <i data-lucide="shield" class="w-4 h-4"></i> Seguridad
                </button>
                <button class="settings-tab text-destructive mt-auto" data-tab="danger">
                    <i data-lucide="alert-triangle" class="w-4 h-4"></i> Zona Peligrosa
                </button>
            </div>

            <!-- Content Area -->
            <div class="flex-1 flex flex-col min-w-0" id="settings-content-area">
                <div class="p-4 border-b flex items-center gap-3">
                    <button class="md:hidden p-2 hover:bg-accent rounded-md group" id="settings-back-btn">
                        <i data-lucide="arrow-left" class="w-5 h-5 text-muted-foreground group-hover:text-foreground"></i>
                    </button>
                    <h2 id="settings-tab-title" class="font-bold flex-1">Configuraci√≥n</h2>
                    <button class="close-settings p-2 hover:bg-accent rounded-md group">
                        <i data-lucide="x" class="w-5 h-5 text-muted-foreground group-hover:text-foreground"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-6" id="settings-panels">
                    <!-- Panel: Apariencia -->
                    <div id="panel-appearance" class="settings-panel space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Tema Visual</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button id="theme-light" class="flex flex-col items-center gap-2 p-4 rounded-lg border bg-card hover:bg-accent transition-all group">
                                    <div class="w-full aspect-video bg-zinc-100 rounded border flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-300 rounded"></div>
                                    </div>
                                    <span class="text-xs font-medium">Claro</span>
                                </button>
                                <button id="theme-dark" class="flex flex-col items-center gap-2 p-4 rounded-lg border bg-zinc-950 hover:bg-zinc-900 transition-all group ring-primary">
                                    <div class="w-full aspect-video bg-zinc-800 rounded border border-zinc-700 flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-600 rounded"></div>
                                    </div>
                                    <span class="text-xs font-medium text-white">Oscuro</span>
                                </button>
                            </div>
                        </section>

                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Mantenimiento</h3>
                            <div class="p-4 rounded-lg border bg-primary/5 space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-xs font-medium">Versi√≥n Instalada</span>
                                    <span class="text-xs font-bold font-mono text-primary" id="settings-version-display">v3.6.0</span>
                                </div>
                                <p class="text-[10px] text-muted-foreground">Si la aplicaci√≥n no se actualiza o ves errores visuales, usa el bot√≥n de abajo para forzar una limpieza del sistema.</p>
                                <button id="force-reload-btn" class="btn-shad btn-shad-outline w-full h-10 flex items-center justify-center gap-2 group">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500"></i>
                                    Forzar Actualizaci√≥n Completa
                                </button>
                            </div>
                        </section>
                    </div>

                    <!-- Panel: Sincronizaci√≥n -->
                    <div id="panel-sync" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Google Drive</h3>
                                <div id="drive-status" class="text-[10px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground font-bold uppercase">Desconectado</div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs font-medium">Nombre de carpeta en Drive</label>
                                <input type="text" id="config-drive-path" class="h-10 px-4 w-full" placeholder="p.ej. CloudNotesV3" autocomplete="off">
                                <p class="text-[10px] text-muted-foreground">Las notas se guardar√°n encriptadas dentro de esta carpeta.</p>
                            </div>
                            <button id="connect-drive-btn" class="btn-shad btn-shad-outline w-full h-10 flex items-center justify-center gap-2">
                                <i data-lucide="link" class="w-4 h-4"></i> Conectar con Google Drive
                            </button>
                            <button id="save-sync-config" class="btn-shad btn-shad-primary w-full h-10">Guardar Cambios</button>
                        </section>
                    </div>

                    <!-- Panel: Seguridad -->
                    <div id="panel-security" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Seguridad de la Sesi√≥n</h3>
                            <div class="p-4 rounded-lg border bg-muted/20 space-y-3">
                                <p class="text-xs text-muted-foreground">Cerrar la sesi√≥n actual eliminar√° la clave de acceso de la memoria y te llevar√° a la pantalla de desbloqueo.</p>
                                <button id="logout-btn" class="btn-shad bg-destructive/10 text-destructive hover:bg-destructive hover:text-white w-full h-10 flex items-center justify-center gap-2 transition-all">
                                    <i data-lucide="log-out" class="w-4 h-4"></i> Cerrar Sesi√≥n
                                </button>
                            </div>
                        </section>
                        
                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Encriptaci√≥n</h3>
                            <div class="space-y-2">
                                <label class="text-xs font-medium">Algoritmo preferido</label>
                                <select id="config-algo" class="h-10 w-full px-3">
                                    <option value="aes-256-gcm">AES-256-GCM (Recomendado)</option>
                                    <option value="kyber">CRYSTALS-Kyber (Experimental)</option>
                                </select>
                            </div>
                             <button id="save-security-config" class="btn-shad btn-shad-primary w-full h-10">Actualizar Algoritmo</button>
                        </section>
                    </div>

                    <!-- Panel: Danger Zone -->
                    <div id="panel-danger" class="settings-panel hidden space-y-6">
                        <section class="p-4 rounded-lg border border-destructive/20 bg-destructive/5 space-y-4">
                            <h3 class="text-sm font-semibold text-destructive uppercase tracking-wider">Restablecer Aplicaci√≥n</h3>
                            <p class="text-xs text-muted-foreground underline">Esta acci√≥n borrar√° permanentemente todas las notas y categor√≠as almacenadas localmente en este navegador.</p>
                            <div class="space-y-2">
                                <label class="text-[10px] uppercase font-bold text-destructive/70">Para confirmar, escribe "confirmar" a continuaci√≥n:</label>
                                <input type="text" id="factory-reset-confirm" class="h-10 px-4 mt-1 w-full border rounded-md" placeholder="Escribe la palabra..." autocomplete="off">
                            </div>
                            <button id="factory-reset" class="btn-shad bg-destructive text-destructive-foreground hover:bg-destructive/90 w-full h-10 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i> Eliminar todos los datos locales
                            </button>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>`}function Rn(){const n=document.querySelectorAll(".settings-panel"),e=document.querySelectorAll(".settings-tab"),o=document.getElementById("settings-tab-title"),t=document.getElementById("settings-sidebar"),i=t.nextElementSibling,a=document.getElementById("settings-back-btn"),r=l=>{e.forEach(u=>u.classList.toggle("active",u.dataset.tab===l)),n.forEach(u=>u.classList.toggle("hidden",u.id!==`panel-${l}`));const d={appearance:"General",sync:"Sincronizaci√≥n Cloud",security:"Seguridad y Sesi√≥n",danger:"Zona Peligrosa"};o.innerText=d[l]||"Configuraci√≥n",window.innerWidth<768&&(t.classList.add("hidden"),i.classList.remove("hidden"),a.classList.remove("hidden")),$()};e.forEach(l=>{l.onclick=()=>r(l.dataset.tab)}),a.onclick=()=>{t.classList.remove("hidden"),i.classList.add("hidden"),a.classList.add("hidden"),o.innerText="Configuraci√≥n"},window.innerWidth<768?(i.classList.add("hidden"),a.classList.add("hidden")):r("appearance");const s=document.getElementById("force-reload-btn");s&&(s.onclick=nn)}async function nn(){if(confirm("Esto reiniciar√° la aplicaci√≥n, limpiar√° la cach√© y eliminar√° el Service Worker para forzar la √∫ltima versi√≥n. ¬øContinuar?"))try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const o of e)await o.unregister()}if("caches"in window){const e=await caches.keys();for(const o of e)await caches.delete(o)}sessionStorage.clear();const n=new URL(window.location.href);n.searchParams.set("t",Date.now()),window.location.href=n.toString()}catch(n){console.error("Error clearing cache:",n),window.location.reload()}}function Gn(){return`
    <!-- Prompt Modal -->
    <div id="prompt-modal" class="fixed inset-0 z-[200] hidden">
        <div class="absolute inset-0 bg-background/90 backdrop-blur-xl"></div>
        <div class="dialog-content max-w-sm p-6 space-y-6">
            <div class="space-y-2">
                <h2 id="prompt-title" class="text-xl font-bold">Seguridad</h2>
                <p id="prompt-desc" class="text-sm text-muted-foreground leading-relaxed">Ingresa la contrase√±a para continuar</p>
            </div>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="password" id="prompt-input" placeholder="Tu contrase√±a"
                        class="h-11 w-full text-center tracking-widest outline-none pr-12 bg-muted/30 border-transparent focus:border-primary/30 transition-all rounded-lg">
                    <button type="button"
                        class="absolute right-0 top-0 h-11 w-11 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass"
                        data-target="prompt-input">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="flex gap-3 pt-2">
                    <button id="prompt-cancel" class="btn-shad btn-shad-outline flex-1 h-11">Cancelar</button>
                    <button id="prompt-confirm" class="btn-shad btn-shad-primary flex-1 h-11 font-bold">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast">
        <div class="border">
            ¬°Acci√≥n completada!
        </div>
    </div>`}function on(n,e=null){const o=document.getElementById("sidebar-categories"),t=document.getElementById("mobile-sidebar-categories"),i=document.getElementById("edit-category"),a=document.getElementById("cat-dropdown-menu");e&&(f.categories=e),o&&(o.innerHTML=""),t&&(t.innerHTML=""),i&&(i.innerHTML='<option value="">Sin categor√≠a</option>'),a&&(a.innerHTML='<div class="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer border-b" data-id="">Sin categor√≠a</div>');const r=f.categories.length>0,s=document.getElementById("sidebar-categories-header"),l=document.getElementById("mobile-sidebar-categories-header");s&&s.classList.toggle("hidden",!r),l&&l.classList.toggle("hidden",!r),document.querySelectorAll('.nav-link[data-view="all"], .nav-link-mobile[data-view="all"], .nav-link-mobile-drawer[data-view="all"]').forEach(c=>{c.classList.toggle("active",f.currentView==="all")});const d=(c,g,h)=>{if(!a)return;const v=document.createElement("div");v.className="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer flex items-center gap-2",v.innerHTML=`<i data-lucide="${h||"tag"}" class="w-3.5 h-3.5 text-primary"></i> ${g}`,v.onclick=()=>{i&&(i.value=c),u(),a.classList.add("hidden")},a.appendChild(v)},u=()=>{const c=document.getElementById("edit-category").value,g=f.categories.find(h=>h.id===c);document.getElementById("selected-cat-label").innerText=g?g.name:"Sin categor√≠a"};if(a){const c=a.querySelector('[data-id=""]');c&&(c.onclick=()=>{i&&(i.value=""),u(),a.classList.add("hidden")})}f.categories.forEach(c=>{const g=(h=!1)=>{const v=document.createElement("button");return v.className=h?"nav-link-mobile-drawer w-full group":"nav-link w-full group",f.currentView===c.id&&v.classList.add("active"),v.onclick=async()=>{if(c.passwordHash){const m=await oe("Acceso Restringido",`Ingresa la contrase√±a para "${c.name}":`);if(!m)return;if(await z.hashPassword(m)!==c.passwordHash){I("Contrase√±a incorrecta");return}}document.querySelectorAll(".nav-link, .nav-link-mobile-drawer").forEach(m=>m.classList.remove("active")),v.classList.add("active"),n(c.id,c.name),h&&document.getElementById("mobile-sidebar-overlay").classList.add("hidden")},v.innerHTML=`
                <div class="flex items-center justify-between w-full">
                    <div class="flex items-center gap-3">
                        <i data-lucide="${c.icon||"tag"}" class="w-4 h-4 text-primary"></i>
                        <span class="truncate sidebar-label">${c.name}</span>
                    </div>
                    <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        ${c.passwordHash?'<i data-lucide="lock" class="w-3 h-3 text-muted-foreground"></i>':""}
                    </div>
                </div>
            `,v};if(o&&o.appendChild(g(!1)),t&&t.appendChild(g(!0)),i){const h=document.createElement("option");h.value=c.id,h.innerText=c.name,i.appendChild(h)}d(c.id,c.name,c.icon)}),$()}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ht(n,e){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),o.push.apply(o,t)}return o}function Q(n){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?arguments[e]:{};e%2?Ht(Object(o),!0).forEach(function(t){Un(n,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Ht(Object(o)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))})}return n}function tt(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?tt=function(e){return typeof e}:tt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(n)}function Un(n,e,o){return e in n?Object.defineProperty(n,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[e]=o,n}function ie(){return ie=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(n[t]=o[t])}return n},ie.apply(this,arguments)}function Wn(n,e){if(n==null)return{};var o={},t=Object.keys(n),i,a;for(a=0;a<t.length;a++)i=t[a],!(e.indexOf(i)>=0)&&(o[i]=n[i]);return o}function Xn(n,e){if(n==null)return{};var o=Wn(n,e),t,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(i=0;i<a.length;i++)t=a[i],!(e.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}var Yn="1.15.6";function te(n){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(n)}var ae=te(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Xe=te(/Edge/i),jt=te(/firefox/i),ze=te(/safari/i)&&!te(/chrome/i)&&!te(/android/i),Dt=te(/iP(ad|od|hone)/i),an=te(/chrome/i)&&te(/android/i),rn={capture:!1,passive:!1};function S(n,e,o){n.addEventListener(e,o,!ae&&rn)}function E(n,e,o){n.removeEventListener(e,o,!ae&&rn)}function rt(n,e){if(e){if(e[0]===">"&&(e=e.substring(1)),n)try{if(n.matches)return n.matches(e);if(n.msMatchesSelector)return n.msMatchesSelector(e);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(e)}catch{return!1}return!1}}function sn(n){return n.host&&n!==document&&n.host.nodeType?n.host:n.parentNode}function K(n,e,o,t){if(n){o=o||document;do{if(e!=null&&(e[0]===">"?n.parentNode===o&&rt(n,e):rt(n,e))||t&&n===o)return n;if(n===o)break}while(n=sn(n))}return null}var qt=/\s+/g;function W(n,e,o){if(n&&e)if(n.classList)n.classList[o?"add":"remove"](e);else{var t=(" "+n.className+" ").replace(qt," ").replace(" "+e+" "," ");n.className=(t+(o?" "+e:"")).replace(qt," ")}}function y(n,e,o){var t=n&&n.style;if(t){if(o===void 0)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(n,""):n.currentStyle&&(o=n.currentStyle),e===void 0?o:o[e];!(e in t)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),t[e]=o+(typeof o=="string"?"":"px")}}function ke(n,e){var o="";if(typeof n=="string")o=n;else do{var t=y(n,"transform");t&&t!=="none"&&(o=t+" "+o)}while(!e&&(n=n.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(o)}function ln(n,e,o){if(n){var t=n.getElementsByTagName(e),i=0,a=t.length;if(o)for(;i<a;i++)o(t[i],i);return t}return[]}function Z(){var n=document.scrollingElement;return n||document.documentElement}function P(n,e,o,t,i){if(!(!n.getBoundingClientRect&&n!==window)){var a,r,s,l,d,u,c;if(n!==window&&n.parentNode&&n!==Z()?(a=n.getBoundingClientRect(),r=a.top,s=a.left,l=a.bottom,d=a.right,u=a.height,c=a.width):(r=0,s=0,l=window.innerHeight,d=window.innerWidth,u=window.innerHeight,c=window.innerWidth),(e||o)&&n!==window&&(i=i||n.parentNode,!ae))do if(i&&i.getBoundingClientRect&&(y(i,"transform")!=="none"||o&&y(i,"position")!=="static")){var g=i.getBoundingClientRect();r-=g.top+parseInt(y(i,"border-top-width")),s-=g.left+parseInt(y(i,"border-left-width")),l=r+a.height,d=s+a.width;break}while(i=i.parentNode);if(t&&n!==window){var h=ke(i||n),v=h&&h.a,m=h&&h.d;h&&(r/=m,s/=v,c/=v,u/=m,l=r+u,d=s+c)}return{top:r,left:s,bottom:l,right:d,width:c,height:u}}}function zt(n,e,o){for(var t=ue(n,!0),i=P(n)[e];t;){var a=P(t)[o],r=void 0;if(r=i>=a,!r)return t;if(t===Z())break;t=ue(t,!1)}return!1}function _e(n,e,o,t){for(var i=0,a=0,r=n.children;a<r.length;){if(r[a].style.display!=="none"&&r[a]!==w.ghost&&(t||r[a]!==w.dragged)&&K(r[a],o.draggable,n,!1)){if(i===e)return r[a];i++}a++}return null}function Bt(n,e){for(var o=n.lastElementChild;o&&(o===w.ghost||y(o,"display")==="none"||e&&!rt(o,e));)o=o.previousElementSibling;return o||null}function Y(n,e){var o=0;if(!n||!n.parentNode)return-1;for(;n=n.previousElementSibling;)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==w.clone&&(!e||rt(n,e))&&o++;return o}function $t(n){var e=0,o=0,t=Z();if(n)do{var i=ke(n),a=i.a,r=i.d;e+=n.scrollLeft*a,o+=n.scrollTop*r}while(n!==t&&(n=n.parentNode));return[e,o]}function Vn(n,e){for(var o in n)if(n.hasOwnProperty(o)){for(var t in e)if(e.hasOwnProperty(t)&&e[t]===n[o][t])return Number(o)}return-1}function ue(n,e){if(!n||!n.getBoundingClientRect)return Z();var o=n,t=!1;do if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var i=y(o);if(o.clientWidth<o.scrollWidth&&(i.overflowX=="auto"||i.overflowX=="scroll")||o.clientHeight<o.scrollHeight&&(i.overflowY=="auto"||i.overflowY=="scroll")){if(!o.getBoundingClientRect||o===document.body)return Z();if(t||e)return o;t=!0}}while(o=o.parentNode);return Z()}function Jn(n,e){if(n&&e)for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);return n}function pt(n,e){return Math.round(n.top)===Math.round(e.top)&&Math.round(n.left)===Math.round(e.left)&&Math.round(n.height)===Math.round(e.height)&&Math.round(n.width)===Math.round(e.width)}var $e;function dn(n,e){return function(){if(!$e){var o=arguments,t=this;o.length===1?n.call(t,o[0]):n.apply(t,o),$e=setTimeout(function(){$e=void 0},e)}}}function Kn(){clearTimeout($e),$e=void 0}function cn(n,e,o){n.scrollLeft+=e,n.scrollTop+=o}function un(n){var e=window.Polymer,o=window.jQuery||window.Zepto;return e&&e.dom?e.dom(n).cloneNode(!0):o?o(n).clone(!0)[0]:n.cloneNode(!0)}function fn(n,e,o){var t={};return Array.from(n.children).forEach(function(i){var a,r,s,l;if(!(!K(i,e.draggable,n,!1)||i.animated||i===o)){var d=P(i);t.left=Math.min((a=t.left)!==null&&a!==void 0?a:1/0,d.left),t.top=Math.min((r=t.top)!==null&&r!==void 0?r:1/0,d.top),t.right=Math.max((s=t.right)!==null&&s!==void 0?s:-1/0,d.right),t.bottom=Math.max((l=t.bottom)!==null&&l!==void 0?l:-1/0,d.bottom)}}),t.width=t.right-t.left,t.height=t.bottom-t.top,t.x=t.left,t.y=t.top,t}var G="Sortable"+new Date().getTime();function Zn(){var n=[],e;return{captureAnimationState:function(){if(n=[],!!this.options.animation){var t=[].slice.call(this.el.children);t.forEach(function(i){if(!(y(i,"display")==="none"||i===w.ghost)){n.push({target:i,rect:P(i)});var a=Q({},n[n.length-1].rect);if(i.thisAnimationDuration){var r=ke(i,!0);r&&(a.top-=r.f,a.left-=r.e)}i.fromRect=a}})}},addAnimationState:function(t){n.push(t)},removeAnimationState:function(t){n.splice(Vn(n,{target:t}),1)},animateAll:function(t){var i=this;if(!this.options.animation){clearTimeout(e),typeof t=="function"&&t();return}var a=!1,r=0;n.forEach(function(s){var l=0,d=s.target,u=d.fromRect,c=P(d),g=d.prevFromRect,h=d.prevToRect,v=s.rect,m=ke(d,!0);m&&(c.top-=m.f,c.left-=m.e),d.toRect=c,d.thisAnimationDuration&&pt(g,c)&&!pt(u,c)&&(v.top-c.top)/(v.left-c.left)===(u.top-c.top)/(u.left-c.left)&&(l=eo(v,g,h,i.options)),pt(c,u)||(d.prevFromRect=u,d.prevToRect=c,l||(l=i.options.animation),i.animate(d,v,c,l)),l&&(a=!0,r=Math.max(r,l),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},l),d.thisAnimationDuration=l)}),clearTimeout(e),a?e=setTimeout(function(){typeof t=="function"&&t()},r):typeof t=="function"&&t(),n=[]},animate:function(t,i,a,r){if(r){y(t,"transition",""),y(t,"transform","");var s=ke(this.el),l=s&&s.a,d=s&&s.d,u=(i.left-a.left)/(l||1),c=(i.top-a.top)/(d||1);t.animatingX=!!u,t.animatingY=!!c,y(t,"transform","translate3d("+u+"px,"+c+"px,0)"),this.forRepaintDummy=Qn(t),y(t,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),y(t,"transform","translate3d(0,0,0)"),typeof t.animated=="number"&&clearTimeout(t.animated),t.animated=setTimeout(function(){y(t,"transition",""),y(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},r)}}}}function Qn(n){return n.offsetWidth}function eo(n,e,o,t){return Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))/Math.sqrt(Math.pow(e.top-o.top,2)+Math.pow(e.left-o.left,2))*t.animation}var ye=[],mt={initializeByDefault:!0},Ye={mount:function(e){for(var o in mt)mt.hasOwnProperty(o)&&!(o in e)&&(e[o]=mt[o]);ye.forEach(function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),ye.push(e)},pluginEvent:function(e,o,t){var i=this;this.eventCanceled=!1,t.cancel=function(){i.eventCanceled=!0};var a=e+"Global";ye.forEach(function(r){o[r.pluginName]&&(o[r.pluginName][a]&&o[r.pluginName][a](Q({sortable:o},t)),o.options[r.pluginName]&&o[r.pluginName][e]&&o[r.pluginName][e](Q({sortable:o},t)))})},initializePlugins:function(e,o,t,i){ye.forEach(function(s){var l=s.pluginName;if(!(!e.options[l]&&!s.initializeByDefault)){var d=new s(e,o,e.options);d.sortable=e,d.options=e.options,e[l]=d,ie(t,d.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var r=this.modifyOption(e,a,e.options[a]);typeof r<"u"&&(e.options[a]=r)}},getEventProperties:function(e,o){var t={};return ye.forEach(function(i){typeof i.eventProperties=="function"&&ie(t,i.eventProperties.call(o[i.pluginName],e))}),t},modifyOption:function(e,o,t){var i;return ye.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[o]=="function"&&(i=a.optionListeners[o].call(e[a.pluginName],t))}),i}};function to(n){var e=n.sortable,o=n.rootEl,t=n.name,i=n.targetEl,a=n.cloneEl,r=n.toEl,s=n.fromEl,l=n.oldIndex,d=n.newIndex,u=n.oldDraggableIndex,c=n.newDraggableIndex,g=n.originalEvent,h=n.putSortable,v=n.extraEventProperties;if(e=e||o&&o[G],!!e){var m,D=e.options,M="on"+t.charAt(0).toUpperCase()+t.substr(1);window.CustomEvent&&!ae&&!Xe?m=new CustomEvent(t,{bubbles:!0,cancelable:!0}):(m=document.createEvent("Event"),m.initEvent(t,!0,!0)),m.to=r||o,m.from=s||o,m.item=i||o,m.clone=a,m.oldIndex=l,m.newIndex=d,m.oldDraggableIndex=u,m.newDraggableIndex=c,m.originalEvent=g,m.pullMode=h?h.lastPutMode:void 0;var b=Q(Q({},v),Ye.getEventProperties(t,e));for(var k in b)m[k]=b[k];o&&o.dispatchEvent(m),D[M]&&D[M].call(e,m)}}var no=["evt"],R=function(e,o){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=t.evt,a=Xn(t,no);Ye.pluginEvent.bind(w)(e,o,Q({dragEl:p,parentEl:L,ghostEl:x,rootEl:C,nextEl:be,lastDownEl:nt,cloneEl:T,cloneHidden:ce,dragStarted:Oe,putSortable:j,activeSortable:w.active,originalEvent:i,oldIndex:Se,oldDraggableIndex:Fe,newIndex:X,newDraggableIndex:de,hideGhostForTarget:hn,unhideGhostForTarget:bn,cloneNowHidden:function(){ce=!0},cloneNowShown:function(){ce=!1},dispatchSortableEvent:function(s){F({sortable:o,name:s,originalEvent:i})}},a))};function F(n){to(Q({putSortable:j,cloneEl:T,targetEl:p,rootEl:C,oldIndex:Se,oldDraggableIndex:Fe,newIndex:X,newDraggableIndex:de},n))}var p,L,x,C,be,nt,T,ce,Se,X,Fe,de,Je,j,xe=!1,st=!1,lt=[],ge,J,gt,ht,Ft,Rt,Oe,we,Re,Ge=!1,Ke=!1,ot,q,bt=[],It=!1,dt=[],ft=typeof document<"u",Ze=Dt,Gt=Xe||ae?"cssFloat":"float",oo=ft&&!an&&!Dt&&"draggable"in document.createElement("div"),pn=function(){if(ft){if(ae)return!1;var n=document.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}}(),mn=function(e,o){var t=y(e),i=parseInt(t.width)-parseInt(t.paddingLeft)-parseInt(t.paddingRight)-parseInt(t.borderLeftWidth)-parseInt(t.borderRightWidth),a=_e(e,0,o),r=_e(e,1,o),s=a&&y(a),l=r&&y(r),d=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+P(a).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+P(r).width;if(t.display==="flex")return t.flexDirection==="column"||t.flexDirection==="column-reverse"?"vertical":"horizontal";if(t.display==="grid")return t.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&s.float&&s.float!=="none"){var c=s.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===c)?"vertical":"horizontal"}return a&&(s.display==="block"||s.display==="flex"||s.display==="table"||s.display==="grid"||d>=i&&t[Gt]==="none"||r&&t[Gt]==="none"&&d+u>i)?"vertical":"horizontal"},io=function(e,o,t){var i=t?e.left:e.top,a=t?e.right:e.bottom,r=t?e.width:e.height,s=t?o.left:o.top,l=t?o.right:o.bottom,d=t?o.width:o.height;return i===s||a===l||i+r/2===s+d/2},ao=function(e,o){var t;return lt.some(function(i){var a=i[G].options.emptyInsertThreshold;if(!(!a||Bt(i))){var r=P(i),s=e>=r.left-a&&e<=r.right+a,l=o>=r.top-a&&o<=r.bottom+a;if(s&&l)return t=i}}),t},gn=function(e){function o(a,r){return function(s,l,d,u){var c=s.options.group.name&&l.options.group.name&&s.options.group.name===l.options.group.name;if(a==null&&(r||c))return!0;if(a==null||a===!1)return!1;if(r&&a==="clone")return a;if(typeof a=="function")return o(a(s,l,d,u),r)(s,l,d,u);var g=(r?s:l).options.group.name;return a===!0||typeof a=="string"&&a===g||a.join&&a.indexOf(g)>-1}}var t={},i=e.group;(!i||tt(i)!="object")&&(i={name:i}),t.name=i.name,t.checkPull=o(i.pull,!0),t.checkPut=o(i.put),t.revertClone=i.revertClone,e.group=t},hn=function(){!pn&&x&&y(x,"display","none")},bn=function(){!pn&&x&&y(x,"display","")};ft&&!an&&document.addEventListener("click",function(n){if(st)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),st=!1,!1},!0);var he=function(e){if(p){e=e.touches?e.touches[0]:e;var o=ao(e.clientX,e.clientY);if(o){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.target=t.rootEl=o,t.preventDefault=void 0,t.stopPropagation=void 0,o[G]._onDragOver(t)}}},ro=function(e){p&&p.parentNode[G]._isOutsideThisEl(e.target)};function w(n,e){if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(n));this.el=n,this.options=e=ie({},e),n[G]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return mn(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,s){r.setData("Text",s.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:w.supportPointer!==!1&&"PointerEvent"in window&&(!ze||Dt),emptyInsertThreshold:5};Ye.initializePlugins(this,n,o);for(var t in o)!(t in e)&&(e[t]=o[t]);gn(e);for(var i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this));this.nativeDraggable=e.forceFallback?!1:oo,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?S(n,"pointerdown",this._onTapStart):(S(n,"mousedown",this._onTapStart),S(n,"touchstart",this._onTapStart)),this.nativeDraggable&&(S(n,"dragover",this),S(n,"dragenter",this)),lt.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ie(this,Zn())}w.prototype={constructor:w,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(we=null)},_getDirection:function(e,o){return typeof this.options.direction=="function"?this.options.direction.call(this,e,o,p):this.options.direction},_onTapStart:function(e){if(e.cancelable){var o=this,t=this.el,i=this.options,a=i.preventOnFilter,r=e.type,s=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(s||e).target,d=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=i.filter;if(go(t),!p&&!(/mousedown|pointerdown/.test(r)&&e.button!==0||i.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&ze&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=K(l,i.draggable,t,!1),!(l&&l.animated)&&nt!==l)){if(Se=Y(l),Fe=Y(l,i.draggable),typeof u=="function"){if(u.call(this,e,l,this)){F({sortable:o,rootEl:d,name:"filter",targetEl:l,toEl:t,fromEl:t}),R("filter",o,{evt:e}),a&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(c){if(c=K(d,c.trim(),t,!1),c)return F({sortable:o,rootEl:c,name:"filter",targetEl:l,fromEl:t,toEl:t}),R("filter",o,{evt:e}),!0}),u)){a&&e.preventDefault();return}i.handle&&!K(d,i.handle,t,!1)||this._prepareDragStart(e,s,l)}}},_prepareDragStart:function(e,o,t){var i=this,a=i.el,r=i.options,s=a.ownerDocument,l;if(t&&!p&&t.parentNode===a){var d=P(t);if(C=a,p=t,L=p.parentNode,be=p.nextSibling,nt=t,Je=r.group,w.dragged=p,ge={target:p,clientX:(o||e).clientX,clientY:(o||e).clientY},Ft=ge.clientX-d.left,Rt=ge.clientY-d.top,this._lastX=(o||e).clientX,this._lastY=(o||e).clientY,p.style["will-change"]="all",l=function(){if(R("delayEnded",i,{evt:e}),w.eventCanceled){i._onDrop();return}i._disableDelayedDragEvents(),!jt&&i.nativeDraggable&&(p.draggable=!0),i._triggerDragStart(e,o),F({sortable:i,name:"choose",originalEvent:e}),W(p,r.chosenClass,!0)},r.ignore.split(",").forEach(function(u){ln(p,u.trim(),vt)}),S(s,"dragover",he),S(s,"mousemove",he),S(s,"touchmove",he),r.supportPointer?(S(s,"pointerup",i._onDrop),!this.nativeDraggable&&S(s,"pointercancel",i._onDrop)):(S(s,"mouseup",i._onDrop),S(s,"touchend",i._onDrop),S(s,"touchcancel",i._onDrop)),jt&&this.nativeDraggable&&(this.options.touchStartThreshold=4,p.draggable=!0),R("delayStart",this,{evt:e}),r.delay&&(!r.delayOnTouchOnly||o)&&(!this.nativeDraggable||!(Xe||ae))){if(w.eventCanceled){this._onDrop();return}r.supportPointer?(S(s,"pointerup",i._disableDelayedDrag),S(s,"pointercancel",i._disableDelayedDrag)):(S(s,"mouseup",i._disableDelayedDrag),S(s,"touchend",i._disableDelayedDrag),S(s,"touchcancel",i._disableDelayedDrag)),S(s,"mousemove",i._delayedDragTouchMoveHandler),S(s,"touchmove",i._delayedDragTouchMoveHandler),r.supportPointer&&S(s,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var o=e.touches?e.touches[0]:e;Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){p&&vt(p),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;E(e,"mouseup",this._disableDelayedDrag),E(e,"touchend",this._disableDelayedDrag),E(e,"touchcancel",this._disableDelayedDrag),E(e,"pointerup",this._disableDelayedDrag),E(e,"pointercancel",this._disableDelayedDrag),E(e,"mousemove",this._delayedDragTouchMoveHandler),E(e,"touchmove",this._delayedDragTouchMoveHandler),E(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,o){o=o||e.pointerType=="touch"&&e,!this.nativeDraggable||o?this.options.supportPointer?S(document,"pointermove",this._onTouchMove):o?S(document,"touchmove",this._onTouchMove):S(document,"mousemove",this._onTouchMove):(S(p,"dragend",this),S(C,"dragstart",this._onDragStart));try{document.selection?it(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,o){if(xe=!1,C&&p){R("dragStarted",this,{evt:o}),this.nativeDraggable&&S(document,"dragover",ro);var t=this.options;!e&&W(p,t.dragClass,!1),W(p,t.ghostClass,!0),w.active=this,e&&this._appendGhost(),F({sortable:this,name:"start",originalEvent:o})}else this._nulling()},_emulateDragOver:function(){if(J){this._lastX=J.clientX,this._lastY=J.clientY,hn();for(var e=document.elementFromPoint(J.clientX,J.clientY),o=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(J.clientX,J.clientY),e!==o);)o=e;if(p.parentNode[G]._isOutsideThisEl(e),o)do{if(o[G]){var t=void 0;if(t=o[G]._onDragOver({clientX:J.clientX,clientY:J.clientY,target:e,rootEl:o}),t&&!this.options.dragoverBubble)break}e=o}while(o=sn(o));bn()}},_onTouchMove:function(e){if(ge){var o=this.options,t=o.fallbackTolerance,i=o.fallbackOffset,a=e.touches?e.touches[0]:e,r=x&&ke(x,!0),s=x&&r&&r.a,l=x&&r&&r.d,d=Ze&&q&&$t(q),u=(a.clientX-ge.clientX+i.x)/(s||1)+(d?d[0]-bt[0]:0)/(s||1),c=(a.clientY-ge.clientY+i.y)/(l||1)+(d?d[1]-bt[1]:0)/(l||1);if(!w.active&&!xe){if(t&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<t)return;this._onDragStart(e,!0)}if(x){r?(r.e+=u-(gt||0),r.f+=c-(ht||0)):r={a:1,b:0,c:0,d:1,e:u,f:c};var g="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");y(x,"webkitTransform",g),y(x,"mozTransform",g),y(x,"msTransform",g),y(x,"transform",g),gt=u,ht=c,J=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!x){var e=this.options.fallbackOnBody?document.body:C,o=P(p,!0,Ze,!0,e),t=this.options;if(Ze){for(q=e;y(q,"position")==="static"&&y(q,"transform")==="none"&&q!==document;)q=q.parentNode;q!==document.body&&q!==document.documentElement?(q===document&&(q=Z()),o.top+=q.scrollTop,o.left+=q.scrollLeft):q=Z(),bt=$t(q)}x=p.cloneNode(!0),W(x,t.ghostClass,!1),W(x,t.fallbackClass,!0),W(x,t.dragClass,!0),y(x,"transition",""),y(x,"transform",""),y(x,"box-sizing","border-box"),y(x,"margin",0),y(x,"top",o.top),y(x,"left",o.left),y(x,"width",o.width),y(x,"height",o.height),y(x,"opacity","0.8"),y(x,"position",Ze?"absolute":"fixed"),y(x,"zIndex","100000"),y(x,"pointerEvents","none"),w.ghost=x,e.appendChild(x),y(x,"transform-origin",Ft/parseInt(x.style.width)*100+"% "+Rt/parseInt(x.style.height)*100+"%")}},_onDragStart:function(e,o){var t=this,i=e.dataTransfer,a=t.options;if(R("dragStart",this,{evt:e}),w.eventCanceled){this._onDrop();return}R("setupClone",this),w.eventCanceled||(T=un(p),T.removeAttribute("id"),T.draggable=!1,T.style["will-change"]="",this._hideClone(),W(T,this.options.chosenClass,!1),w.clone=T),t.cloneId=it(function(){R("clone",t),!w.eventCanceled&&(t.options.removeCloneOnHide||C.insertBefore(T,p),t._hideClone(),F({sortable:t,name:"clone"}))}),!o&&W(p,a.dragClass,!0),o?(st=!0,t._loopId=setInterval(t._emulateDragOver,50)):(E(document,"mouseup",t._onDrop),E(document,"touchend",t._onDrop),E(document,"touchcancel",t._onDrop),i&&(i.effectAllowed="move",a.setData&&a.setData.call(t,i,p)),S(document,"drop",t),y(p,"transform","translateZ(0)")),xe=!0,t._dragStartId=it(t._dragStarted.bind(t,o,e)),S(document,"selectstart",t),Oe=!0,window.getSelection().removeAllRanges(),ze&&y(document.body,"user-select","none")},_onDragOver:function(e){var o=this.el,t=e.target,i,a,r,s=this.options,l=s.group,d=w.active,u=Je===l,c=s.sort,g=j||d,h,v=this,m=!1;if(It)return;function D(Be,Sn){R(Be,v,Q({evt:e,isOwner:u,axis:h?"vertical":"horizontal",revert:r,dragRect:i,targetRect:a,canSort:c,fromSortable:g,target:t,completed:b,onMove:function(Pt,kn){return Qe(C,o,p,i,Pt,P(Pt),e,kn)},changed:k},Sn))}function M(){D("dragOverAnimationCapture"),v.captureAnimationState(),v!==g&&g.captureAnimationState()}function b(Be){return D("dragOverCompleted",{insertion:Be}),Be&&(u?d._hideClone():d._showClone(v),v!==g&&(W(p,j?j.options.ghostClass:d.options.ghostClass,!1),W(p,s.ghostClass,!0)),j!==v&&v!==w.active?j=v:v===w.active&&j&&(j=null),g===v&&(v._ignoreWhileAnimating=t),v.animateAll(function(){D("dragOverAnimationComplete"),v._ignoreWhileAnimating=null}),v!==g&&(g.animateAll(),g._ignoreWhileAnimating=null)),(t===p&&!p.animated||t===o&&!t.animated)&&(we=null),!s.dragoverBubble&&!e.rootEl&&t!==document&&(p.parentNode[G]._isOutsideThisEl(e.target),!Be&&he(e)),!s.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),m=!0}function k(){X=Y(p),de=Y(p,s.draggable),F({sortable:v,name:"change",toEl:o,newIndex:X,newDraggableIndex:de,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),t=K(t,s.draggable,o,!0),D("dragOver"),w.eventCanceled)return m;if(p.contains(e.target)||t.animated&&t.animatingX&&t.animatingY||v._ignoreWhileAnimating===t)return b(!1);if(st=!1,d&&!s.disabled&&(u?c||(r=L!==C):j===this||(this.lastPutMode=Je.checkPull(this,d,p,e))&&l.checkPut(this,d,p,e))){if(h=this._getDirection(e,t)==="vertical",i=P(p),D("dragOverValid"),w.eventCanceled)return m;if(r)return L=C,M(),this._hideClone(),D("revert"),w.eventCanceled||(be?C.insertBefore(p,be):C.appendChild(p)),b(!0);var B=Bt(o,s.draggable);if(!B||uo(e,h,this)&&!B.animated){if(B===p)return b(!1);if(B&&o===e.target&&(t=B),t&&(a=P(t)),Qe(C,o,p,i,t,a,e,!!t)!==!1)return M(),B&&B.nextSibling?o.insertBefore(p,B.nextSibling):o.appendChild(p),L=o,k(),b(!0)}else if(B&&co(e,h,this)){var O=_e(o,0,s,!0);if(O===p)return b(!1);if(t=O,a=P(t),Qe(C,o,p,i,t,a,e,!1)!==!1)return M(),o.insertBefore(p,O),L=o,k(),b(!0)}else if(t.parentNode===o){a=P(t);var A=0,H,re=p.parentNode!==o,U=!io(p.animated&&p.toRect||i,t.animated&&t.toRect||a,h),Ce=h?"top":"left",se=zt(t,"top","top")||zt(p,"top","top"),Te=se?se.scrollTop:void 0;we!==t&&(H=a[Ce],Ge=!1,Ke=!U&&s.invertSwap||re),A=fo(e,t,a,h,U?1:s.swapThreshold,s.invertedSwapThreshold==null?s.swapThreshold:s.invertedSwapThreshold,Ke,we===t);var ee;if(A!==0){var fe=Y(p);do fe-=A,ee=L.children[fe];while(ee&&(y(ee,"display")==="none"||ee===x))}if(A===0||ee===t)return b(!1);we=t,Re=A;var De=t.nextElementSibling,le=!1;le=A===1;var Ve=Qe(C,o,p,i,t,a,e,le);if(Ve!==!1)return(Ve===1||Ve===-1)&&(le=Ve===1),It=!0,setTimeout(lo,30),M(),le&&!De?o.appendChild(p):t.parentNode.insertBefore(p,le?De:t),se&&cn(se,0,Te-se.scrollTop),L=p.parentNode,H!==void 0&&!Ke&&(ot=Math.abs(H-P(t)[Ce])),k(),b(!0)}if(o.contains(p))return b(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){E(document,"mousemove",this._onTouchMove),E(document,"touchmove",this._onTouchMove),E(document,"pointermove",this._onTouchMove),E(document,"dragover",he),E(document,"mousemove",he),E(document,"touchmove",he)},_offUpEvents:function(){var e=this.el.ownerDocument;E(e,"mouseup",this._onDrop),E(e,"touchend",this._onDrop),E(e,"pointerup",this._onDrop),E(e,"pointercancel",this._onDrop),E(e,"touchcancel",this._onDrop),E(document,"selectstart",this)},_onDrop:function(e){var o=this.el,t=this.options;if(X=Y(p),de=Y(p,t.draggable),R("drop",this,{evt:e}),L=p&&p.parentNode,X=Y(p),de=Y(p,t.draggable),w.eventCanceled){this._nulling();return}xe=!1,Ke=!1,Ge=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),_t(this.cloneId),_t(this._dragStartId),this.nativeDraggable&&(E(document,"drop",this),E(o,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ze&&y(document.body,"user-select",""),y(p,"transform",""),e&&(Oe&&(e.cancelable&&e.preventDefault(),!t.dropBubble&&e.stopPropagation()),x&&x.parentNode&&x.parentNode.removeChild(x),(C===L||j&&j.lastPutMode!=="clone")&&T&&T.parentNode&&T.parentNode.removeChild(T),p&&(this.nativeDraggable&&E(p,"dragend",this),vt(p),p.style["will-change"]="",Oe&&!xe&&W(p,j?j.options.ghostClass:this.options.ghostClass,!1),W(p,this.options.chosenClass,!1),F({sortable:this,name:"unchoose",toEl:L,newIndex:null,newDraggableIndex:null,originalEvent:e}),C!==L?(X>=0&&(F({rootEl:L,name:"add",toEl:L,fromEl:C,originalEvent:e}),F({sortable:this,name:"remove",toEl:L,originalEvent:e}),F({rootEl:L,name:"sort",toEl:L,fromEl:C,originalEvent:e}),F({sortable:this,name:"sort",toEl:L,originalEvent:e})),j&&j.save()):X!==Se&&X>=0&&(F({sortable:this,name:"update",toEl:L,originalEvent:e}),F({sortable:this,name:"sort",toEl:L,originalEvent:e})),w.active&&((X==null||X===-1)&&(X=Se,de=Fe),F({sortable:this,name:"end",toEl:L,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){R("nulling",this),C=p=L=x=be=T=nt=ce=ge=J=Oe=X=de=Se=Fe=we=Re=j=Je=w.dragged=w.ghost=w.clone=w.active=null,dt.forEach(function(e){e.checked=!0}),dt.length=gt=ht=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":p&&(this._onDragOver(e),so(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],o,t=this.el.children,i=0,a=t.length,r=this.options;i<a;i++)o=t[i],K(o,r.draggable,this.el,!1)&&e.push(o.getAttribute(r.dataIdAttr)||mo(o));return e},sort:function(e,o){var t={},i=this.el;this.toArray().forEach(function(a,r){var s=i.children[r];K(s,this.options.draggable,i,!1)&&(t[a]=s)},this),o&&this.captureAnimationState(),e.forEach(function(a){t[a]&&(i.removeChild(t[a]),i.appendChild(t[a]))}),o&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,o){return K(e,o||this.options.draggable,this.el,!1)},option:function(e,o){var t=this.options;if(o===void 0)return t[e];var i=Ye.modifyOption(this,e,o);typeof i<"u"?t[e]=i:t[e]=o,e==="group"&&gn(t)},destroy:function(){R("destroy",this);var e=this.el;e[G]=null,E(e,"mousedown",this._onTapStart),E(e,"touchstart",this._onTapStart),E(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(E(e,"dragover",this),E(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(o){o.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),lt.splice(lt.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!ce){if(R("hideClone",this),w.eventCanceled)return;y(T,"display","none"),this.options.removeCloneOnHide&&T.parentNode&&T.parentNode.removeChild(T),ce=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(ce){if(R("showClone",this),w.eventCanceled)return;p.parentNode==C&&!this.options.group.revertClone?C.insertBefore(T,p):be?C.insertBefore(T,be):C.appendChild(T),this.options.group.revertClone&&this.animate(p,T),y(T,"display",""),ce=!1}}};function so(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.cancelable&&n.preventDefault()}function Qe(n,e,o,t,i,a,r,s){var l,d=n[G],u=d.options.onMove,c;return window.CustomEvent&&!ae&&!Xe?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=n,l.dragged=o,l.draggedRect=t,l.related=i||e,l.relatedRect=a||P(e),l.willInsertAfter=s,l.originalEvent=r,n.dispatchEvent(l),u&&(c=u.call(d,l,r)),c}function vt(n){n.draggable=!1}function lo(){It=!1}function co(n,e,o){var t=P(_e(o.el,0,o.options,!0)),i=fn(o.el,o.options,x),a=10;return e?n.clientX<i.left-a||n.clientY<t.top&&n.clientX<t.right:n.clientY<i.top-a||n.clientY<t.bottom&&n.clientX<t.left}function uo(n,e,o){var t=P(Bt(o.el,o.options.draggable)),i=fn(o.el,o.options,x),a=10;return e?n.clientX>i.right+a||n.clientY>t.bottom&&n.clientX>t.left:n.clientY>i.bottom+a||n.clientX>t.right&&n.clientY>t.top}function fo(n,e,o,t,i,a,r,s){var l=t?n.clientY:n.clientX,d=t?o.height:o.width,u=t?o.top:o.left,c=t?o.bottom:o.right,g=!1;if(!r){if(s&&ot<d*i){if(!Ge&&(Re===1?l>u+d*a/2:l<c-d*a/2)&&(Ge=!0),Ge)g=!0;else if(Re===1?l<u+ot:l>c-ot)return-Re}else if(l>u+d*(1-i)/2&&l<c-d*(1-i)/2)return po(e)}return g=g||r,g&&(l<u+d*a/2||l>c-d*a/2)?l>u+d/2?1:-1:0}function po(n){return Y(p)<Y(n)?1:-1}function mo(n){for(var e=n.tagName+n.className+n.src+n.href+n.textContent,o=e.length,t=0;o--;)t+=e.charCodeAt(o);return t.toString(36)}function go(n){dt.length=0;for(var e=n.getElementsByTagName("input"),o=e.length;o--;){var t=e[o];t.checked&&dt.push(t)}}function it(n){return setTimeout(n,0)}function _t(n){return clearTimeout(n)}ft&&S(document,"touchmove",function(n){(w.active||xe)&&n.cancelable&&n.preventDefault()});w.utils={on:S,off:E,css:y,find:ln,is:function(e,o){return!!K(e,o,e,!1)},extend:Jn,throttle:dn,closest:K,toggleClass:W,clone:un,index:Y,nextTick:it,cancelNextTick:_t,detectDirection:mn,getChild:_e,expando:G};w.get=function(n){return n[G]};w.mount=function(){for(var n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];e[0].constructor===Array&&(e=e[0]),e.forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(w.utils=Q(Q({},w.utils),t.utils)),Ye.mount(t)})};w.create=function(n,e){return new w(n,e)};w.version=Yn;var N=[],Me,Ct,Tt=!1,yt,wt,ct,He;function ho(){function n(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return n.prototype={dragStarted:function(o){var t=o.originalEvent;this.sortable.nativeDraggable?S(document,"dragover",this._handleAutoScroll):this.options.supportPointer?S(document,"pointermove",this._handleFallbackAutoScroll):t.touches?S(document,"touchmove",this._handleFallbackAutoScroll):S(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(o){var t=o.originalEvent;!this.options.dragOverBubble&&!t.rootEl&&this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?E(document,"dragover",this._handleAutoScroll):(E(document,"pointermove",this._handleFallbackAutoScroll),E(document,"touchmove",this._handleFallbackAutoScroll),E(document,"mousemove",this._handleFallbackAutoScroll)),Ut(),at(),Kn()},nulling:function(){ct=Ct=Me=Tt=He=yt=wt=null,N.length=0},_handleFallbackAutoScroll:function(o){this._handleAutoScroll(o,!0)},_handleAutoScroll:function(o,t){var i=this,a=(o.touches?o.touches[0]:o).clientX,r=(o.touches?o.touches[0]:o).clientY,s=document.elementFromPoint(a,r);if(ct=o,t||this.options.forceAutoScrollFallback||Xe||ae||ze){xt(o,this.options,s,t);var l=ue(s,!0);Tt&&(!He||a!==yt||r!==wt)&&(He&&Ut(),He=setInterval(function(){var d=ue(document.elementFromPoint(a,r),!0);d!==l&&(l=d,at()),xt(o,i.options,d,t)},10),yt=a,wt=r)}else{if(!this.options.bubbleScroll||ue(s,!0)===Z()){at();return}xt(o,this.options,ue(s,!1),!1)}}},ie(n,{pluginName:"scroll",initializeByDefault:!0})}function at(){N.forEach(function(n){clearInterval(n.pid)}),N=[]}function Ut(){clearInterval(He)}var xt=dn(function(n,e,o,t){if(e.scroll){var i=(n.touches?n.touches[0]:n).clientX,a=(n.touches?n.touches[0]:n).clientY,r=e.scrollSensitivity,s=e.scrollSpeed,l=Z(),d=!1,u;Ct!==o&&(Ct=o,at(),Me=e.scroll,u=e.scrollFn,Me===!0&&(Me=ue(o,!0)));var c=0,g=Me;do{var h=g,v=P(h),m=v.top,D=v.bottom,M=v.left,b=v.right,k=v.width,B=v.height,O=void 0,A=void 0,H=h.scrollWidth,re=h.scrollHeight,U=y(h),Ce=h.scrollLeft,se=h.scrollTop;h===l?(O=k<H&&(U.overflowX==="auto"||U.overflowX==="scroll"||U.overflowX==="visible"),A=B<re&&(U.overflowY==="auto"||U.overflowY==="scroll"||U.overflowY==="visible")):(O=k<H&&(U.overflowX==="auto"||U.overflowX==="scroll"),A=B<re&&(U.overflowY==="auto"||U.overflowY==="scroll"));var Te=O&&(Math.abs(b-i)<=r&&Ce+k<H)-(Math.abs(M-i)<=r&&!!Ce),ee=A&&(Math.abs(D-a)<=r&&se+B<re)-(Math.abs(m-a)<=r&&!!se);if(!N[c])for(var fe=0;fe<=c;fe++)N[fe]||(N[fe]={});(N[c].vx!=Te||N[c].vy!=ee||N[c].el!==h)&&(N[c].el=h,N[c].vx=Te,N[c].vy=ee,clearInterval(N[c].pid),(Te!=0||ee!=0)&&(d=!0,N[c].pid=setInterval((function(){t&&this.layer===0&&w.active._onTouchMove(ct);var De=N[this.layer].vy?N[this.layer].vy*s:0,le=N[this.layer].vx?N[this.layer].vx*s:0;typeof u=="function"&&u.call(w.dragged.parentNode[G],le,De,n,ct,N[this.layer].el)!=="continue"||cn(N[this.layer].el,le,De)}).bind({layer:c}),24))),c++}while(e.bubbleScroll&&g!==l&&(g=ue(g,!1)));Tt=d}},30),vn=function(e){var o=e.originalEvent,t=e.putSortable,i=e.dragEl,a=e.activeSortable,r=e.dispatchSortableEvent,s=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(o){var d=t||a;s();var u=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:o,c=document.elementFromPoint(u.clientX,u.clientY);l(),d&&!d.el.contains(c)&&(r("spill"),this.onSpill({dragEl:i,putSortable:t}))}};function Lt(){}Lt.prototype={startIndex:null,dragStart:function(e){var o=e.oldDraggableIndex;this.startIndex=o},onSpill:function(e){var o=e.dragEl,t=e.putSortable;this.sortable.captureAnimationState(),t&&t.captureAnimationState();var i=_e(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(o,i):this.sortable.el.appendChild(o),this.sortable.animateAll(),t&&t.animateAll()},drop:vn};ie(Lt,{pluginName:"revertOnSpill"});function At(){}At.prototype={onSpill:function(e){var o=e.dragEl,t=e.putSortable,i=t||this.sortable;i.captureAnimationState(),o.parentNode&&o.parentNode.removeChild(o),i.animateAll()},drop:vn};ie(At,{pluginName:"removeOnSpill"});w.mount(new ho);w.mount(At,Lt);function ut(n){const e=document.getElementById("notes-grid");if(!e)return;e.innerHTML="";const o=f.currentView==="all"?f.notes.filter(r=>{const s=f.categories.find(l=>l.id===r.categoryId);return!s||!s.passwordHash}):f.notes.filter(r=>r.categoryId===f.currentView),t=o.filter(r=>r.pinned),i=o.filter(r=>!r.pinned),a=r=>{const s=document.createElement("div");s.className="note-card note-animate-in relative group",s.dataset.id=r.id;const l=Ue.find(g=>g.id===r.themeId)||Ue[0],d=f.settings.theme==="dark"?l.dark:l.light;r.themeId!=="default"&&(s.style.backgroundColor=d,s.style.borderColor=f.settings.theme==="dark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)");const u=f.categories.find(g=>g.id===r.categoryId),c=f.unlockedNotes.has(r.id);return s.innerHTML=`
            <div class="note-card-content">
                <div class="flex items-start justify-between mb-2">
                    <h3 class="font-bold text-base line-clamp-2 leading-snug flex-1 pr-3">${r.title}</h3>
                    <div class="flex items-center gap-2 shrink-0 pt-0.5">
                        ${r.pinned?'<i data-lucide="pin" class="w-4 h-4 fill-current text-primary"></i>':""}
                        ${r.passwordHash?`<i data-lucide="${c?"unlock":"lock"}" class="w-4 h-4 lock-indicator cursor-pointer opacity-80" data-id="${r.id}"></i>`:""}
                        <button class="delete-note-btn p-2 rounded-md hover:bg-destructive/10 hover:text-destructive transition-colors md:opacity-0 md:group-hover:opacity-100 text-muted-foreground/40" data-id="${r.id}" title="Eliminar">
                            <i data-lucide="trash-2" class="w-4.5 h-4.5"></i>
                        </button>
                    </div>
                </div>
                <div class="text-[13px] opacity-70 line-clamp-6 leading-relaxed mb-4 flex-1">
                    ${r.passwordHash&&!c?'<div class="flex items-center gap-3 py-8 italic opacity-50"><i data-lucide="shield-alert" class="w-6 h-6"></i> Contenido protegido</div>':r.content}
                </div>
                ${u?`
                <div class="mt-auto">
                    <span class="flex items-center gap-2 text-[10px] px-3 py-1.5 rounded-full bg-primary/5 border border-primary/10 font-bold text-primary/70 uppercase tracking-widest">
                        <i data-lucide="${u.icon||"tag"}" class="w-3.5 h-3.5 text-primary"></i>
                        ${u.name}
                    </span>
                </div>`:""}
            </div>
        `,s.onclick=async g=>{if(!g.target.closest(".delete-note-btn")){if(r.passwordHash&&!f.unlockedNotes.has(r.id)){try{const h=await oe("Nota Protegida","Ingresa la contrase√±a para ver esta nota:");if(!h)return;if(await z.hashPassword(h)!==r.passwordHash){I("‚ùå Contrase√±a incorrecta");return}f.unlockedNotes.add(r.id),n(r),setTimeout(()=>ut(n),300)}catch(h){console.error("Error unlocking note:",h),I("‚ùå Error al desbloquear")}return}n(r)}},s};if(t.length>0){const r=document.createElement("h3");if(r.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2 flex items-center gap-2",r.innerHTML='<i data-lucide="pin" class="w-3 h-3"></i> Destacadas',e.appendChild(r),t.forEach(s=>e.appendChild(a(s))),i.length>0){const s=document.createElement("div");s.className="col-span-full h-px bg-border my-4",e.appendChild(s)}}if(i.length>0){if(t.length>0){const r=document.createElement("h3");r.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2",r.innerText="Notas",e.appendChild(r)}i.forEach(r=>e.appendChild(a(r)))}o.length===0&&(e.innerHTML=`<div class="col-span-full text-center py-20 text-muted-foreground opacity-50">
            <i data-lucide="ghost" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
            <p>No hay notas aqu√≠</p>
        </div>`),$(),e.querySelectorAll(".delete-note-btn").forEach(r=>{r.onclick=async s=>{s.stopPropagation();const l=r.dataset.id,d=f.notes.find(u=>u.id===l);if(d!=null&&d.passwordHash&&!f.unlockedNotes.has(d.id)){const u=await oe("Eliminar Nota Protegida","Ingresa la contrase√±a para autorizar la eliminaci√≥n:");if(!u)return;if(await z.hashPassword(u)!==d.passwordHash)return I("‚ùå Contrase√±a incorrecta")}confirm("¬øEliminar esta nota?")&&(f.notes=f.notes.filter(u=>u.id!==l),await V(),ut(n),window.triggerAutoSync&&window.triggerAutoSync())}}),bo()}function bo(n){const e=document.getElementById("notes-grid");e&&(e.sortable&&e.sortable.destroy(),e.sortable=w.create(e,{animation:250,ghostClass:"opacity-50",onEnd:async()=>{const o=[];e.querySelectorAll(".note-card").forEach(a=>{const r=f.notes.find(s=>s.id===a.dataset.id);r&&o.push(r)});const t=new Set(o.map(a=>a.id)),i=f.notes.filter(a=>!t.has(a.id));f.notes=[...o,...i],await V()}}))}const vo="974464877836-721dprai6taijtuufmrkh438q68e97sp.apps.googleusercontent.com";let Le=null;async function Wt(){console.log("Iniciando aplicaci√≥n modular...");const n=localStorage.getItem("cn_pass_plain_v3");n&&sessionStorage.setItem("cn_pass_plain_v3",n),yo(),In(),wn(),On(ne),Rn(),wo();const e=localStorage.getItem("cn_last_version");if(e&&e!==Ne){localStorage.setItem("cn_last_version",Ne),console.log(`Nueva versi√≥n detectada (${Ne}). Recargando...`),I("üöÄ Actualizando a la √∫ltima versi√≥n..."),setTimeout(()=>location.reload(!0),1500);return}localStorage.setItem("cn_last_version",Ne),await Ln(ne),xo(),Eo(),ko(),Io(),So(),Co(),To(),$(),console.log("Aplicaci√≥n lista.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Wt):Wt();function yo(){const n=document.getElementById("root");if(!n)return console.error("No se encontr√≥ el elemento #root");n.innerHTML=`
        ${Bn()}
        ${Nn()}
        ${Pn()}
        ${jn()}
        ${Fn()}
        ${Gn()}
    `,console.log("Estructura inyectada.")}function ne(){ut(je),on(Nt,f.categories),yn(),$()}function Nt(n,e){f.currentView=n,yn(e),ut(je)}function yn(n=null){const e=document.getElementById("view-title"),o=document.getElementById("view-desc");if(!e||!o)return;const t=f.categories.find(a=>a.id===f.currentView),i=n||(t?t.name:"Todas las notas");e.innerText=i,o.innerText=f.currentView==="all"?"Organiza tus pensamientos y protege tu privacidad.":`Mostrando notas en "${i}".`}function wn(){const n=f.settings.theme==="dark";document.documentElement.classList.toggle("dark",n),document.documentElement.classList.toggle("light",!n)}function _(n,e){const o=document.getElementById(n);o&&(o.onclick=e)}function wo(){_("add-note-btn",()=>je()),_("mobile-add-btn",()=>je()),_("sync-btn",Ie),_("mobile-sync-btn",Ie),_("mobile-sync-btn-bottom",Ie),_("settings-trigger",Jt),_("mobile-settings-btn",()=>{Ee(),Jt()}),_("sidebar-collapse-btn",()=>{const t=document.querySelector("aside");t.classList.toggle("collapsed");const i=t.classList.contains("collapsed");localStorage.setItem("sidebar_collapsed",i),En()}),_("mobile-force-reload-btn",nn),document.body.addEventListener("click",t=>{t.target.closest("#logout-btn, #mobile-logout-btn")&&Vt(),t.target.id==="mobile-sidebar-overlay"&&Ee()});const n=async()=>{f.settings.drivePath=document.getElementById("config-drive-path").value,f.settings.algo=document.getElementById("config-algo").value,await V(),I("‚úÖ Configuraci√≥n guardada"),Xt()};_("save-sync-config",n),_("save-security-config",n),_("connect-drive-btn",xn),_("theme-light",()=>Kt("light")),_("theme-dark",()=>Kt("dark"));const e=document.querySelectorAll(".nav-link[data-view], .nav-link-mobile[data-view], .nav-link-mobile-drawer[data-view]");e.forEach(t=>{t.onclick=()=>{const i=t.dataset.view;e.forEach(a=>a.classList.toggle("active",a.dataset.view===i)),document.querySelectorAll("#sidebar-categories .nav-link").forEach(a=>a.classList.remove("active")),document.querySelectorAll(".nav-link-mobile-drawer").forEach(a=>{a.classList.remove("active");const r=a.querySelector("i");r&&r.classList.remove("text-primary");const s=a.querySelector("span");s&&s.classList.remove("text-primary")}),Nt(i,i==="all"?"Todas las notas":""),Ee()}}),document.querySelectorAll(".nav-link-mobile-drawer").forEach(t=>{t.onclick=i=>{i.preventDefault();const a=t.dataset.category;f.currentView=a,document.querySelectorAll(".nav-link[data-view], .nav-link-mobile[data-view]").forEach(r=>r.classList.remove("active")),document.querySelectorAll("#sidebar-categories .nav-link").forEach(r=>r.classList.remove("active")),document.querySelectorAll(".nav-link-mobile-drawer").forEach(r=>{const s=r.dataset.category===a;r.classList.toggle("active",s);const l=r.querySelector("i");l&&l.classList.toggle("text-primary",s);const d=r.querySelector("span");d&&d.classList.toggle("text-primary",s)}),Ee(),ne()}}),_("sidebar-manage-cats",Yt),_("mobile-manage-cats",()=>{Ee(),Yt()}),_("add-cat-btn",_o);const o=t=>{const i=t.target.closest("#settings-modal, #categories-modal, #editor-modal");i&&i.classList.add("hidden")};document.querySelectorAll(".close-modal, .close-settings, .close-categories").forEach(t=>{t.onclick=o}),document.body.addEventListener("click",t=>{const i=t.target.closest(".toggle-pass");if(!i)return;const a=document.getElementById(i.dataset.target);if(!a)return;const r=a.type==="password";a.type=r?"text":"password",i.innerHTML=`<i data-lucide="${r?"eye-off":"eye"}" class="w-4 h-4"></i>`,$()}),document.body.addEventListener("keydown",t=>{if(t.key==="Enter"){const i=document.getElementById("auth-shield");if(i&&!i.classList.contains("hidden")){const a=document.getElementById("master-password"),r=document.getElementById("confirm-password");(document.activeElement===a||document.activeElement===r)&&Mt(ne)}}}),_("auth-submit",()=>Mt(ne)),_("factory-reset",()=>{const t=document.getElementById("factory-reset-confirm");(t==null?void 0:t.value.toLowerCase())==="confirmar"&&(localStorage.clear(),sessionStorage.clear(),location.reload())}),window.triggerAutoSync=Xt,window.handleLogout=Vt,window.openEditor=je}function xo(){const n=t=>{const i=t.target.value.toLowerCase();document.querySelectorAll(".note-card").forEach(r=>{const s=f.notes.find(d=>d.id===r.dataset.id);if(!s)return;const l=s.title.toLowerCase().includes(i)||s.content.toLowerCase().includes(i);r.classList.toggle("hidden",!l)})},e=document.getElementById("search-input"),o=document.getElementById("mobile-search-input-top");e&&(e.oninput=n),o&&(o.oninput=n)}function Eo(){const n=document.getElementById("mobile-sidebar-overlay"),e=()=>{n==null||n.classList.remove("hidden"),on(Nt,f.categories)};_("mobile-sidebar-trigger",e),_("mobile-sidebar-trigger-bottom",e),_("close-mobile-sidebar",Ee);const o=document.getElementById("mobile-search-bar"),t=document.getElementById("mobile-search-input-top"),i=()=>{o==null||o.classList.remove("hidden"),t==null||t.focus()};_("mobile-search-btn",i),_("mobile-search-trigger",i),_("close-mobile-search",()=>{o&&o.classList.add("hidden"),t&&(t.value="",t.dispatchEvent(new Event("input")))}),_("mobile-search-trigger",()=>{o==null||o.classList.remove("hidden"),t==null||t.focus()})}function So(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(e=>{console.log("SW registrado corectamente:",e.scope)}).catch(e=>{console.log("Fallo al registrar SW:",e)})})}function ko(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),Le=e,["pwa-install-btn","sidebar-pwa-install-btn","mobile-pwa-install-btn"].forEach(t=>{var i;return(i=document.getElementById(t))==null?void 0:i.classList.remove("hidden")})});const n=async()=>{if(!Le)return;Le.prompt();const{outcome:e}=await Le.userChoice;e==="accepted"&&["pwa-install-btn","sidebar-pwa-install-btn","mobile-pwa-install-btn"].forEach(t=>{var i;return(i=document.getElementById(t))==null?void 0:i.classList.add("hidden")}),Le=null};_("pwa-install-btn",n),_("sidebar-pwa-install-btn",n),_("mobile-pwa-install-btn",n)}function Io(){const n=setInterval(()=>{typeof gapi<"u"&&typeof google<"u"&&(clearInterval(n),gapi.load("client",async()=>{await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),f.gapiLoaded=!0,f.tokenClient=google.accounts.oauth2.initTokenClient({client_id:vo,scope:"https://www.googleapis.com/auth/drive.file",callback:async o=>{if(o.error)return I("‚ùå Error de vinculaci√≥n");const t=sessionStorage.getItem("cn_pass_plain_v3");if(!t)return I("‚ùå Error: Sesi√≥n no v√°lida");try{const i=new Qt("notev3_",f.settings.drivePath),a=await i.getOrCreateFolder(f.settings.drivePath),r=await i.loadChunks(a);if(r)try{await z.decrypt(r,t),I("‚úÖ Drive verificado: Contrase√±a correcta")}catch{I("‚ùå Contrase√±a de B√≥veda no coincide con Drive");return}localStorage.setItem("gdrive_token_v3",JSON.stringify(o)),gapi.client.setToken(o),Ae(!0),I("‚úÖ Vinculado con Google Drive"),Ie()}catch(i){console.error("Drive connection error:",i),I("‚ùå Error al verificar Drive")}}});const e=localStorage.getItem("gdrive_token_v3");if(e){const o=JSON.parse(e);gapi.client.setToken(o),Ae(!0),setTimeout(()=>Ae(!0),500),setTimeout(()=>Ae(!0),2e3)}else Ae(!1)}))},500)}function xn(){if(!f.tokenClient)return I("Google API no lista");f.tokenClient.requestAccessToken({prompt:""})}function Ae(n){const e=document.getElementById("drive-status"),o=document.getElementById("sync-btn");e&&(e.innerHTML=n?'<span class="flex items-center gap-2 text-green-500 font-bold"><i data-lucide="check-circle" class="w-4 h-4"></i> Conectado</span>':'<span class="flex items-center gap-2 text-muted-foreground font-bold font-mono uppercase"><i data-lucide="x-circle" class="w-4 h-4"></i> No conectado</span>',e.className=n?"text-[10px] px-2 py-0.5 rounded-full bg-primary/10 text-primary":"text-[10px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground"),o&&(o.style.opacity=n?"1":"0.3",o.style.pointerEvents=n?"auto":"none"),$()}let Et=!1;async function Ie(){if(Et)return;const n=sessionStorage.getItem("cn_pass_plain_v3");if(!n)return;const e=document.getElementById("sync-icon"),o=document.getElementById("sync-btn");Et=!0,e&&e.classList.add("animate-spin"),o&&o.classList.add("text-primary");try{const t=new Qt("notev3_",f.settings.drivePath),i=await t.getOrCreateFolder(f.settings.drivePath),a=await t.loadChunks(i);if(a)try{const s=await z.decrypt(a,n);if(s&&Array.isArray(s.notes)){const l=new Map(s.notes.map(m=>[m.id,m])),d=new Map(f.notes.map(m=>[m.id,m])),u=new Set([...l.keys(),...d.keys()]),c=Array.from(u).map(m=>{const D=d.get(m),M=l.get(m);return D?M&&M.updatedAt>D.updatedAt?M:D:M});f.notes=c.sort((m,D)=>D.updatedAt-m.updatedAt);const g=new Map(s.categories.map(m=>[m.id,m])),h=new Map(f.categories.map(m=>[m.id,m])),v=new Set([...g.keys(),...h.keys()]);f.categories=Array.from(v).map(m=>h.get(m)||g.get(m)),await V(),ne()}}catch(s){console.error("Decryption failed during sync pull",s),I("‚ö†Ô∏è No se pudo descargar: Contrase√±a no coincide")}const r=await z.encrypt({notes:f.notes,categories:f.categories},n);await t.saveChunks(r,i),I("‚úÖ Sincronizaci√≥n completa")}catch(t){console.error("Sync error:",t),t.status===401||t.result&&t.result.error&&t.result.error.code===401?(I("‚ö†Ô∏è Sesi√≥n de Drive expirada. Re-conectando..."),xn()):I("‚ùå Error de sincronizaci√≥n")}finally{Et=!1,e&&e.classList.remove("animate-spin"),o&&o.classList.remove("text-primary")}}function Xt(){const n=localStorage.getItem("gdrive_token_v3");f.gapiLoaded&&n&&sessionStorage.getItem("cn_pass_plain_v3")&&Ie()}function Yt(){const n=document.getElementById("categories-modal");n&&(n.classList.remove("hidden"),We(ne,f.categories))}function Ee(){const n=document.getElementById("mobile-sidebar-overlay");n&&n.classList.add("hidden")}async function _o(){const n=document.getElementById("new-cat-name"),e=n==null?void 0:n.value.trim();if(!e)return;const o={id:"cat_"+Date.now(),name:e,icon:"tag",passwordHash:null};f.categories.push(o),await V(),n&&(n.value=""),We(ne,f.categories),ne(),localStorage.getItem("gdrive_token_v3")&&Ie()}function Vt(){localStorage.removeItem("cn_pass_plain_v3"),sessionStorage.removeItem("cn_pass_plain_v3"),location.reload()}function Co(){["app-version","settings-version-display"].forEach(n=>{const e=document.getElementById(n);e&&(e.innerText=Ne)})}function Jt(){const n=document.getElementById("settings-modal");if(n){n.classList.remove("hidden"),document.getElementById("config-drive-path").value=f.settings.drivePath,document.getElementById("config-algo").value=f.settings.algo;const e=n.querySelector('.settings-tab[data-tab="appearance"]');e&&e.click()}}function To(){const n=localStorage.getItem("sidebar_collapsed")==="true",e=document.querySelector("aside");e&&n&&(e.classList.add("collapsed"),En())}function En(){const n=document.querySelector("aside");if(!n)return;const e=n.classList.contains("collapsed"),o=document.getElementById("sidebar-collapse-icon");o&&(o.setAttribute("data-lucide",e?"chevrons-right":"chevrons-left"),$())}function Kt(n){f.settings.theme=n,wn(),V()}
