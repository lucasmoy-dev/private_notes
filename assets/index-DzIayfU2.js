(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const $n="modulepreload",On=function(t){return"/private_notes/"+t},Vt={},it=function(e,n,o){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),s=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));a=Promise.allSettled(n.map(l=>{if(l=On(l),l in Vt)return;Vt[l]=!0;const c=l.endsWith(".css"),g=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${g}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":$n,c||(d.as="script"),d.crossOrigin="",d.href=l,s&&d.setAttribute("nonce",s),document.head.appendChild(d),c)return new Promise((v,f)=>{d.addEventListener("load",v),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(r){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r}return a.then(r=>{for(const s of r||[])s.status==="rejected"&&i(s.reason);return e().catch(i)})};class ${static async hash(e,n="salt_cloud_notes_2026"){const a=new TextEncoder().encode(e+n),i=await crypto.subtle.digest("SHA-512",a);return Array.from(new Uint8Array(i)).map(s=>s.toString(16).padStart(2,"0")).join("")}static async deriveVaultKey(e){return await this.hash(e,"vault_v3_internal_key")}static async compress(e){const o=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip"));return await new Response(o).arrayBuffer()}static async decompress(e){const o=new Blob([e]).stream().pipeThrough(new DecompressionStream("gzip"));return await new Response(o).text()}static async deriveKey(e,n){const o=new TextEncoder,a=await crypto.subtle.importKey("raw",o.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:o.encode(n),iterations:25e4,hash:"SHA-512"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}static async encrypt(e,n,o={algo:"aes-256-gcm"}){try{const a=crypto.getRandomValues(new Uint8Array(16)),i=crypto.getRandomValues(new Uint8Array(12)),r=await this.deriveKey(n,this.bufToBase64(a)),s=typeof e=="string"?e:JSON.stringify(e),l=await this.compress(s),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},r,l);return{payload:this.bufToBase64(new Uint8Array(c)),iv:this.bufToBase64(i),salt:this.bufToBase64(a),algo:o.algo||"aes-256-gcm",compressed:!0,v:"4.0"}}catch(a){throw console.error("[Security] Encryption failed:",a),new Error("No se pudo encriptar la informaci√≥n")}}static async decrypt(e,n){try{if(!e||!e.payload||!e.iv||!e.salt)throw new Error("Formato de datos encriptados inv√°lido");const{payload:o,iv:a,salt:i,compressed:r}=e,s=await this.deriveKey(n,i),l=await crypto.subtle.decrypt({name:"AES-GCM",iv:this.base64ToBuf(a)},s,this.base64ToBuf(o)),c=r?await this.decompress(l):new TextDecoder().decode(l);try{return JSON.parse(c)}catch{return c}}catch(o){throw console.error("[Security] Decryption failed:",o),new Error("Contrase√±a incorrecta o datos corruptos")}}static bufToBase64(e){return btoa(String.fromCharCode(...new Uint8Array(e)))}static base64ToBuf(e){return new Uint8Array(atob(e).split("").map(n=>n.charCodeAt(0)))}}const Mn=Object.freeze(Object.defineProperty({__proto__:null,SecurityService:$},Symbol.toStringTag,{value:"Module"})),u={notes:[],categories:[],settings:{theme:"dark",drivePath:"/backup/notes/",algo:"aes-256-gcm",notesPerChunk:50},currentView:"all",editingNoteId:null,unlockedNotes:new Set,unlockedCategories:new Set,gapiLoaded:!1,tokenClient:null};async function J(){const t=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(t){const e=await $.encrypt(u.notes,t),n=await $.encrypt(u.categories,t);localStorage.setItem("cn_notes_v3_enc",JSON.stringify(e)),localStorage.setItem("cn_categories_v3_enc",JSON.stringify(n)),localStorage.removeItem("cn_notes_v3"),localStorage.removeItem("cn_categories_v3")}localStorage.setItem("cn_settings_v3",JSON.stringify(u.settings))}async function Hn(t){try{const e=localStorage.getItem("cn_notes_v3_enc"),n=localStorage.getItem("cn_categories_v3_enc");if(e)u.notes=await $.decrypt(JSON.parse(e),t);else{const o=localStorage.getItem("cn_notes_v3");o&&(u.notes=JSON.parse(o))}if(n)u.categories=await $.decrypt(JSON.parse(n),t);else{const o=localStorage.getItem("cn_categories_v3");o&&(u.categories=JSON.parse(o))}}catch(e){throw console.error("Failed to load encrypted data",e),e}}function jn(){const t=localStorage.getItem("cn_settings_v3");t&&(u.settings={...u.settings,...JSON.parse(t)},u.settings.syncChunkSize!==void 0&&(u.settings.notesPerChunk||(u.settings.notesPerChunk=50),delete u.settings.syncChunkSize))}const Oe="v3.6.59",Ye=[{id:"default",light:"#ffffff",dark:"#09090b"},{id:"red",light:"#fef2f2",dark:"#450a0a"},{id:"orange",light:"#fff7ed",dark:"#431407"},{id:"yellow",light:"#fefce8",dark:"#422006"},{id:"green",light:"#f0fdf4",dark:"#064e3b"},{id:"teal",light:"#f0fdfa",dark:"#134e4a"},{id:"blue",light:"#eff6ff",dark:"#1e3a8a"},{id:"darkblue",light:"#eef2ff",dark:"#1e1b4b"},{id:"purple",light:"#faf5ff",dark:"#3b0764"},{id:"pink",light:"#fdf2f8",dark:"#500724"},{id:"brown",light:"#fffaf5",dark:"#2d1a10"},{id:"gold",light:"#fef3c7",dark:"#451a03"},{id:"rose",light:"#fff1f2",dark:"#4c0519"},{id:"indigo",light:"#eef2ff",dark:"#312e81"},{id:"slate",light:"#f1f5f9",dark:"#1e293b"},{id:"gray",light:"#f8fafc",dark:"#0f172a"}],Rn=["#ffffff","#f28b82","#fbbc04","#fff475","#ccff90","#a7ffeb","#cbf0f8","#aecbfa","#d7aefb","#fdcfe8","#e6c9a8","#e8eaed","#6366f1","#ec4899","#f43f5e","#10b981","#f59e0b","#06b6d4","#1e293b","#450a0a","#422006","#064e3b","#134e4a","#1e3a8a","#1e1b4b","#4c1d95","#500724","#27272a","#09090b","#312e81"],Fn=["üòä","üòÇ","ü•∞","üòé","ü§î","üò¥","üî•","‚ú®","üöÄ","üéâ","‚ù§Ô∏è","üëç","üí°","üìÖ","‚úÖ","‚ùå","üîí","üîë","üìå","üé®","üìÅ","üè†","üåü","üåç","üíª","üì±","üçé","üçï","üç∫","üåà","‚òÄÔ∏è","üåô","‚ö°","üíé","üéÅ","üéà","üéµ","üì∑","üîç","üõ∏","üëæ","ü§ñ","üëª","ü¶Ñ","üêæ","üèÄ","‚öΩ","üöó","‚úàÔ∏è","üïπÔ∏è","üéÆ","üé≤","üß©","üé≠","üé¨","üé§","üéß","üéπ","üé∏","üéª","üé∫","üé∑","ü•Å","üèπ","üé£","üöµ","üßó","üßò","üõÅ","üõå","üóùÔ∏è","üõ°Ô∏è","‚öîÔ∏è","üó∫Ô∏è","üïØÔ∏è","‚åõ","‚öñÔ∏è","‚öôÔ∏è","‚öíÔ∏è","üõ†Ô∏è","‚õèÔ∏è","‚õìÔ∏è","üî≠","üî¨","üíä","üíâ","üß¨","ü©∏","üß™","üå°Ô∏è","üß¥","üßπ","üß∫","üßº","üßΩ","ü™£","ü™í","üßª","üõÄ","üöø","üöΩ"],zn=["tag","briefcase","home","user","heart","star","shopping-cart","book","code","coffee","graduation-cap","music","camera","plane","bike","gift","bell","calendar","map-pin","search","folder","database","globe","terminal","cpu","layers","layout","activity","archive","award","bar-chart","bookmark","box","briefcase","check-circle","clock","cloud","compass","edit","external-link","eye","file-text","flag","folder-open","image","info","key","life-buoy","link","list","mail","message-circle","mic","monitor","moon","mouse-pointer","package","paperclip","phone","pie-chart","play","plus","printer","save","send","settings","share-2","shield","shopping-bag","slack","smartphone","speaker","sun","tablet","target","tool","truck","tv","umbrella","video","watch","wifi","zap"];function S(t,e=3e3){const n=document.getElementById("toast");n&&(n.querySelector("div").innerText=t,n.classList.add("show"),setTimeout(()=>n.classList.remove("show"),e))}function ne(t,e=!1){return new Promise(n=>{const o=document.getElementById("prompt-modal"),a=document.getElementById("prompt-input"),i=document.getElementById("prompt-label"),r=document.getElementById("prompt-confirm"),s=document.getElementById("prompt-cancel"),l=document.getElementById("prompt-biometric"),c=document.getElementById("prompt-toggle-visibility");if(!o||!a||!i||!r||!s||!l||!c)return console.error("One or more prompt elements not found."),n(null);i.textContent=t,a.value="",a.type=e?"password":"text",e?(c.classList.remove("hidden"),a.placeholder="Enter password",a.classList.add("text-center","tracking-widest")):(c.classList.add("hidden"),a.placeholder="Type here...",a.classList.remove("text-center","tracking-widest"));const g=localStorage.getItem("cn_bio_enabled")==="true";window.PublicKeyCredential&&g&&e?(l.classList.remove("hidden"),setTimeout(()=>{l.click()},300)):l.classList.add("hidden"),l.onclick=async()=>{try{const h=new Uint8Array(32);window.crypto.getRandomValues(h),await navigator.credentials.get({publicKey:{challenge:h,rpId:window.location.hostname,userVerification:"required",timeout:6e4}}),d(),n({biometric:!0})}catch(h){console.error("Biometric auth failed:",h);try{const x=new Uint8Array(32);window.crypto.getRandomValues(x),await navigator.credentials.create({publicKey:{challenge:x,rp:{name:"Private Notes",id:window.location.hostname},user:{id:new Uint8Array(16),name:"user",displayName:"User"},pubKeyCredParams:[{alg:-7,type:"public-key"}],timeout:6e4,authenticatorSelection:{authenticatorAttachment:"platform"},attestation:"none"}}),d(),n({biometric:!0})}catch(x){console.error("Biometric create failed:",x),S("‚ùå Biometric authentication failed")}}},c.onclick=()=>{a.type==="password"?(a.type="text",c.innerHTML='<i data-lucide="eye"></i>'):(a.type="password",c.innerHTML='<i data-lucide="eye-off"></i>'),z()},o.classList.remove("hidden"),z(),a.focus();const d=()=>{o.classList.add("hidden"),window.removeEventListener("keydown",v)},v=h=>{h.key==="Enter"&&f(),h.key==="Escape"&&m()};window.addEventListener("keydown",v);const f=()=>{const h=a.value;d(),n(h)},m=()=>{d(),n(null)};document.getElementById("prompt-confirm").onclick=f,document.getElementById("prompt-cancel").onclick=m})}function cn(t){if(!t)return!0;const e=t.replace("#",""),n=parseInt(e.substr(0,2),16),o=parseInt(e.substr(2,2),16),a=parseInt(e.substr(4,2),16);return isNaN(n)||isNaN(o)||isNaN(a)?!0:(n*299+o*587+a*114)/1e3<128}function z(){typeof lucide<"u"&&lucide.createIcons&&lucide.createIcons()}const Gt=Object.freeze(Object.defineProperty({__proto__:null,isColorDark:cn,openPrompt:ne,safeCreateIcons:z,showToast:S},Symbol.toStringTag,{value:"Module"}));class dn{constructor(e="notev3_",n="/backup/notes/",o=50){this.basePath=n,this.dbPrefix=e,this.notesPerChunk=o,this.metaFile=e+"meta_v4.bin",this.groupPrefix=e+"group_v4_"}async getOrCreateFolder(e){const n=e.split("/").filter(a=>a);let o="root";for(const a of n){const i=`name = '${a}' and mimeType = 'application/vnd.google-apps.folder' and '${o}' in parents and trashed = false`,s=(await gapi.client.drive.files.list({q:i,fields:"files(id, name)"})).result.files;if(s.length>0)o=s[0].id;else{const l={name:a,mimeType:"application/vnd.google-apps.folder",parents:[o]};o=(await gapi.client.drive.files.create({resource:l,fields:"id"})).result.id}}return o}async calculateHash(e){const n=JSON.stringify(e),o=new TextEncoder().encode(n),a=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(a)).map(r=>r.toString(16).padStart(2,"0")).join("")}async saveChunks(e,n,o,a){console.log(`[Drive] Saving ${e.length} notes in groups of ${this.notesPerChunk}`);const i=`'${a}' in parents and trashed = false`,s=(await gapi.client.drive.files.list({q:i,fields:"files(id, name)"})).result.files||[],l=new Map(s.map(h=>[h.name,h.id]));let c=null;const g=l.get(this.metaFile);if(g)try{const h=gapi.auth.getToken().access_token,x=`https://www.googleapis.com/drive/v3/files/${g}?alt=media`,w=await(await fetch(x,{headers:{Authorization:`Bearer ${h}`}})).json();c=await $.decrypt(w,o)}catch{console.log("Failed to load previous meta.")}const d={},v=[];for(let h=0;h<e.length;h+=this.notesPerChunk)v.push(e.slice(h,h+this.notesPerChunk));for(let h=0;h<v.length;h++){const x=await this.calculateHash(v[h]);d[h]=x;const D=!c||!c.groupHashes||c.groupHashes[h]!==x,w=`${this.groupPrefix}${h.toString().padStart(5,"0")}.bin`;if(D||!l.has(w)){const y=await $.encrypt(v[h],o);await this.uploadFileWithId(w,JSON.stringify(y),a,l.get(w)),console.log(`[Drive] ${l.has(w)?"Updated":"Created"} ${w}`)}}if(c&&c.groupHashes){const h=Object.keys(c.groupHashes).map(Number);for(const x of h)if(x>=v.length){const D=`${this.groupPrefix}${x.toString().padStart(5,"0")}.bin`,w=l.get(D);w&&(await gapi.client.drive.files.delete({fileId:w}),console.log(`[Drive] Deleted orphaned group: ${D}`))}}const f={categories:n,groupHashes:d},m=await $.encrypt(f,o);return await this.uploadFileWithId(this.metaFile,JSON.stringify(m),a,g),console.log("[Drive] Push complete."),v.length}async loadChunks(e,n){const o=`'${e}' in parents and trashed = false`,i=(await gapi.client.drive.files.list({q:o,fields:"files(id, name)"})).result.files||[],r=new Map(i.map(g=>[g.name,g.id])),s=r.get(this.metaFile);if(s)try{const g=gapi.auth.getToken().access_token,d=`https://www.googleapis.com/drive/v3/files/${s}?alt=media`,f=await(await fetch(d,{headers:{Authorization:`Bearer ${g}`}})).json(),m=await $.decrypt(f,n);console.log(`[Drive] Loading v4 data. Groups: ${Object.keys(m.groupHashes).length}`);const h=[],x=Object.keys(m.groupHashes).sort((D,w)=>D-w);for(const D of x){const w=`${this.groupPrefix}${D.toString().padStart(5,"0")}.bin`,y=r.get(w);if(y){const C=`https://www.googleapis.com/drive/v3/files/${y}?alt=media`,N=await(await fetch(C,{headers:{Authorization:`Bearer ${g}`}})).json(),j=await $.decrypt(N,n);h.push(...j)}}return{notes:h,categories:m.categories}}catch(g){console.error("[Drive] v4 Load failed",g)}const l="data_part_",c=i.filter(g=>g.name.startsWith(this.dbPrefix+l)).sort((g,d)=>g.name.localeCompare(d.name));if(c.length>0){console.log(`[Drive] Migrating ${c.length} legacy chunks...`);const g=gapi.auth.getToken().access_token;let d="";for(const v of c){const f=`https://www.googleapis.com/drive/v3/files/${v.id}?alt=media`,m=await fetch(f,{headers:{Authorization:`Bearer ${g}`}});d+=await m.text()}try{const v=JSON.parse(d);return await $.decrypt(v,n)}catch(v){console.error("[Drive] Legacy migration failed",v)}}return null}async uploadFileWithId(e,n,o,a=null){const i={name:e,parents:a?[]:[o]},r=new Blob([n],{type:"application/json"}),s=gapi.auth.getToken().access_token;if(a){const l=`https://www.googleapis.com/upload/drive/v3/files/${a}?uploadType=media`;await fetch(l,{method:"PATCH",headers:{Authorization:`Bearer ${s}`},body:r})}else{const l="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",c=new FormData;c.append("metadata",new Blob([JSON.stringify(i)],{type:"application/json"})),c.append("file",r),await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${s}`},body:c})}}}const un={en:{app_name:"Private Notes",sidebar:{all_notes:"All Notes",tags:"Tags",manage_tags:"Manage Tags",settings:"Settings",install_app:"Install App",system:"System",force_reload:"Force Cleanup & Reload"},header:{search_placeholder:"Search notes...",sync:"Sync Now",install:"Install",new_note:"New Note",view_title_all:"All Notes",view_desc_all:"Organize your thoughts and protect your privacy.",pinned:"Pinned"},notes:{no_notes:"No notes here"},auth:{title:"Protected Vault",desc:"Enter your master password to continue",unlock:"Unlock",setup_title:"Setup your Vault",setup_desc:"Create a master password. Enter it twice to confirm.",create_vault:"Create my Vault",confirm_pass:"Repeat password",pass_placeholder:"Your password",repeat_placeholder:"Repeat password",remember_me:"Remember my password in this browser",problems:"Problems? Force cleanup & reload",password_mismatch:"‚ö†Ô∏è Passwords do not match!",password_short:"Password must be at least 4 chars",vault_created:"‚úÖ Vault created successfully",vault_opened:"Vault opened",incorrect_pass:"‚ùå Incorrect password",setup_pass_first:"‚ö†Ô∏è Enter your password first to configure",bio_success:"‚úÖ Biometrics activated",bio_fail:"‚ùå Biometric auth failed",bio_unlock:"Unlock with Biometrics",bio_setup:"Enable Biometrics / FaceID",use_bio:"Use Biometrics / FaceID"},editor:{title_placeholder:"Note Title",content_placeholder:"Start writing...",saving:"Saving...",saved:"Saved",error_save:"Error saving",delete_confirm:"Delete this note?",close_unsaved:"Close without saving?",tools:{bg_color:"Background Color",text_format:"Text Format"}},settings:{title:"Settings",general:"General",sync:"Cloud Sync",security:"Security",danger:"Advanced Actions",theme:"Visual Theme",light:"Light",dark:"Dark",lang:"Language",maintenance:"Maintenance",installed_version:"Installed Version",sync_status:{connected:"Connected",disconnected:"Disconnected"},connect_drive:"Connect with Google Drive",drive_folder:"Drive Folder Name",drive_folder_hint:"Notes will be encrypted inside this folder.",notes_per_chunk:"Notes per file (Group)",notes_per_chunk_hint:"Defines how many notes are grouped per file.",save_changes:"Save Changes",session_security:"Session Security",logout:"Logout",logout_hint:"Logging out clears the access key from memory.",encryption:"Encryption",algo:"Preferred Algorithm",update_algo:"Update Algorithm",reset_app:"Reset Application",reset_warning:"This will permanently delete all local notes and categories.",reset_confirm_label:'To confirm, type "confirm" below:',reset_btn:"Delete all local data",reset_keyword:"confirm"},categories:{title:"Manage Categories",add_new:"New Category",name_placeholder:"Category Name",icon_label:"Icon",color_label:"Color",password_label:"Password (Optional)",password_hint:"Leave empty for no protection",create:"Create Category",edit:"Edit Category",delete:"Delete",save:"Save Category",delete_confirm:"Delete this category? Notes will be kept but untagged.",no_category:"Uncategorized"},common:{cancel:"Cancel",confirm:"Confirm",search:"Search",search_prompt:"Enter search term:",security_prompt:"Security",security_desc_prompt:"Enter password to continue",restricted_access:"Restricted Access",enter_cat_pass:"Enter password for category",write_here:"Write here..."},biometrics:{title:"Fingerprint / Face ID",desc:"Use biometrics to unlock your vault quickly",enabled:"Enabled",disabled:"Disabled",enable_btn:"Enable",disable_btn:"Disable",setup_prompt:"Enter your master password to enable biometrics",not_supported:"Your device does not support biometrics",success_enable:"‚úÖ Biometrics enabled",success_disable:"üîì Biometrics disabled",fail_enable:"‚ùå Failed to enable biometrics",incorrect_pass:"‚ùå Incorrect password"}},es:{app_name:"Notas Privadas",sidebar:{all_notes:"Todas las notas",tags:"Etiquetas",manage_tags:"Gestionar Etiquetas",settings:"Configuraci√≥n",install_app:"Instalar Aplicaci√≥n",system:"Sistema",force_reload:"Forzar Limpieza y Recarga"},header:{search_placeholder:"Buscar notas...",sync:"Sincronizar",install:"Instalar",new_note:"Nueva Nota",view_title_all:"Todas las notas",view_desc_all:"Organiza tus pensamientos y protege tu privacidad.",pinned:"Destacadas"},notes:{no_notes:"No hay notas aqu√≠"},auth:{title:"B√≥veda Protegida",desc:"Ingresa tu contrase√±a maestra para continuar",unlock:"Desbloquear",setup_title:"Configura tu B√≥veda",setup_desc:"Crea una contrase√±a maestra. Introduce la contrase√±a dos veces para asegurar que es correcta.",create_vault:"Crear mi B√≥veda",confirm_pass:"Repite la contrase√±a",pass_placeholder:"Tu contrase√±a",repeat_placeholder:"Repite la contrase√±a",remember_me:"Recordar mi contrase√±a en este navegador",problems:"¬øProblemas? Forzar limpieza y recarga",password_mismatch:"‚ö†Ô∏è ¬°Las contrase√±as no coinciden!",password_short:"La contrase√±a debe tener al menos 4 caracteres",vault_created:"‚úÖ B√≥veda creada con √©xito",vault_opened:"B√≥veda abierta",incorrect_pass:"‚ùå Contrase√±a incorrecta",setup_pass_first:"‚ö†Ô∏è Ingresa tu contrase√±a primero para configurar",bio_success:"‚úÖ Huella activada",bio_fail:"‚ùå Autenticaci√≥n biom√©trica fallida",bio_unlock:"Desbloquear con Huella",bio_setup:"Activar Huella / FaceID",use_bio:"Usar Huella / FaceID"},editor:{title_placeholder:"T√≠tulo de la nota",content_placeholder:"Empieza a escribir...",saving:"Guardando...",saved:"Guardado",error_save:"Error al guardar",delete_confirm:"¬øEliminar esta nota?",close_unsaved:"¬øCerrar sin guardar?",tools:{bg_color:"Color de Fondo",text_format:"Formato de Texto"}},settings:{title:"Configuraci√≥n",general:"General",sync:"Sincronizaci√≥n Cloud",security:"Seguridad y Sesi√≥n",danger:"Acciones Avanzadas",theme:"Tema Visual",light:"Claro",dark:"Oscuro",lang:"Idioma",maintenance:"Mantenimiento",installed_version:"Versi√≥n Instalada",sync_status:{connected:"Conectado",disconnected:"Desconectado"},connect_drive:"Conectar con Google Drive",drive_folder:"Nombre de carpeta en Drive",drive_folder_hint:"Las notas se guardar√°n encriptadas dentro de esta carpeta.",notes_per_chunk:"Notas por archivo (Grupo)",notes_per_chunk_hint:"Define cu√°ntas notas se agrupar√°n en cada archivo.",save_changes:"Guardar Cambios",session_security:"Seguridad de la Sesi√≥n",logout:"Cerrar Sesi√≥n",logout_hint:"Cerrar la sesi√≥n actual eliminar√° la clave de acceso de la memoria.",encryption:"Encriptaci√≥n",algo:"Algoritmo preferido",update_algo:"Actualizar Algoritmo",reset_app:"Restablecer Aplicaci√≥n",reset_warning:"Esta acci√≥n borrar√° permanentemente todas las notas y categor√≠as almacenadas localmente.",reset_confirm_label:'Para confirmar, escribe "confirmar" a continuaci√≥n:',reset_btn:"Eliminar todos los datos locales",reset_keyword:"confirmar"},categories:{title:"Gestionar Categor√≠as",add_new:"Nueva Categor√≠a",name_placeholder:"Nombre de la categor√≠a",icon_label:"Icono",color_label:"Color",password_label:"Contrase√±a (Opcional)",password_hint:"Dejar vac√≠o para sin protecci√≥n",create:"Crear Categor√≠a",edit:"Editar Categor√≠a",delete:"Eliminar",save:"Guardar Categor√≠a",delete_confirm:"¬øEliminar esta categor√≠a? Las notas se mantendr√°n pero sin etiqueta.",no_category:"Sin categor√≠a"},common:{cancel:"Cancelar",confirm:"Confirmar",search:"Buscar",search_prompt:"Ingresa t√©rmino de b√∫squeda:",security_prompt:"Seguridad",security_desc_prompt:"Ingresa la contrase√±a para continuar",restricted_access:"Acceso Restringido",enter_cat_pass:"Ingresa la contrase√±a para",write_here:"Escribe aqu√≠..."},biometrics:{title:"Huella / Face ID",desc:"Usa biometr√≠a para desbloquear tu b√≥veda r√°pidamente",enabled:"Activado",disabled:"Desactivado",enable_btn:"Activar",disable_btn:"Desactivar",setup_prompt:"Ingresa tu contrase√±a maestra para activar la biometr√≠a",not_supported:"Tu dispositivo no soporta biometr√≠a",success_enable:"‚úÖ Biometr√≠a activada",success_disable:"üîì Biometr√≠a desactivada",fail_enable:"‚ùå Error al activar biometr√≠a",incorrect_pass:"‚ùå Contrase√±a incorrecta"}}};let Xe="en";function qn(){const t=localStorage.getItem("cn_lang"),e=navigator.language.split("-")[0];Xe=t||(e==="es"?"es":"en"),document.documentElement.lang=Xe}function Un(t){un[t]&&(Xe=t,localStorage.setItem("cn_lang",t),document.documentElement.lang=t,location.reload())}function p(t){const e=t.split(".");let n=un[Xe];for(const o of e)if(n=n==null?void 0:n[o],!n)break;return n||t}function pn(){const t=!!(sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3"));return`
    <div id="auth-shield" class="fixed inset-0 z-[100] flex items-center justify-center bg-background/95 backdrop-blur-sm transition-opacity duration-300 ${t?"opacity-0 pointer-events-none":""}" style="${t?"display: none":""}">
        <div class="w-full max-w-sm p-8 space-y-6 bg-card border rounded-lg shadow-lg">
            <div class="text-center space-y-2">
                <div class="mx-auto w-10 h-10 bg-primary rounded-md flex items-center justify-center text-primary-foreground">
                    <i data-lucide="lock" class="w-5 h-5"></i>
                </div>
                <h1 class="text-2xl font-semibold tracking-tight" id="auth-title">${p("auth.title")}</h1>
                <p class="text-sm text-muted-foreground" id="auth-desc">${p("auth.desc")}</p>
            </div>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="password" id="master-password" placeholder="${p("auth.pass_placeholder")}" class="h-11 w-full pl-4 pr-12 text-base">
                    <button type="button" class="absolute right-0 top-0 h-11 w-11 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass" data-target="master-password">
                        <i data-lucide="eye" class="w-4 h-4 icon-show"></i>
                    </button>
                </div>
                <div class="relative group hidden" id="confirm-password-wrapper">
                    <input type="password" id="confirm-password" placeholder="${p("auth.repeat_placeholder")}" class="h-11 w-full pl-4 pr-12 text-base">
                    <button type="button" class="absolute right-0 top-0 h-11 w-11 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass" data-target="confirm-password">
                        <i data-lucide="eye" class="w-4 h-4 icon-show"></i>
                    </button>
                </div>
                
                <div class="flex items-center gap-2 py-1">
                    <input type="checkbox" id="auth-remember" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary">
                    <label for="auth-remember" class="text-xs text-muted-foreground cursor-pointer select-none">${p("auth.remember_me")}</label>
                </div>

                <button id="auth-submit" class="btn-shad btn-shad-primary w-full h-11 font-bold">${p("auth.unlock")}</button>
                
                <button id="auth-biometric" class="hidden btn-shad btn-shad-secondary w-full h-11 font-bold flex items-center justify-center gap-2">
                     <i data-lucide="fingerprint" class="w-5 h-5"></i> <span id="bio-text">${p("auth.use_bio")}</span>
                </button>

                <div id="auth-extra-actions" class="hidden pt-4 border-t border-border/50">
                    <button id="auth-force-reload" class="flex items-center justify-center gap-2 w-full p-3 text-xs text-destructive bg-destructive/5 hover:bg-destructive/10 rounded-lg border border-destructive/10 transition-all font-medium">
                        <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i> ${p("auth.problems")}
                    </button>
                </div>
            </div>
        </div>
    </div>`}async function gn(t){document.getElementById("auth-shield");const e=!localStorage.getItem("cn_master_hash_v3"),n=sessionStorage.getItem("cn_vault_key_v3"),o=localStorage.getItem("cn_vault_key_v3"),a=localStorage.getItem("cn_bio_enabled")==="true",i=localStorage.getItem("cn_remember_me_v3")==="true",r=document.getElementById("auth-biometric");window.PublicKeyCredential&&r&&(r.classList.remove("hidden"),a?document.getElementById("bio-text").innerText=p("auth.bio_unlock"):document.getElementById("bio-text").innerText=p("auth.bio_setup")),e?showSetupPage():n?Te(n,t):o?a?setTimeout(()=>{mn(t).catch(()=>{console.log("Auto-bio failed/cancelled")})},500):i?Te(o,t):showLoginPage():showLoginPage()}async function mn(t){if(localStorage.getItem("cn_bio_enabled")==="true")try{const n=new Uint8Array(32);window.crypto.getRandomValues(n),await navigator.credentials.get({publicKey:{challenge:n,rpId:window.location.hostname,userVerification:"required",timeout:6e4}});const o=localStorage.getItem("cn_vault_key_v3");o?Te(o,t):(S("‚ùå Error: Llave no encontrada. Ingresa contrase√±a."),localStorage.setItem("cn_bio_enabled","false"))}catch(n){console.error(n),S(p("auth.bio_fail"))}else{const n=document.getElementById("master-password").value;if(!n)return S("‚ö†Ô∏è Ingresa tu contrase√±a primero para configurar");const o=await $.hash(n),a=localStorage.getItem("cn_master_hash_v3");if(o!==a)return S("‚ùå Contrase√±a incorrecta");if(!window.PublicKeyCredential)return S("‚ùå Tu dispositivo no soporta biometr√≠a");try{const i=new Uint8Array(32);window.crypto.getRandomValues(i),await navigator.credentials.create({publicKey:{challenge:i,rp:{name:p("app_name"),id:window.location.hostname},user:{id:new Uint8Array(16),name:"user",displayName:"User"},pubKeyCredParams:[{alg:-7,type:"public-key"}],timeout:6e4,authenticatorSelection:{authenticatorAttachment:"platform"},attestation:"none"}}),localStorage.setItem("cn_bio_enabled","true");const r=await $.deriveVaultKey(n);localStorage.setItem("cn_vault_key_v3",r),S("‚úÖ Huella activada"),Te(r,t)}catch(i){console.error(i),S("‚ùå Error al activar biometr√≠a: "+i.message)}}}async function Te(t,e){const n=document.getElementById("auth-shield");n.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>n.style.display="none",300),document.getElementById("app").classList.remove("opacity-0"),sessionStorage.setItem("cn_vault_key_v3",t),await Hn(t),e()}async function Bt(t){const e=document.getElementById("master-password").value,n=document.getElementById("confirm-password").value,o=!localStorage.getItem("cn_master_hash_v3");if(!e)return S("Ingresa una contrase√±a");if(o){if(!n)return S(p("auth.confirm_pass"));if(e!==n)return S(p("auth.password_mismatch"));if(e.length<4)return S(p("auth.password_short"))}const a=await $.hash(e),i=await $.deriveVaultKey(e),r=localStorage.getItem("cn_master_hash_v3"),s=document.getElementById("auth-remember").checked;if(!r)localStorage.setItem("cn_master_hash_v3",a),s&&(localStorage.setItem("cn_vault_key_v3",i),localStorage.setItem("cn_remember_me_v3","true")),Te(i,t),S(p("auth.vault_created"));else if(r===a)s?(localStorage.setItem("cn_vault_key_v3",i),localStorage.setItem("cn_remember_me_v3","true")):!localStorage.getItem("cn_bio_enabled")==="true"&&(localStorage.removeItem("cn_vault_key_v3"),localStorage.removeItem("cn_remember_me_v3")),Te(i,t),S(p("auth.vault_opened"));else return S(p("auth.incorrect_pass"))}const Vn=Object.freeze(Object.defineProperty({__proto__:null,checkAuthStatus:gn,getAuthShieldTemplate:pn,handleBiometricAuth:mn,handleMasterAuth:Bt},Symbol.toStringTag,{value:"Module"}));function Gn(){return`
    <div id="app" class="flex h-screen overflow-hidden opacity-100 transition-opacity duration-300">
        <!-- Sidebar Desktop -->
        <aside class="w-64 hidden md:flex flex-col border-r bg-sidebar">
            <div class="p-6 flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 overflow-hidden" id="sidebar-logo-container">
                    <div class="w-10 h-10 rounded-xl bg-transparent flex items-center justify-center shrink-0">
                        <img src="./favicon.png" alt="Logo" class="w-full h-full object-contain">
                    </div>
                    <div class="sidebar-title-text transition-opacity duration-300">
                        <h1 class="text-sm font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent truncate">${p("app_name")}</h1>
                    </div>
                </div>
                <button id="sidebar-collapse-btn" class="p-2 hover:bg-accent rounded-md text-muted-foreground transition-all shrink-0" title="Contraer men√∫">
                    <i data-lucide="chevrons-left" class="w-4 h-4" id="sidebar-collapse-icon"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto px-4 space-y-8">
                <div class="space-y-1">
                    <button class="nav-link w-full" data-view="all">
                        <i data-lucide="layout-grid" class="w-4 h-4"></i> <span class="sidebar-label text-foreground/90 font-bold">${p("sidebar.all_notes")}</span>
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center justify-between px-4" id="sidebar-categories-header">
                        <h3 class="sidebar-section-title text-[11px] font-bold text-muted-foreground uppercase tracking-wider">${p("sidebar.tags")}</h3>
                    </div>
                    <div id="sidebar-categories" class="space-y-1"></div>
                </div>
            </div>

            <div class="p-6 space-y-2 mt-auto">
                <button id="sidebar-manage-cats" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="tag" class="w-3.5 h-3.5"></i> <span class="sidebar-label">${p("sidebar.manage_tags")}</span>
                </button>
                <button id="settings-trigger" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="settings" class="w-3.5 h-3.5"></i> <span class="sidebar-label">${p("sidebar.settings")}</span>
                </button>
                <button id="sidebar-pwa-install-btn" class="hidden flex items-center gap-3 w-full px-4 py-3 rounded-lg text-sm font-bold text-indigo-600 dark:text-indigo-400 bg-indigo-500/10 hover:bg-indigo-500/20 transition-all">
                    <i data-lucide="download" class="w-4 h-4"></i> <span class="sidebar-label">${p("sidebar.install_app")}</span>
                </button>
                <div class="mt-auto pt-4 border-t border-border/20 px-4">
                    <div id="app-version" class="text-[9px] text-muted-foreground font-mono opacity-50">v3.6.0</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col bg-background relative overflow-hidden h-full">
            <!-- Desktop Header -->
            <header class="hidden md:flex h-16 items-center justify-between px-8 border-b shrink-0">
                <div class="flex items-center gap-4 flex-1">
                    <div class="relative w-full max-w-sm">
                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                        <input type="text" id="search-input" placeholder="${p("header.search_placeholder")}" class="pl-12 h-9 w-full" autocomplete="off">
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="sync-btn" class="p-2 hover:bg-accent rounded-md text-muted-foreground transition-colors" title="${p("header.sync")}">
                        <i data-lucide="refresh-cw" class="w-5 h-5" id="sync-icon"></i>
                    </button>
                    <button id="pwa-install-btn" class="hidden btn-shad btn-shad-outline h-9 px-3">
                        <i data-lucide="download" class="w-4 h-4 mr-2"></i> ${p("header.install")}
                    </button>
                    <button id="add-note-btn" class="btn-shad btn-shad-primary h-9">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> ${p("header.new_note")}
                    </button>
                </div>
            </header>

            <!-- Mobile Top Bar Removed -->

            <!-- Grid -->
            <div id="notes-viewport" class="flex-1 overflow-y-auto p-4 md:p-8 pb-24 md:pb-8">
                <div class="max-w-7xl mx-auto space-y-8">
                    <div class="flex items-end justify-between">
                        <div>
                            <h1 id="view-title" class="text-3xl font-bold tracking-tight">${p("header.view_title_all")}</h1>
                        </div>
                    </div>
                    <div id="notes-grid" class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                </div>
            </div>

            <!-- Mobile Bottom Nav -->
            <nav class="md:hidden fixed bottom-0 left-0 right-0 h-16 bg-background/95 backdrop-blur-2xl border-t flex items-center justify-around z-40 pb-safe">
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-sidebar-trigger-bottom">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors nav-link-mobile" data-view="all">
                    <i data-lucide="home" class="w-6 h-6"></i>
                </button>
                <button class="flex items-center justify-center relative w-full h-full" id="mobile-add-btn">
                    <div class="w-14 h-14 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 text-white rounded-full shadow-xl shadow-indigo-500/40 flex items-center justify-center transform -translate-y-5 hover:scale-105 active:scale-90 transition-all">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </div>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-sync-btn-bottom">
                    <i data-lucide="refresh-cw" class="w-6 h-6"></i>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-search-trigger">
                    <i data-lucide="search" class="w-6 h-6"></i>
                </button>
            </nav>
        </main>

        <!-- Mobile Sidebar Drawer -->
        <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-background/80 backdrop-blur-sm z-[100] hidden">
            <div id="mobile-sidebar-drawer" class="w-[80vw] h-full bg-card border-r flex flex-col animate-in slide-in-from-left duration-300">
                <div class="p-6 flex items-center justify-between border-b">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-transparent flex items-center justify-center shrink-0">
                            <img src="./favicon.png" alt="Logo" class="w-full h-full object-contain">
                        </div>
                        <h1 class="text-sm font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent truncate">${p("app_name")}</h1>
                    </div>
                    <button id="close-mobile-sidebar" class="p-2 hover:bg-accent rounded-md">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-8">
                    <div class="space-y-1">
                        <button class="nav-link-mobile-drawer w-full" data-view="all">
                            <i data-lucide="layout-grid" class="w-4 h-4"></i> ${p("sidebar.all_notes")}
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2" id="mobile-sidebar-categories-header">
                            <h3 class="sidebar-section-title">${p("sidebar.tags")}</h3>
                        </div>
                        <div id="mobile-sidebar-categories" class="space-y-1 px-2"></div>
                    </div>
                </div>
                <div class="p-6 border-t space-y-2">
                    <button id="mobile-pwa-install-btn" class="hidden flex items-center gap-3 w-full p-4 rounded-xl bg-gradient-to-r from-indigo-600 to-violet-600 text-white text-sm font-bold shadow-lg shadow-indigo-500/30">
                        <i data-lucide="download" class="w-5 h-5"></i> ${p("sidebar.install_app")}
                    </button>
                    <button id="mobile-manage-cats" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="tag" class="w-4 h-4"></i> ${p("sidebar.manage_tags")}
                    </button>
                    <button id="mobile-settings-btn" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="settings" class="w-4 h-4"></i> ${p("sidebar.settings")}
                    </button>
                    <div class="pt-4 border-t space-y-3">
                        <div class="flex items-center justify-between px-3">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground/50">${p("sidebar.system")}</span>
                            <span id="mobile-app-version" class="text-[10px] font-bold font-mono px-2 py-0.5 rounded bg-primary/10 text-primary">v3.6.0</span>
                        </div>
                        <button id="mobile-force-reload-btn" class="flex items-center gap-3 w-full p-3 rounded-md bg-destructive/5 text-destructive text-sm font-medium border border-destructive/10">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i> ${p("sidebar.force_reload")}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>`}let At=null,de=null;function Wn(){return`
    <div id="editor-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-background/80 backdrop-blur-sm dialog-overlay"></div>
        <div class="dialog-content max-w-2xl h-[80vh] flex flex-col p-0">
            <div class="flex items-center gap-2 border-b pb-3 px-4 pt-4">
                <button id="close-editor" class="text-muted-foreground hover:text-foreground p-2 -ml-2" title="Volver">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <input type="text" id="edit-title" placeholder="T√≠tulo de la nota"
                    class="bg-transparent text-xl font-bold outline-none border-none placeholder:text-muted-foreground w-full">
                
                <div class="flex items-center gap-1">
                    <button id="note-expand-btn" class="editor-tool hidden md:inline-flex" title="Expandir">
                        <i data-lucide="maximize-2" class="w-5 h-5"></i>
                    </button>
                    <div class="relative">
                        <button id="note-options-btn" class="editor-tool" title="M√°s opciones">
                            <i data-lucide="more-vertical" class="w-5 h-5"></i>
                        </button>
                        <div id="note-options-menu" class="hidden absolute right-0 top-full mt-1 bg-popover border shadow-2xl rounded-xl p-1 z-[120] min-w-[170px]">
                            <button id="opt-copy-all" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors">
                                <i data-lucide="copy" class="w-4 h-4 text-muted-foreground"></i> Copiar todo
                            </button>
                            <button id="opt-download" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors border-b pb-2.5 mb-1.5">
                                <i data-lucide="download" class="w-4 h-4 text-muted-foreground"></i> Descargar .txt
                            </button>
                            <button id="opt-toggle-pin" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors">
                                <i data-lucide="pin" class="w-4 h-4 text-muted-foreground" id="opt-pin-icon"></i> <span id="opt-pin-label">Fijar nota</span>
                            </button>
                            <button id="opt-toggle-lock" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors border-b pb-2.5 mb-1.5">
                                <i data-lucide="lock" class="w-4 h-4 text-muted-foreground" id="opt-lock-icon"></i> <span id="opt-lock-label">Restringir</span>
                            </button>
                             <button id="opt-delete-note" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-destructive/5 text-destructive rounded-md transition-colors font-medium">
                                <i data-lucide="trash-2" class="w-4 h-4"></i> Eliminar nota
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Toolbar (Unified top) -->
            <div class="px-4 border-b py-2 flex items-center bg-muted/20">
                <div class="flex items-center gap-1.5 flex-1 min-w-0 overflow-x-auto no-scrollbar py-0.5">
                    <button data-cmd="bold" class="editor-tool border bg-background shrink-0"><i data-lucide="bold" class="w-4 h-4"></i></button>
                    <button data-cmd="italic" class="editor-tool border bg-background shrink-0"><i data-lucide="italic" class="w-4 h-4"></i></button>
                    <button data-cmd="underline" class="editor-tool border bg-background shrink-0"><i data-lucide="underline" class="w-4 h-4"></i></button>
                    <div class="w-px h-6 bg-border mx-0.5 shrink-0"></div>
                    <button id="checklist-btn" class="editor-tool border bg-background shrink-0"><i data-lucide="check-square" class="w-4 h-4"></i></button>
                    <button id="mobile-checklist-btn" class="hidden editor-tool border bg-background shrink-0"><i data-lucide="check-square" class="w-4 h-4"></i></button>
                    <button data-cmd="insertUnorderedList" class="editor-tool border bg-background shrink-0"><i data-lucide="list" class="w-4 h-4"></i></button>
                    <button data-cmd="insertOrderedList" class="editor-tool border bg-background shrink-0"><i data-lucide="list-ordered" class="w-4 h-4"></i></button>
                    <div class="w-px h-6 bg-border mx-0.5 shrink-0"></div>
                    <button id="add-link" class="editor-tool border bg-background shrink-0"><i data-lucide="link" class="w-4 h-4"></i></button>
                    <button id="mobile-link-btn" class="hidden editor-tool border bg-background shrink-0"><i data-lucide="link" class="w-4 h-4"></i></button>
                    <button id="open-text-colors" class="editor-tool border bg-background shrink-0 relative"><i data-lucide="type" class="w-4 h-4"></i><div class="w-3 h-[2px] bg-red-500 rounded-full absolute bottom-1 right-2"></div></button>
                    <button id="mobile-text-color-btn" class="hidden editor-tool border bg-background shrink-0"><i data-lucide="type" class="w-4 h-4"></i></button>
                    <button id="open-emojis" class="editor-tool hidden md:inline-flex border bg-background shrink-0"><i data-lucide="smile" class="w-4 h-4"></i></button>
                </div>
            </div>

            <div class="flex-1 py-4 overflow-y-auto px-4 relative">
                <div id="edit-content" contenteditable="true"
                    class="min-h-[300px] outline-none text-base leading-relaxed prose prose-slate dark:prose-invert max-w-none"
                    placeholder="Empieza a escribir..."></div>
            </div>

            <div class="border-t py-2 px-4 flex items-center justify-between gap-3 editor-bottom-bar shrink-0">
                <div class="flex items-center gap-2 flex-1 min-w-0">
                    <button id="open-colors" class="editor-tool border border-input bg-background/50 transition-all shrink-0" title="Color de nota">
                        <i data-lucide="palette" class="w-4 h-4"></i>
                    </button>
                    <button id="open-colors-mobile" class="hidden editor-tool border border-input bg-background/50 shrink-0"><i data-lucide="palette" class="w-4 h-4"></i></button>

                    <div class="relative flex-1 min-w-0" id="cat-select-wrapper">
                        <button id="cat-dropdown-trigger"
                            class="h-9 w-full px-2 rounded-md border border-input bg-background/50 text-xs flex items-center justify-between gap-1 hover:bg-accent transition-all">
                            <i data-lucide="tag" id="selected-cat-icon" class="w-3.5 h-3.5 text-muted-foreground/60"></i>
                            <span id="selected-cat-label" class="truncate flex-1 text-left">Sin categor√≠a</span>
                            <i data-lucide="chevron-down" class="w-3 h-3 text-muted-foreground shrink-0"></i>
                        </button>
                        <div id="cat-dropdown-menu"
                            class="absolute bottom-full mb-2 left-0 w-48 bg-popover border rounded-md shadow-xl hidden z-50 py-1 overflow-hidden">
                        </div>
                        <select id="edit-category" class="hidden">
                            <option value="">Sin categor√≠a</option>
                        </select>
                    </div>
                </div>

                <button id="save-note" class="hidden md:flex btn-shad btn-shad-primary h-9 px-6 font-bold">Hecho</button>
                <button id="save-note-mobile" class="md:hidden btn-shad btn-shad-primary h-9 px-4 font-bold">OK</button>
            </div>
            
         </div>
    </div>
    
    <!-- Popovers -->
    <div id="color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="bg-color-grid"></div>
    </div>
    <div id="text-color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="text-color-grid"></div>
    </div>
    <div id="emoji-popover" class="fixed z-[60] hidden popover-content w-80">
        <div class="grid grid-cols-8 gap-2 h-64 overflow-y-auto" id="emoji-grid"></div>
    </div>`}function Kn(t){const e=document.getElementById("editor-modal");document.getElementById("edit-title");const n=document.getElementById("edit-content"),o=document.getElementById("close-editor"),a=document.getElementById("save-note");o.onclick=()=>fe();const i=async()=>{await fe(),t()};a.onclick=i;const r=document.getElementById("save-note-mobile");r&&(r.onclick=i);const s=async()=>{u.editingNoteId&&confirm("¬øEliminar esta nota?")&&(u.notes=u.notes.filter(y=>y.id!==u.editingNoteId),await J(),rt(),t())};document.getElementById("opt-delete-note").onclick=s,document.querySelectorAll(".editor-tool[data-cmd]").forEach(y=>{y.dataset.cmd&&(y.onmousedown=C=>{C.preventDefault(),ke(),document.execCommand(y.dataset.cmd,!1,y.dataset.val||null),ye()})}),Xn(),n.onkeyup=()=>{qe(),ye()},n.onmouseup=()=>{qe(),ye()},n.onfocus=()=>{qe(),ye()};const l=document.getElementById("edit-title");l.onfocus=()=>l.select(),l.onclick=()=>l.select();const c=document.getElementById("note-expand-btn");c.onclick=()=>{const y=e.querySelector(".dialog-content");y.classList.toggle("fullscreen");const C=y.classList.contains("fullscreen");c.innerHTML=`<i data-lucide="${C?"minimize-2":"maximize-2"}" class="w-5 h-5"></i>`,z()};const g=()=>{const y=document.getElementById("opt-toggle-pin").dataset.active==="true";Mt(!y),fe(!1)};document.getElementById("opt-toggle-pin").onclick=y=>{y.stopPropagation(),g()};const d=async()=>{if(document.getElementById("opt-toggle-lock").dataset.active==="true")pt(!1),u.tempEditorPassword=null,fe(!1);else{const C=await ne("Restringir Nota","Crea una contrase√±a para esta nota:");if(C){const H=document.getElementById("opt-toggle-lock");H.dataset.tempHash=await $.hash(C),pt(!0),fe(!1)}}};document.getElementById("opt-toggle-lock").onclick=y=>{y.stopPropagation(),d()};const v=document.getElementById("mobile-checklist-btn");v&&(v.onclick=()=>w());const f=document.getElementById("mobile-link-btn");f&&(f.onclick=()=>D());const m=document.getElementById("mobile-text-color-btn");m&&(m.onclick=y=>{ke(),Me(y,"text-color-popover")});const h=document.getElementById("note-options-btn"),x=document.getElementById("note-options-menu");h.onclick=y=>{y.stopPropagation(),x.classList.toggle("hidden")},document.getElementById("opt-copy-all").onclick=()=>{const y=document.getElementById("edit-content").innerText;navigator.clipboard.writeText(y).then(()=>{S("‚úÖ Contenido copiado"),x.classList.add("hidden")})},document.getElementById("opt-download").onclick=()=>{const y=document.getElementById("edit-title").value||"nota",C=document.getElementById("edit-content").innerText,H=new Blob([C],{type:"text/plain"}),N=URL.createObjectURL(H),j=document.createElement("a");j.href=N,j.download=`${y}.txt`,j.click(),x.classList.add("hidden")},document.addEventListener("click",()=>{x&&x.classList.add("hidden")});const D=async()=>{const y=await ne("Insertar Enlace","Ingresa la URL:");y&&(ke(),document.execCommand("createLink",!1,y.startsWith("http")?y:"https://"+y),n.querySelectorAll("a").forEach(H=>H.target="_blank"))};document.getElementById("add-link").onclick=D,document.getElementById("checklist-btn").onclick=()=>w();const w=()=>{var C;ke();const y=window.getSelection();if(y.rangeCount>0){const N=(C=y.getRangeAt(0).commonAncestorContainer.parentElement)==null?void 0:C.closest("li");N&&N.parentElement.classList.contains("checklist")?N.parentElement.classList.remove("checklist"):(document.execCommand("insertUnorderedList"),setTimeout(()=>{const j=window.getSelection();if(j.rangeCount>0){let R=j.focusNode;for(;R&&R.nodeName!=="UL"&&R!==n;)R=R.parentNode;R&&R.nodeName==="UL"&&(R.classList.add("checklist"),R.querySelectorAll("li").forEach(q=>{q.dataset.checked||(q.dataset.checked="false")}))}},10))}ye()};n.onkeydown=y=>{y.key==="Tab"&&(y.preventDefault(),y.shiftKey?document.execCommand("outdent"):document.execCommand("indent"))},n.addEventListener("click",y=>{const C=y.target.closest(".checklist li");if(C){const H=C.getBoundingClientRect();y.clientX-H.left<35&&(y.preventDefault(),C.dataset.checked=C.dataset.checked==="true"?"false":"true",fe(!1),ye())}}),e.querySelector(".dialog-overlay").onclick=()=>{fe()}}function ye(){document.querySelectorAll(".editor-tool[data-cmd]").forEach(o=>{const a=o.dataset.cmd;try{const i=document.queryCommandState(a);o.classList.toggle("active",i)}catch{}});const t=document.getElementById("opt-toggle-pin");t&&Mt(t.dataset.active==="true");const e=document.getElementById("opt-toggle-lock");e&&pt(e.dataset.active==="true");const n=o=>{const a=document.getElementById(o);if(!a)return;let i=!1;try{const r=window.getSelection();if(r.rangeCount>0){let s=r.anchorNode;for(;s&&s.id!=="edit-content";){if(s.nodeName==="UL"&&s.classList.contains("checklist")){i=!0;break}s=s.parentNode}}}catch{}a.classList.toggle("active",i)};n("checklist-btn"),n("mobile-checklist-btn")}function ze(t=null){const e=document.getElementById("editor-modal"),n=document.getElementById("edit-title"),o=document.getElementById("edit-content"),a=document.getElementById("edit-category"),i=e.querySelector(".dialog-content");u.editingNoteId=t?t.id:null,n.value=(t==null?void 0:t.title)||"",o.innerHTML=(t==null?void 0:t.content)===void 0||(t==null?void 0:t.content)==="undefined"?"":(t==null?void 0:t.content)||"";let r="";!t&&u.currentView!=="all"&&(r=u.currentView),a.value=t?t.categoryId||"":r;const s=Ye.find(d=>d.id===(t?t.themeId:"default"))||Ye[0],l=u.settings.theme==="dark"?s.dark:s.light,c=s.id==="default"?u.settings.theme==="dark":cn(l);i.style.backgroundColor=l,i.style.color=c?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",i.dataset.themeId=s.id,n.style.color=c?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",o.style.color=c?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",e.querySelectorAll(".editor-tool:not(.active), #cat-dropdown-trigger").forEach(d=>{d.style.color=c?"rgba(255,255,255,0.7)":"rgba(0,0,0,0.7)",d.style.borderColor=c?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",d.style.backgroundColor=c?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}),e.querySelectorAll(".editor-tool.active").forEach(d=>{d.style.backgroundColor="",d.style.color="",d.style.borderColor=""}),Mt(t?t.pinned:!1),pt(t?!!t.passwordHash:!1),Yn(),e.classList.remove("hidden"),o.focus(),de={title:(t==null?void 0:t.title)||"",content:(t==null?void 0:t.content)===void 0||(t==null?void 0:t.content)==="undefined"?"":(t==null?void 0:t.content)||"",categoryId:t?t.categoryId||"":r,pinned:t?t.pinned:!1,themeId:s.id,passwordHash:t?t.passwordHash:null}}function rt(){const t=document.getElementById("editor-modal"),e=t.querySelector(".dialog-content");e.classList.add("dialog-hide"),setTimeout(()=>{t.classList.add("hidden"),e.classList.remove("dialog-hide"),u.editingNoteId=null,u.tempEditorPassword=null;const n=document.getElementById("opt-toggle-lock");n&&(n.dataset.tempHash=""),document.getElementById("edit-title").value="",document.getElementById("edit-content").innerHTML="",window.refreshUI&&window.refreshUI()},200)}async function fe(t=!0){const e=document.getElementById("edit-title"),n=document.getElementById("edit-content"),o=document.getElementById("edit-category"),a=document.querySelector("#editor-modal .dialog-content");if(!e||!n)return;let i=e.value.trim();const r=n.innerHTML,s=o?o.value:"",l=a?a.dataset.themeId:"default";if(!i&&(!r||r.trim()===""||r==="<br>")){if(u.editingNoteId){const w=u.notes.findIndex(y=>y.id===u.editingNoteId);w>=0&&(u.notes.splice(w,1),await J(),window.refreshUI&&window.refreshUI(),window.triggerAutoSync&&window.triggerAutoSync())}t&&rt();return}if(!i){const w=new Date;i=w.getFullYear()+"-"+String(w.getMonth()+1).padStart(2,"0")+"-"+String(w.getDate()).padStart(2,"0")+", "+String(w.getHours()).padStart(2,"0")+":"+String(w.getMinutes()).padStart(2,"0")}const g=u.notes.findIndex(w=>w.id===u.editingNoteId),d=document.getElementById("opt-toggle-pin"),v=document.getElementById("opt-toggle-lock"),f=d?d.dataset.active==="true":!1,m=v?v.dataset.active==="true":!1,h=v&&v.dataset.tempHash||"",x=m?h||(g>=0?u.notes[g].passwordHash:null):null;if(de&&u.editingNoteId&&i===de.title&&r===de.content&&s===de.categoryId&&f===de.pinned&&l===de.themeId&&x===de.passwordHash&&t){rt();return}const D={id:u.editingNoteId||Date.now().toString(),title:i,content:r,categoryId:s||null,pinned:f,themeId:l||"default",passwordHash:x,updatedAt:Date.now()};if(m&&!D.passwordHash){const w=await ne("Seguridad","Establece una contrase√±a para esta nota:");if(w)D.passwordHash=await $.hash(w);else return}g>=0?u.notes[g]=D:u.notes.unshift(D),u.editingNoteId||(u.editingNoteId=D.id),await J(),t&&rt(),window.refreshUI&&window.refreshUI(),setTimeout(()=>{window.triggerAutoSync&&window.triggerAutoSync()},50)}function qe(){const t=window.getSelection();t.rangeCount>0&&(At=t.getRangeAt(0))}function ke(){if(At){const t=window.getSelection();t.removeAllRanges(),t.addRange(At)}}function Yn(){const t=document.getElementById("edit-category").value,e=u.categories.find(n=>n.id===t);document.getElementById("selected-cat-label")&&(document.getElementById("selected-cat-label").innerText=e?e.name:"Sin categor√≠a"),document.getElementById("selected-cat-icon")&&(document.getElementById("selected-cat-icon").setAttribute("data-lucide",e&&e.icon||"tag"),z())}function Mt(t){const e=document.getElementById("opt-toggle-pin");if(!e)return;e.dataset.active=t.toString();const n=document.getElementById("opt-pin-label"),o=document.getElementById("opt-pin-icon");n&&(n.innerText=t?"Desfijar nota":"Fijar nota"),o&&o.setAttribute("class",t?"w-4 h-4 text-violet-600":"w-4 h-4 text-muted-foreground"),e.classList.toggle("menu-active-violet",t)}function pt(t){const e=document.getElementById("opt-toggle-lock");if(!e)return;e.dataset.active=t.toString();const n=document.getElementById("opt-lock-label"),o=document.getElementById("opt-lock-icon");n&&(n.innerText=t?"Quitar restricci√≥n":"Restringir"),o&&(o.setAttribute("data-lucide",t?"lock":"lock-open"),o.setAttribute("class",t?"w-4 h-4 text-violet-600":"w-4 h-4 text-muted-foreground")),e.classList.toggle("menu-active-violet",t),z()}function Xn(){document.getElementById("open-colors").onclick=s=>Me(s,"color-popover");const t=document.getElementById("open-colors-mobile");t&&(t.onclick=s=>Me(s,"color-popover")),document.getElementById("open-text-colors").onmousedown=s=>{s.preventDefault(),qe()},document.getElementById("open-text-colors").onclick=s=>Me(s,"text-color-popover");const e=s=>{s.preventDefault(),qe(),Me(s,"emoji-popover")};document.getElementById("open-emojis").onmousedown=s=>s.preventDefault(),document.getElementById("open-emojis").onclick=e;const n=document.getElementById("mobile-open-emojis");n&&(n.onmousedown=s=>s.preventDefault(),n.onclick=e);const o=document.getElementById("bg-color-grid");Ye.forEach(s=>{const l=document.createElement("div");l.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",l.style.backgroundColor=u.settings.theme==="dark"?s.dark:s.light,l.onclick=()=>{const c=document.querySelector("#editor-modal .dialog-content");c.style.backgroundColor=u.settings.theme==="dark"?s.dark:s.light,c.dataset.themeId=s.id,He()},o.appendChild(l)});const a=document.getElementById("text-color-grid");Rn.forEach(s=>{const l=document.createElement("div");l.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",l.style.backgroundColor=s,l.onmousedown=c=>c.preventDefault(),l.onclick=()=>{ke(),document.execCommand("foreColor",!1,s),He()},a.appendChild(l)});const i=document.getElementById("emoji-grid");Fn.forEach(s=>{const l=document.createElement("span");l.className="cursor-pointer hover:bg-accent p-2 rounded text-xl text-center",l.innerText=s,l.onclick=()=>{ke(),document.execCommand("insertHTML",!1,s),He()},i.appendChild(l)}),document.addEventListener("click",s=>{!s.target.closest(".editor-tool")&&!s.target.closest(".popover-content")&&!s.target.closest("#cat-dropdown-trigger")&&He()});const r=document.getElementById("cat-dropdown-trigger");r.onclick=s=>{s.stopPropagation(),document.getElementById("cat-dropdown-menu").classList.toggle("hidden")}}function Me(t,e){t.stopPropagation();const n=document.getElementById(e),o=t.currentTarget.getBoundingClientRect();He(e),n.classList.remove("hidden"),window.innerHeight-o.bottom<250?(n.style.top="auto",n.style.bottom=`${window.innerHeight-o.top+8}px`):(n.style.top=`${o.bottom+8}px`,n.style.bottom="auto"),n.style.left=`${Math.min(o.left,window.innerWidth-n.offsetWidth-20)}px`,o.left+300>window.innerWidth&&(n.style.left="auto",n.style.right="20px")}function He(t=null){["color-popover","text-color-popover","emoji-popover","cat-dropdown-menu"].forEach(e=>{const n=document.getElementById(e);e!==t&&n&&n.classList.add("hidden")})}function Jn(){return`
    <div id="categories-modal" class="fixed inset-0 z-[70] hidden">
        <div class="dialog-overlay close-categories"></div>
        <div class="dialog-content w-full h-full md:max-w-none md:h-full md:rounded-none rounded-none flex flex-col shadow-2xl p-0 overflow-hidden">
            <div class="p-6 md:p-10 flex justify-between items-center border-b bg-background/50 backdrop-blur-md sticky top-0 z-10">
                <div>
                    <h2 class="text-2xl md:text-4xl font-bold text-foreground">${p("categories.title")}</h2>
                    <p class="text-xs md:text-base text-muted-foreground">${p("categories.name_placeholder")}</p>
                </div>
                <button class="close-categories p-3 hover:bg-accent rounded-full transition-colors"><i data-lucide="x" class="w-8 h-8"></i></button>
            </div>

            <div class="p-4 md:p-10 bg-muted/20 border-b">
                <div class="flex items-center gap-4 max-w-3xl mx-auto w-full">
                    <div class="relative flex-1">
                        <i data-lucide="tag" class="absolute left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-foreground/50"></i>
                        <input type="text" id="new-cat-name" placeholder="${p("categories.add_new")}..." 
                               class="pl-14 h-14 md:h-16 w-full bg-background border-none ring-1 ring-border focus:ring-2 focus:ring-violet-500 rounded-2xl transition-all text-lg" autocomplete="off">
                    </div>
                    <button id="add-cat-btn" class="w-14 h-14 md:w-16 md:h-16 bg-violet-600 hover:bg-violet-700 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-violet-500/20 active:scale-95 transition-all">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4 md:p-10 space-y-4 max-w-3xl mx-auto w-full" id="cat-manager-list">
                <!-- Items injected here -->
            </div>
            
            <div class="p-6 border-t bg-background/50 backdrop-blur-md sticky bottom-0">
                <button class="close-categories w-full md:max-w-xs mx-auto block h-14 bg-secondary text-secondary-foreground font-bold rounded-2xl hover:bg-secondary/80 transition-all text-lg underline">Cerrar</button>
            </div>
        </div>
        <div id="cat-icon-picker" class="fixed z-[80] hidden popover-content p-4 w-72 max-h-80 overflow-y-auto bg-popover border shadow-2xl rounded-3xl backdrop-blur-3xl">
            <div class="grid grid-cols-5 gap-3 p-1" id="cat-icons-grid"></div>
        </div>
    </div>`}function Je(t,e=null){const n=document.getElementById("cat-manager-list");n&&(n.innerHTML="",e&&(u.categories=e),u.categories.forEach(o=>{const a=document.createElement("div");a.className="flex items-center gap-3 p-2 rounded-lg border bg-card/50 hover:bg-accent/30 transition-all group",a.innerHTML=`
            <div class="w-12 h-12 rounded-xl cursor-pointer hover:bg-accent border bg-background flex items-center justify-center shrink-0 transition-all active:scale-95" 
                 id="icon-trigger-${o.id}" title="Cambiar icono">
                 <i data-lucide="${o.icon||"tag"}" class="w-5 h-5 text-foreground/80"></i>
            </div>
            
            <div class="flex flex-col flex-1 min-w-0">
                <input type="text" value="${o.name}" 
                       class="bg-transparent border-none outline-none font-bold text-base w-full focus:ring-0 transition-colors h-7 px-0 rounded"
                       id="cn-${o.id}" autocomplete="off">
                <span class="text-[10px] text-muted-foreground uppercase tracking-widest font-medium">${o.passwordHash?"Restringida":"P√∫blica"}</span>
            </div>
            
            <div class="flex items-center gap-2">
                <button class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-violet-500/10 transition-all ${o.passwordHash?"text-violet-500 bg-violet-500/5 border border-violet-500/20":"text-muted-foreground border border-transparent"}"
                        id="lock-${o.id}" title="${o.passwordHash?"Restringido":"Restricci√≥n"}">
                    <i data-lucide="${o.passwordHash?"lock":"unlock"}" class="w-4 h-4"></i>
                </button>
                <button class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-destructive/10 hover:text-destructive text-muted-foreground border border-transparent transition-all"
                        id="del-${o.id}" title="Eliminar">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        `,n.appendChild(a),document.getElementById(`icon-trigger-${o.id}`).onclick=r=>{r.stopPropagation(),Zn(o.id,t,r.currentTarget)};const i=document.getElementById(`cn-${o.id}`);i.oninput=r=>{o.name=r.target.value,t()},i.onchange=async()=>{await J(),t(),window.triggerAutoSync&&window.triggerAutoSync()},document.getElementById(`lock-${o.id}`).onclick=()=>eo(o.id,t),document.getElementById(`del-${o.id}`).onclick=()=>Qn(o.id,t)}),z())}async function Zn(t,e,n){const o=u.categories.find(l=>l.id===t);if(!o)return;const a=document.getElementById("cat-icon-picker"),i=document.getElementById("cat-icons-grid");i.innerHTML="",zn.forEach(l=>{const c=document.createElement("button");c.className="w-9 h-9 flex items-center justify-center rounded-md hover:bg-primary/10 hover:text-primary transition-all text-muted-foreground",c.innerHTML=`<i data-lucide="${l}" class="w-5 h-5"></i>`,c.onclick=async()=>{o.icon=l,await J(),Je(e),e(),a.classList.add("hidden"),window.triggerAutoSync&&window.triggerAutoSync()},i.appendChild(c)}),z();const r=n.getBoundingClientRect();a.style.top=`${r.bottom+8}px`,a.style.left=`${r.left}px`,a.classList.remove("hidden");const s=l=>{!a.contains(l.target)&&!n.contains(l.target)&&(a.classList.add("hidden"),document.removeEventListener("click",s))};setTimeout(()=>document.addEventListener("click",s),10)}async function Qn(t,e){const n=u.categories.find(o=>o.id===t);if(n){if(n.passwordHash){const o=await ne("Seguridad","Etiqueta restringida. Ingresa contrase√±a para eliminar:");if(!o)return;if(await $.hash(o)!==n.passwordHash)return S("‚ùå Error: Contrase√±a incorrecta")}confirm(`¬øEliminar la etiqueta "${n.name}"? Las notas no se borrar√°n.`)&&(u.categories=u.categories.filter(o=>o.id!==t),u.notes.forEach(o=>{o.categoryId===t&&(o.categoryId=null)}),u.currentView===t&&(u.currentView="all"),await J(),Je(e),e(),window.triggerAutoSync&&window.triggerAutoSync())}}async function eo(t,e){const n=u.categories.find(o=>o.id===t);if(n){if(n.passwordHash){const o=await ne("Seguridad","Ingresa la contrase√±a para quitar la restricci√≥n:");if(!o)return;if(await $.hash(o)!==n.passwordHash)return S("‚ùå Error: Contrase√±a incorrecta");n.passwordHash=null,S("üîì Restricci√≥n quitada")}else{const o=await ne("Seguridad","Define una contrase√±a para restringir esta etiqueta:");o&&(n.passwordHash=await $.hash(o),S("üîí Etiqueta restringida"))}await J(),Je(e),e(),window.triggerAutoSync&&window.triggerAutoSync()}}function to(){return`
    <div id="settings-modal" class="fixed inset-0 z-[80] hidden">
        <div class="dialog-overlay"></div>
        <div class="dialog-content w-full h-full md:w-auto md:max-w-2xl md:h-[500px] p-0 overflow-hidden flex flex-col md:flex-row rounded-none md:rounded-xl">
            <!-- Sidebar Settings -->
            <div id="settings-sidebar" class="w-full md:w-48 bg-muted/50 border-b md:border-b-0 md:border-r p-4 flex flex-col gap-2 overflow-y-auto">
                <div class="flex items-center justify-between mb-4 md:hidden">
                    <h3 class="font-bold text-2xl">${p("settings.title")}</h3>
                    <button class="close-settings p-2 hover:bg-accent rounded-full">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <button class="settings-tab py-4 md:py-3 px-4 text-lg md:text-base flex items-center gap-4 md:gap-2 active-highlight" data-tab="appearance">
                    <i data-lucide="palette" class="w-6 h-6 md:w-5 md:h-5"></i> ${p("settings.general")}
                </button>
                <button class="settings-tab py-4 md:py-3 px-4 text-lg md:text-base flex items-center gap-4 md:gap-2" data-tab="sync">
                    <i data-lucide="refresh-cw" class="w-6 h-6 md:w-5 md:h-5"></i> ${p("settings.sync")}
                </button>
                <button class="settings-tab py-4 md:py-3 px-4 text-lg md:text-base flex items-center gap-4 md:gap-2" data-tab="security">
                    <i data-lucide="shield" class="w-6 h-6 md:w-5 md:h-5"></i> ${p("settings.security")}
                </button>
                <button class="settings-tab text-destructive mt-auto py-4 md:py-3 px-4 text-lg md:text-base flex items-center gap-4 md:gap-2" data-tab="danger">
                    <i data-lucide="alert-triangle" class="w-6 h-6 md:w-5 md:h-5"></i> ${p("settings.danger")}
                </button>
            </div>

            <!-- Content Area -->
            <div class="flex-1 flex flex-col min-w-0" id="settings-content-area">
                <div class="p-6 md:p-4 border-b flex items-center gap-3">
                    <button class="md:hidden p-3 hover:bg-accent rounded-xl group" id="settings-back-btn">
                        <i data-lucide="arrow-left" class="w-6 h-6 text-muted-foreground group-hover:text-foreground"></i>
                    </button>
                    <h2 id="settings-tab-title" class="font-bold text-xl md:text-base flex-1">${p("settings.title")}</h2>
                    <button class="close-settings p-3 md:p-2 hover:bg-accent rounded-xl group">
                        <i data-lucide="x" class="w-6 h-6 md:w-5 md:h-5 text-muted-foreground group-hover:text-foreground"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-6" id="settings-panels">
                    <!-- Panel: Apariencia -->
                    <div id="panel-appearance" class="settings-panel space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${p("settings.lang")}</h3>
                            <div class="space-y-2">
                                <select id="language-select" class="h-12 md:h-10 w-full px-4 rounded-xl border bg-background text-lg md:text-sm">
                                    <option value="en">üá∫üá∏ English</option>
                                    <option value="es">üá™üá∏ Espa√±ol</option>
                                    <option value="fr">üá´üá∑ Fran√ßais</option>
                                    <option value="de">üá©üá™ Deutsch</option>
                                    <option value="it">üáÆüáπ Italiano</option>
                                    <option value="pt">üáµüáπ Portugu√™s</option>
                                    <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                    <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                                    <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                                    <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                                    <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                                    <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                                </select>
                            </div>
                        </section>

                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${p("settings.theme")}</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <button id="theme-light" class="flex flex-col items-center gap-3 p-6 rounded-2xl border bg-card hover:bg-accent transition-all group">
                                    <div class="w-full aspect-video bg-zinc-100 rounded-xl border flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-300 rounded"></div>
                                    </div>
                                    <span class="text-sm font-medium">${p("settings.light")}</span>
                                </button>
                                <button id="theme-dark" class="flex flex-col items-center gap-3 p-6 rounded-2xl border bg-zinc-950 hover:bg-zinc-900 transition-all group ring-primary">
                                    <div class="w-full aspect-video bg-zinc-800 rounded-xl border border-zinc-700 flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-600 rounded"></div>
                                    </div>
                                    <span class="text-sm font-medium text-white">${p("settings.dark")}</span>
                                </button>
                            </div>
                        </section>

                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${p("settings.maintenance")}</h3>
                            <div class="p-6 rounded-2xl border bg-primary/5 space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium">${p("settings.installed_version")}</span>
                                    <span class="text-sm font-bold font-mono text-primary" id="settings-version-display">v3.6.0</span>
                                </div>
                                <button id="force-reload-btn-settings" class="btn-shad btn-shad-outline w-full h-12 flex items-center justify-center gap-2 group text-base rounded-xl">
                                    <i data-lucide="refresh-cw" class="w-5 h-5 group-hover:rotate-180 transition-transform duration-500"></i>
                                    ${p("sidebar.force_reload")}
                                </button>
                            </div>
                        </section>
                    </div>

                    <!-- Panel: Sincronizaci√≥n -->
                    <div id="panel-sync" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Google Drive</h3>
                                <div id="drive-status" class="text-[10px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground font-bold uppercase">${p("settings.sync_status.disconnected")}</div>
                            </div>
                            
                            <button id="connect-drive-btn" class="btn-shad btn-shad-outline w-full h-12 flex items-center justify-center gap-2 text-base rounded-xl">
                                <i data-lucide="link" class="w-5 h-5"></i> ${p("settings.connect_drive")}
                            </button>

                            <div class="space-y-3 pt-4 border-t border-dashed">
                                <label class="text-sm font-medium">${p("settings.drive_folder")}</label>
                                <input type="text" id="config-drive-path" class="h-12 px-5 w-full rounded-xl" placeholder="p.ej. CloudNotesV3" autocomplete="off">
                                <p class="text-xs text-muted-foreground">${p("settings.drive_folder_hint")}</p>
                            </div>
                            <div class="space-y-3">
                                <label class="text-sm font-medium">${p("settings.notes_per_chunk")}</label>
                                <div class="flex items-center gap-3">
                                    <input type="number" id="config-notes-per-chunk" class="h-12 px-5 w-full rounded-xl" placeholder="50" min="10" max="500">
                                    <span class="text-xs text-muted-foreground shrink-0 font-bold uppercase">Notas</span>
                                </div>
                            </div>
                            <button id="save-sync-config" class="btn-shad btn-shad-primary w-full h-14 text-lg font-bold rounded-2xl shadow-lg shadow-primary/20 transition-all active:scale-95">${p("settings.save_changes")}</button>
                        </section>
                    </div>

                    <!-- Panel: Seguridad -->
                    <div id="panel-security" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${p("biometrics.title")}</h3>
                            <div class="p-6 rounded-2xl border space-y-4" id="bio-settings-container">
                                <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                                    <div class="flex-1">
                                        <p class="text-lg font-bold md:text-base">${p("biometrics.title")}</p>
                                        <p class="text-sm text-muted-foreground mt-1">${p("biometrics.desc")}</p>
                                        <div class="mt-3 flex items-center gap-2">
                                            <div id="bio-status-badge" class="text-xs px-3 py-1.5 rounded-full bg-muted text-muted-foreground font-bold uppercase tracking-wider">
                                                ${p("biometrics.disabled")}
                                            </div>
                                        </div>
                                    </div>
                                    <button id="toggle-biometric-btn" class="btn-shad btn-shad-primary w-full md:w-auto h-14 md:h-11 px-8 flex items-center justify-center gap-3 shrink-0 rounded-2xl md:rounded-xl text-lg md:text-sm font-bold shadow-lg shadow-primary/20 active:scale-95">
                                        <i data-lucide="fingerprint" class="w-6 h-6 md:w-5 md:h-5"></i>
                                        <span id="bio-toggle-text">${p("biometrics.enable_btn")}</span>
                                    </button>
                                </div>
                            </div>
                        </section>
                        
                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${p("settings.session_security")}</h3>
                            <div class="p-6 rounded-2xl border bg-muted/20 space-y-4">
                                <p class="text-sm text-muted-foreground">${p("settings.logout_hint")}</p>
                                <button id="logout-btn" class="btn-shad bg-destructive/10 text-destructive hover:bg-destructive hover:text-white w-full h-14 md:h-12 flex items-center justify-center gap-3 transition-all rounded-2xl text-lg font-bold">
                                    <i data-lucide="log-out" class="w-6 h-6 md:w-5 md:h-5"></i> ${p("settings.logout")}
                                </button>
                            </div>
                        </section>
                        
                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">${p("settings.encryption")}</h3>
                            <div class="space-y-3">
                                <label class="text-sm font-medium">${p("settings.algo")}</label>
                                <select id="config-algo" class="h-12 md:h-10 w-full px-4 rounded-xl">
                                    <option value="aes-256-gcm">AES-256-GCM (Recommended)</option>
                                    <option value="kyber">CRYSTALS-Kyber (Experimental)</option>
                                </select>
                            </div>
                             <button id="save-security-config" class="btn-shad btn-shad-primary w-full h-14 font-bold rounded-2xl text-lg shadow-lg shadow-primary/20 transition-all active:scale-95">${p("settings.update_algo")}</button>
                        </section>
                    </div>

                    <!-- Panel: Danger Zone -->
                    <div id="panel-danger" class="settings-panel hidden space-y-6">
                        <section class="p-4 rounded-lg border border-destructive/20 bg-destructive/5 space-y-4">
                            <h3 class="text-sm font-semibold text-destructive uppercase tracking-wider">${p("settings.reset_app")}</h3>
                            <p class="text-xs text-muted-foreground underline">${p("settings.reset_warning")}</p>
                            <div class="space-y-2">
                                <label class="text-[10px] uppercase font-bold text-destructive/70">${p("settings.reset_confirm_label")}</label>
                                <input type="text" id="factory-reset-confirm" class="h-10 px-4 mt-1 w-full border rounded-md" placeholder="${p("settings.reset_keyword")}" autocomplete="off">
                            </div>
                            <button id="factory-reset" class="btn-shad bg-destructive text-destructive-foreground hover:bg-destructive/90 w-full h-10 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i> ${p("settings.reset_btn")}
                            </button>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>`}function no(){const t=document.querySelectorAll(".settings-panel"),e=document.querySelectorAll(".settings-tab"),n=document.getElementById("settings-tab-title"),o=document.getElementById("settings-sidebar"),a=o.nextElementSibling,i=document.getElementById("settings-back-btn"),r=m=>{e.forEach(x=>x.classList.toggle("active",x.dataset.tab===m)),t.forEach(x=>x.classList.toggle("hidden",x.id!==`panel-${m}`));const h={appearance:p("settings.general"),sync:p("settings.sync"),security:p("settings.security"),danger:p("settings.danger")};n.innerText=h[m]||p("settings.title"),window.innerWidth<768&&(o.classList.add("hidden"),a.classList.remove("hidden"),i.classList.remove("hidden")),z()};e.forEach(m=>{m.onclick=()=>r(m.dataset.tab)}),i.onclick=()=>{o.classList.remove("hidden"),a.classList.add("hidden"),i.classList.add("hidden"),n.innerText="Configuraci√≥n"},window.innerWidth<768?(a.classList.add("hidden"),i.classList.add("hidden"),e.forEach(m=>m.classList.remove("active"))):r("appearance");const s=document.getElementById("force-reload-btn"),l=document.getElementById("force-reload-btn-settings");s&&(s.onclick=Lt),l&&(l.onclick=Lt);const c=document.getElementById("language-select");c&&(c.value=Xe,c.onchange=m=>Un(m.target.value));const g=document.getElementById("toggle-biometric-btn"),d=document.getElementById("bio-status-badge"),v=document.getElementById("bio-toggle-text"),f=document.getElementById("bio-settings-container");if(g){const m=()=>{localStorage.getItem("cn_bio_enabled")==="true"?(d.textContent=p("biometrics.enabled"),d.classList.remove("bg-muted","text-muted-foreground"),d.classList.add("bg-primary/20","text-primary"),v.textContent=p("biometrics.disable_btn"),g.classList.remove("btn-shad-primary"),g.classList.add("btn-shad-outline"),f.classList.add("bg-primary/5")):(d.textContent=p("biometrics.disabled"),d.classList.remove("bg-primary/20","text-primary"),d.classList.add("bg-muted","text-muted-foreground"),v.textContent=p("biometrics.enable_btn"),g.classList.remove("btn-shad-outline"),g.classList.add("btn-shad-primary"),f.classList.remove("bg-primary/5")),z()};m(),g.onclick=async()=>{if(localStorage.getItem("cn_bio_enabled")==="true"){localStorage.setItem("cn_bio_enabled","false"),m();const{showToast:x}=await it(async()=>{const{showToast:D}=await Promise.resolve().then(()=>Gt);return{showToast:D}},void 0);x(p("biometrics.success_disable"))}else{const{showToast:x,openPrompt:D}=await it(async()=>{const{showToast:w,openPrompt:y}=await Promise.resolve().then(()=>Gt);return{showToast:w,openPrompt:y}},void 0);if(!window.PublicKeyCredential)return x(p("biometrics.not_supported"));try{const w=await D(p("biometrics.setup_prompt"),!0);if(!w||w.biometric)return;const{SecurityService:y}=await it(async()=>{const{SecurityService:R}=await Promise.resolve().then(()=>Mn);return{SecurityService:R}},void 0),C=await y.hash(w),H=localStorage.getItem("cn_master_hash_v3");if(C!==H)return x(p("biometrics.incorrect_pass"));const N=new Uint8Array(32);window.crypto.getRandomValues(N),await navigator.credentials.create({publicKey:{challenge:N,rp:{name:p("app_name"),id:window.location.hostname},user:{id:new Uint8Array(16),name:"user",displayName:"User"},pubKeyCredParams:[{alg:-7,type:"public-key"}],timeout:6e4,authenticatorSelection:{authenticatorAttachment:"platform"},attestation:"none"}});const j=await y.deriveVaultKey(w);localStorage.setItem("cn_vault_key_v3",j),localStorage.setItem("cn_bio_enabled","true"),m(),x(p("biometrics.success_enable"))}catch(w){console.error(w),x(p("biometrics.fail_enable")+": "+w.message)}}}}}async function Lt(){if(confirm("Esto reiniciar√° la aplicaci√≥n, limpiar√° la cach√© y eliminar√° el Service Worker para forzar la √∫ltima versi√≥n. ¬øContinuar?"))try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const n of e)await n.unregister()}if("caches"in window){const e=await caches.keys();for(const n of e)await caches.delete(n)}sessionStorage.clear();const t=new URL(window.location.href);t.searchParams.set("t",Date.now()),window.location.href=t.toString()}catch(t){console.error("Error clearing cache:",t),window.location.reload()}}function oo(){return`
    <!-- Prompt Modal -->
    <div id="prompt-modal" class="fixed inset-0 z-[250] hidden flex items-start justify-center pt-24 md:pt-0 md:items-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="relative w-full max-w-[340px] bg-card border shadow-2xl rounded-2xl p-6 space-y-6 animate-in zoom-in-95 duration-200">
            <div class="space-y-2">
                <h2 id="prompt-title" class="text-xl font-bold tracking-tight">Seguridad</h2>
                <p id="prompt-desc" class="text-sm text-muted-foreground leading-relaxed">Ingresa la contrase√±a para continuar</p>
            </div>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="password" id="prompt-input" placeholder="Tu contrase√±a"
                        class="h-12 w-full text-center tracking-widest outline-none pr-12 bg-muted/50 border border-border focus:border-indigo-500/50 transition-all rounded-xl">
                    <button type="button"
                        class="absolute right-0 top-0 h-12 w-12 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass"
                        data-target="prompt-input">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="flex gap-3 pt-2">
                    <button id="prompt-cancel" class="h-11 px-4 rounded-xl border bg-background hover:bg-accent text-sm font-medium flex-1">Cancelar</button>
                    <button id="prompt-confirm" class="h-11 px-4 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold flex-1 shadow-lg shadow-indigo-500/20">Confirmar</button>
                </div>
                <button id="prompt-biometric" class="hidden w-full h-11 rounded-xl bg-secondary/50 hover:bg-secondary text-secondary-foreground text-sm font-bold flex items-center justify-center gap-2 transition-all">
                    <i data-lucide="fingerprint" class="w-5 h-5"></i> Usar Huella
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast">
        <div class="border">
            ¬°Acci√≥n completada!
        </div>
    </div>`}function Ht(t,e=null){const n=document.getElementById("sidebar-categories"),o=document.getElementById("mobile-sidebar-categories"),a=document.getElementById("edit-category"),i=document.getElementById("cat-dropdown-menu");e&&(u.categories=e),n&&(n.innerHTML=""),o&&(o.innerHTML=""),a&&(a.innerHTML=`<option value="">${p("categories.no_category")}</option>`),i&&(i.innerHTML=`<div class="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer border-b" data-id="">${p("categories.no_category")}</div>`);const r=u.categories.length>0,s=document.getElementById("sidebar-categories-header"),l=document.getElementById("mobile-sidebar-categories-header");s&&s.classList.toggle("hidden",!r),l&&l.classList.toggle("hidden",!r),document.querySelectorAll('.nav-link[data-view="all"], .nav-link-mobile[data-view="all"], .nav-link-mobile-drawer[data-view="all"]').forEach(d=>{d.classList.toggle("active",u.currentView==="all")});const c=(d,v,f)=>{if(!i)return;const m=document.createElement("div");m.className="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer flex items-center gap-2",m.innerHTML=`<i data-lucide="${f||"tag"}" class="w-3.5 h-3.5 text-foreground/70"></i> ${v}`,m.onclick=()=>{a&&(a.value=d),g(),i.classList.add("hidden")},i.appendChild(m)},g=()=>{const d=document.getElementById("edit-category").value,v=u.categories.find(f=>f.id===d);document.getElementById("selected-cat-label").innerText=v?v.name:p("categories.no_category")};if(i){const d=i.querySelector('[data-id=""]');d&&(d.onclick=()=>{a&&(a.value=""),g(),i.classList.add("hidden")})}u.categories.forEach(d=>{const v=(f=!1)=>{const m=document.createElement("button");return m.className=f?"nav-link-mobile-drawer w-full group":"nav-link w-full group",m.setAttribute("data-view",d.id),u.currentView===d.id&&m.classList.add("active"),m.onclick=async()=>{if(d.passwordHash){const h=await ne(p("common.restricted_access"),`${p("common.enter_cat_pass")} "${d.name}":`);if(!h)return;if(!(typeof h=="object"&&h.biometric)){if(await $.hash(h)!==d.passwordHash){S(p("auth.incorrect_pass"));return}}}if(t(d.id,d.name),f){const h=document.getElementById("mobile-sidebar-overlay");h&&h.classList.add("hidden")}},m.innerHTML=`
                <div class="flex items-center justify-between w-full">
                    <div class="flex items-center gap-3">
                        <i data-lucide="${d.icon||"tag"}" class="w-4 h-4 text-foreground/70 group-hover:text-violet-500 transition-colors"></i>
                        <span class="truncate sidebar-label">${d.name}</span>
                    </div>
                    <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        ${d.passwordHash?'<i data-lucide="lock" class="w-3 h-3 text-muted-foreground"></i>':""}
                    </div>
                </div>
            `,m};if(n&&n.appendChild(v(!1)),o&&o.appendChild(v(!0)),a){const f=document.createElement("option");f.value=d.id,f.innerText=d.name,a.appendChild(f)}c(d.id,d.name,d.icon)}),z()}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Wt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,o)}return n}function oe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Wt(Object(n),!0).forEach(function(o){ao(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wt(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function st(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?st=function(e){return typeof e}:st=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},st(t)}function ao(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function re(){return re=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},re.apply(this,arguments)}function io(t,e){if(t==null)return{};var n={},o=Object.keys(t),a,i;for(i=0;i<o.length;i++)a=o[i],!(e.indexOf(a)>=0)&&(n[a]=t[a]);return n}function ro(t,e){if(t==null)return{};var n=io(t,e),o,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)o=i[a],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(t,o)&&(n[o]=t[o])}return n}var so="1.15.6";function ie(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var se=ie(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ze=ie(/Edge/i),Kt=ie(/firefox/i),Ue=ie(/safari/i)&&!ie(/chrome/i)&&!ie(/android/i),jt=ie(/iP(ad|od|hone)/i),fn=ie(/chrome/i)&&ie(/android/i),hn={capture:!1,passive:!1};function T(t,e,n){t.addEventListener(e,n,!se&&hn)}function I(t,e,n){t.removeEventListener(e,n,!se&&hn)}function gt(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function bn(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Q(t,e,n,o){if(t){n=n||document;do{if(e!=null&&(e[0]===">"?t.parentNode===n&&gt(t,e):gt(t,e))||o&&t===n)return t;if(t===n)break}while(t=bn(t))}return null}var Yt=/\s+/g;function K(t,e,n){if(t&&e)if(t.classList)t.classList[n?"add":"remove"](e);else{var o=(" "+t.className+" ").replace(Yt," ").replace(" "+e+" "," ");t.className=(o+(n?" "+e:"")).replace(Yt," ")}}function _(t,e,n){var o=t&&t.style;if(o){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),e===void 0?n:n[e];!(e in o)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),o[e]=n+(typeof n=="string"?"":"px")}}function Ie(t,e){var n="";if(typeof t=="string")n=t;else do{var o=_(t,"transform");o&&o!=="none"&&(n=o+" "+n)}while(!e&&(t=t.parentNode));var a=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return a&&new a(n)}function vn(t,e,n){if(t){var o=t.getElementsByTagName(e),a=0,i=o.length;if(n)for(;a<i;a++)n(o[a],a);return o}return[]}function te(){var t=document.scrollingElement;return t||document.documentElement}function M(t,e,n,o,a){if(!(!t.getBoundingClientRect&&t!==window)){var i,r,s,l,c,g,d;if(t!==window&&t.parentNode&&t!==te()?(i=t.getBoundingClientRect(),r=i.top,s=i.left,l=i.bottom,c=i.right,g=i.height,d=i.width):(r=0,s=0,l=window.innerHeight,c=window.innerWidth,g=window.innerHeight,d=window.innerWidth),(e||n)&&t!==window&&(a=a||t.parentNode,!se))do if(a&&a.getBoundingClientRect&&(_(a,"transform")!=="none"||n&&_(a,"position")!=="static")){var v=a.getBoundingClientRect();r-=v.top+parseInt(_(a,"border-top-width")),s-=v.left+parseInt(_(a,"border-left-width")),l=r+i.height,c=s+i.width;break}while(a=a.parentNode);if(o&&t!==window){var f=Ie(a||t),m=f&&f.a,h=f&&f.d;f&&(r/=h,s/=m,d/=m,g/=h,l=r+g,c=s+d)}return{top:r,left:s,bottom:l,right:c,width:d,height:g}}}function Xt(t,e,n){for(var o=ge(t,!0),a=M(t)[e];o;){var i=M(o)[n],r=void 0;if(r=a>=i,!r)return o;if(o===te())break;o=ge(o,!1)}return!1}function De(t,e,n,o){for(var a=0,i=0,r=t.children;i<r.length;){if(r[i].style.display!=="none"&&r[i]!==E.ghost&&(o||r[i]!==E.dragged)&&Q(r[i],n.draggable,t,!1)){if(a===e)return r[i];a++}i++}return null}function Rt(t,e){for(var n=t.lastElementChild;n&&(n===E.ghost||_(n,"display")==="none"||e&&!gt(n,e));)n=n.previousElementSibling;return n||null}function X(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==E.clone&&(!e||gt(t,e))&&n++;return n}function Jt(t){var e=0,n=0,o=te();if(t)do{var a=Ie(t),i=a.a,r=a.d;e+=t.scrollLeft*i,n+=t.scrollTop*r}while(t!==o&&(t=t.parentNode));return[e,n]}function lo(t,e){for(var n in t)if(t.hasOwnProperty(n)){for(var o in e)if(e.hasOwnProperty(o)&&e[o]===t[n][o])return Number(n)}return-1}function ge(t,e){if(!t||!t.getBoundingClientRect)return te();var n=t,o=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var a=_(n);if(n.clientWidth<n.scrollWidth&&(a.overflowX=="auto"||a.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(a.overflowY=="auto"||a.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return te();if(o||e)return n;o=!0}}while(n=n.parentNode);return te()}function co(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function wt(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var Ve;function yn(t,e){return function(){if(!Ve){var n=arguments,o=this;n.length===1?t.call(o,n[0]):t.apply(o,n),Ve=setTimeout(function(){Ve=void 0},e)}}}function uo(){clearTimeout(Ve),Ve=void 0}function wn(t,e,n){t.scrollLeft+=e,t.scrollTop+=n}function xn(t){var e=window.Polymer,n=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):n?n(t).clone(!0)[0]:t.cloneNode(!0)}function _n(t,e,n){var o={};return Array.from(t.children).forEach(function(a){var i,r,s,l;if(!(!Q(a,e.draggable,t,!1)||a.animated||a===n)){var c=M(a);o.left=Math.min((i=o.left)!==null&&i!==void 0?i:1/0,c.left),o.top=Math.min((r=o.top)!==null&&r!==void 0?r:1/0,c.top),o.right=Math.max((s=o.right)!==null&&s!==void 0?s:-1/0,c.right),o.bottom=Math.max((l=o.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}var W="Sortable"+new Date().getTime();function po(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var o=[].slice.call(this.el.children);o.forEach(function(a){if(!(_(a,"display")==="none"||a===E.ghost)){t.push({target:a,rect:M(a)});var i=oe({},t[t.length-1].rect);if(a.thisAnimationDuration){var r=Ie(a,!0);r&&(i.top-=r.f,i.left-=r.e)}a.fromRect=i}})}},addAnimationState:function(o){t.push(o)},removeAnimationState:function(o){t.splice(lo(t,{target:o}),1)},animateAll:function(o){var a=this;if(!this.options.animation){clearTimeout(e),typeof o=="function"&&o();return}var i=!1,r=0;t.forEach(function(s){var l=0,c=s.target,g=c.fromRect,d=M(c),v=c.prevFromRect,f=c.prevToRect,m=s.rect,h=Ie(c,!0);h&&(d.top-=h.f,d.left-=h.e),c.toRect=d,c.thisAnimationDuration&&wt(v,d)&&!wt(g,d)&&(m.top-d.top)/(m.left-d.left)===(g.top-d.top)/(g.left-d.left)&&(l=mo(m,v,f,a.options)),wt(d,g)||(c.prevFromRect=g,c.prevToRect=d,l||(l=a.options.animation),a.animate(c,m,d,l)),l&&(i=!0,r=Math.max(r,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),i?e=setTimeout(function(){typeof o=="function"&&o()},r):typeof o=="function"&&o(),t=[]},animate:function(o,a,i,r){if(r){_(o,"transition",""),_(o,"transform","");var s=Ie(this.el),l=s&&s.a,c=s&&s.d,g=(a.left-i.left)/(l||1),d=(a.top-i.top)/(c||1);o.animatingX=!!g,o.animatingY=!!d,_(o,"transform","translate3d("+g+"px,"+d+"px,0)"),this.forRepaintDummy=go(o),_(o,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),_(o,"transform","translate3d(0,0,0)"),typeof o.animated=="number"&&clearTimeout(o.animated),o.animated=setTimeout(function(){_(o,"transition",""),_(o,"transform",""),o.animated=!1,o.animatingX=!1,o.animatingY=!1},r)}}}}function go(t){return t.offsetWidth}function mo(t,e,n,o){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))*o.animation}var we=[],xt={initializeByDefault:!0},Qe={mount:function(e){for(var n in xt)xt.hasOwnProperty(n)&&!(n in e)&&(e[n]=xt[n]);we.forEach(function(o){if(o.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),we.push(e)},pluginEvent:function(e,n,o){var a=this;this.eventCanceled=!1,o.cancel=function(){a.eventCanceled=!0};var i=e+"Global";we.forEach(function(r){n[r.pluginName]&&(n[r.pluginName][i]&&n[r.pluginName][i](oe({sortable:n},o)),n.options[r.pluginName]&&n[r.pluginName][e]&&n[r.pluginName][e](oe({sortable:n},o)))})},initializePlugins:function(e,n,o,a){we.forEach(function(s){var l=s.pluginName;if(!(!e.options[l]&&!s.initializeByDefault)){var c=new s(e,n,e.options);c.sortable=e,c.options=e.options,e[l]=c,re(o,c.defaults)}});for(var i in e.options)if(e.options.hasOwnProperty(i)){var r=this.modifyOption(e,i,e.options[i]);typeof r<"u"&&(e.options[i]=r)}},getEventProperties:function(e,n){var o={};return we.forEach(function(a){typeof a.eventProperties=="function"&&re(o,a.eventProperties.call(n[a.pluginName],e))}),o},modifyOption:function(e,n,o){var a;return we.forEach(function(i){e[i.pluginName]&&i.optionListeners&&typeof i.optionListeners[n]=="function"&&(a=i.optionListeners[n].call(e[i.pluginName],o))}),a}};function fo(t){var e=t.sortable,n=t.rootEl,o=t.name,a=t.targetEl,i=t.cloneEl,r=t.toEl,s=t.fromEl,l=t.oldIndex,c=t.newIndex,g=t.oldDraggableIndex,d=t.newDraggableIndex,v=t.originalEvent,f=t.putSortable,m=t.extraEventProperties;if(e=e||n&&n[W],!!e){var h,x=e.options,D="on"+o.charAt(0).toUpperCase()+o.substr(1);window.CustomEvent&&!se&&!Ze?h=new CustomEvent(o,{bubbles:!0,cancelable:!0}):(h=document.createEvent("Event"),h.initEvent(o,!0,!0)),h.to=r||n,h.from=s||n,h.item=a||n,h.clone=i,h.oldIndex=l,h.newIndex=c,h.oldDraggableIndex=g,h.newDraggableIndex=d,h.originalEvent=v,h.pullMode=f?f.lastPutMode:void 0;var w=oe(oe({},m),Qe.getEventProperties(o,e));for(var y in w)h[y]=w[y];n&&n.dispatchEvent(h),x[D]&&x[D].call(e,h)}}var ho=["evt"],G=function(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=o.evt,i=ro(o,ho);Qe.pluginEvent.bind(E)(e,n,oe({dragEl:b,parentEl:P,ghostEl:k,rootEl:A,nextEl:ve,lastDownEl:lt,cloneEl:L,cloneHidden:pe,dragStarted:je,putSortable:F,activeSortable:E.active,originalEvent:a,oldIndex:Se,oldDraggableIndex:Ge,newIndex:Y,newDraggableIndex:ue,hideGhostForTarget:In,unhideGhostForTarget:Cn,cloneNowHidden:function(){pe=!0},cloneNowShown:function(){pe=!1},dispatchSortableEvent:function(s){V({sortable:n,name:s,originalEvent:a})}},i))};function V(t){fo(oe({putSortable:F,cloneEl:L,targetEl:b,rootEl:A,oldIndex:Se,oldDraggableIndex:Ge,newIndex:Y,newDraggableIndex:ue},t))}var b,P,k,A,ve,lt,L,pe,Se,Y,Ge,ue,tt,F,_e=!1,mt=!1,ft=[],he,Z,_t,Et,Zt,Qt,je,xe,We,Ke=!1,nt=!1,ct,U,kt=[],Nt=!1,ht=[],vt=typeof document<"u",ot=jt,en=Ze||se?"cssFloat":"float",bo=vt&&!fn&&!jt&&"draggable"in document.createElement("div"),En=function(){if(vt){if(se)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),kn=function(e,n){var o=_(e),a=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),i=De(e,0,n),r=De(e,1,n),s=i&&_(i),l=r&&_(r),c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+M(i).width,g=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+M(r).width;if(o.display==="flex")return o.flexDirection==="column"||o.flexDirection==="column-reverse"?"vertical":"horizontal";if(o.display==="grid")return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&s.float&&s.float!=="none"){var d=s.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===d)?"vertical":"horizontal"}return i&&(s.display==="block"||s.display==="flex"||s.display==="table"||s.display==="grid"||c>=a&&o[en]==="none"||r&&o[en]==="none"&&c+g>a)?"vertical":"horizontal"},vo=function(e,n,o){var a=o?e.left:e.top,i=o?e.right:e.bottom,r=o?e.width:e.height,s=o?n.left:n.top,l=o?n.right:n.bottom,c=o?n.width:n.height;return a===s||i===l||a+r/2===s+c/2},yo=function(e,n){var o;return ft.some(function(a){var i=a[W].options.emptyInsertThreshold;if(!(!i||Rt(a))){var r=M(a),s=e>=r.left-i&&e<=r.right+i,l=n>=r.top-i&&n<=r.bottom+i;if(s&&l)return o=a}}),o},Sn=function(e){function n(i,r){return function(s,l,c,g){var d=s.options.group.name&&l.options.group.name&&s.options.group.name===l.options.group.name;if(i==null&&(r||d))return!0;if(i==null||i===!1)return!1;if(r&&i==="clone")return i;if(typeof i=="function")return n(i(s,l,c,g),r)(s,l,c,g);var v=(r?s:l).options.group.name;return i===!0||typeof i=="string"&&i===v||i.join&&i.indexOf(v)>-1}}var o={},a=e.group;(!a||st(a)!="object")&&(a={name:a}),o.name=a.name,o.checkPull=n(a.pull,!0),o.checkPut=n(a.put),o.revertClone=a.revertClone,e.group=o},In=function(){!En&&k&&_(k,"display","none")},Cn=function(){!En&&k&&_(k,"display","")};vt&&!fn&&document.addEventListener("click",function(t){if(mt)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),mt=!1,!1},!0);var be=function(e){if(b){e=e.touches?e.touches[0]:e;var n=yo(e.clientX,e.clientY);if(n){var o={};for(var a in e)e.hasOwnProperty(a)&&(o[a]=e[a]);o.target=o.rootEl=n,o.preventDefault=void 0,o.stopPropagation=void 0,n[W]._onDragOver(o)}}},wo=function(e){b&&b.parentNode[W]._isOutsideThisEl(e.target)};function E(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=re({},e),t[W]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return kn(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,s){r.setData("Text",s.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:E.supportPointer!==!1&&"PointerEvent"in window&&(!Ue||jt),emptyInsertThreshold:5};Qe.initializePlugins(this,t,n);for(var o in n)!(o in e)&&(e[o]=n[o]);Sn(e);for(var a in this)a.charAt(0)==="_"&&typeof this[a]=="function"&&(this[a]=this[a].bind(this));this.nativeDraggable=e.forceFallback?!1:bo,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?T(t,"pointerdown",this._onTapStart):(T(t,"mousedown",this._onTapStart),T(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(T(t,"dragover",this),T(t,"dragenter",this)),ft.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),re(this,po())}E.prototype={constructor:E,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(xe=null)},_getDirection:function(e,n){return typeof this.options.direction=="function"?this.options.direction.call(this,e,n,b):this.options.direction},_onTapStart:function(e){if(e.cancelable){var n=this,o=this.el,a=this.options,i=a.preventOnFilter,r=e.type,s=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(s||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,g=a.filter;if(To(o),!b&&!(/mousedown|pointerdown/.test(r)&&e.button!==0||a.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Ue&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Q(l,a.draggable,o,!1),!(l&&l.animated)&&lt!==l)){if(Se=X(l),Ge=X(l,a.draggable),typeof g=="function"){if(g.call(this,e,l,this)){V({sortable:n,rootEl:c,name:"filter",targetEl:l,toEl:o,fromEl:o}),G("filter",n,{evt:e}),i&&e.preventDefault();return}}else if(g&&(g=g.split(",").some(function(d){if(d=Q(c,d.trim(),o,!1),d)return V({sortable:n,rootEl:d,name:"filter",targetEl:l,fromEl:o,toEl:o}),G("filter",n,{evt:e}),!0}),g)){i&&e.preventDefault();return}a.handle&&!Q(c,a.handle,o,!1)||this._prepareDragStart(e,s,l)}}},_prepareDragStart:function(e,n,o){var a=this,i=a.el,r=a.options,s=i.ownerDocument,l;if(o&&!b&&o.parentNode===i){var c=M(o);if(A=i,b=o,P=b.parentNode,ve=b.nextSibling,lt=o,tt=r.group,E.dragged=b,he={target:b,clientX:(n||e).clientX,clientY:(n||e).clientY},Zt=he.clientX-c.left,Qt=he.clientY-c.top,this._lastX=(n||e).clientX,this._lastY=(n||e).clientY,b.style["will-change"]="all",l=function(){if(G("delayEnded",a,{evt:e}),E.eventCanceled){a._onDrop();return}a._disableDelayedDragEvents(),!Kt&&a.nativeDraggable&&(b.draggable=!0),a._triggerDragStart(e,n),V({sortable:a,name:"choose",originalEvent:e}),K(b,r.chosenClass,!0)},r.ignore.split(",").forEach(function(g){vn(b,g.trim(),St)}),T(s,"dragover",be),T(s,"mousemove",be),T(s,"touchmove",be),r.supportPointer?(T(s,"pointerup",a._onDrop),!this.nativeDraggable&&T(s,"pointercancel",a._onDrop)):(T(s,"mouseup",a._onDrop),T(s,"touchend",a._onDrop),T(s,"touchcancel",a._onDrop)),Kt&&this.nativeDraggable&&(this.options.touchStartThreshold=4,b.draggable=!0),G("delayStart",this,{evt:e}),r.delay&&(!r.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(Ze||se))){if(E.eventCanceled){this._onDrop();return}r.supportPointer?(T(s,"pointerup",a._disableDelayedDrag),T(s,"pointercancel",a._disableDelayedDrag)):(T(s,"mouseup",a._disableDelayedDrag),T(s,"touchend",a._disableDelayedDrag),T(s,"touchcancel",a._disableDelayedDrag)),T(s,"mousemove",a._delayedDragTouchMoveHandler),T(s,"touchmove",a._delayedDragTouchMoveHandler),r.supportPointer&&T(s,"pointermove",a._delayedDragTouchMoveHandler),a._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var n=e.touches?e.touches[0]:e;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){b&&St(b),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;I(e,"mouseup",this._disableDelayedDrag),I(e,"touchend",this._disableDelayedDrag),I(e,"touchcancel",this._disableDelayedDrag),I(e,"pointerup",this._disableDelayedDrag),I(e,"pointercancel",this._disableDelayedDrag),I(e,"mousemove",this._delayedDragTouchMoveHandler),I(e,"touchmove",this._delayedDragTouchMoveHandler),I(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,n){n=n||e.pointerType=="touch"&&e,!this.nativeDraggable||n?this.options.supportPointer?T(document,"pointermove",this._onTouchMove):n?T(document,"touchmove",this._onTouchMove):T(document,"mousemove",this._onTouchMove):(T(b,"dragend",this),T(A,"dragstart",this._onDragStart));try{document.selection?dt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,n){if(_e=!1,A&&b){G("dragStarted",this,{evt:n}),this.nativeDraggable&&T(document,"dragover",wo);var o=this.options;!e&&K(b,o.dragClass,!1),K(b,o.ghostClass,!0),E.active=this,e&&this._appendGhost(),V({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if(Z){this._lastX=Z.clientX,this._lastY=Z.clientY,In();for(var e=document.elementFromPoint(Z.clientX,Z.clientY),n=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Z.clientX,Z.clientY),e!==n);)n=e;if(b.parentNode[W]._isOutsideThisEl(e),n)do{if(n[W]){var o=void 0;if(o=n[W]._onDragOver({clientX:Z.clientX,clientY:Z.clientY,target:e,rootEl:n}),o&&!this.options.dragoverBubble)break}e=n}while(n=bn(n));Cn()}},_onTouchMove:function(e){if(he){var n=this.options,o=n.fallbackTolerance,a=n.fallbackOffset,i=e.touches?e.touches[0]:e,r=k&&Ie(k,!0),s=k&&r&&r.a,l=k&&r&&r.d,c=ot&&U&&Jt(U),g=(i.clientX-he.clientX+a.x)/(s||1)+(c?c[0]-kt[0]:0)/(s||1),d=(i.clientY-he.clientY+a.y)/(l||1)+(c?c[1]-kt[1]:0)/(l||1);if(!E.active&&!_e){if(o&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<o)return;this._onDragStart(e,!0)}if(k){r?(r.e+=g-(_t||0),r.f+=d-(Et||0)):r={a:1,b:0,c:0,d:1,e:g,f:d};var v="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");_(k,"webkitTransform",v),_(k,"mozTransform",v),_(k,"msTransform",v),_(k,"transform",v),_t=g,Et=d,Z=i}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!k){var e=this.options.fallbackOnBody?document.body:A,n=M(b,!0,ot,!0,e),o=this.options;if(ot){for(U=e;_(U,"position")==="static"&&_(U,"transform")==="none"&&U!==document;)U=U.parentNode;U!==document.body&&U!==document.documentElement?(U===document&&(U=te()),n.top+=U.scrollTop,n.left+=U.scrollLeft):U=te(),kt=Jt(U)}k=b.cloneNode(!0),K(k,o.ghostClass,!1),K(k,o.fallbackClass,!0),K(k,o.dragClass,!0),_(k,"transition",""),_(k,"transform",""),_(k,"box-sizing","border-box"),_(k,"margin",0),_(k,"top",n.top),_(k,"left",n.left),_(k,"width",n.width),_(k,"height",n.height),_(k,"opacity","0.8"),_(k,"position",ot?"absolute":"fixed"),_(k,"zIndex","100000"),_(k,"pointerEvents","none"),E.ghost=k,e.appendChild(k),_(k,"transform-origin",Zt/parseInt(k.style.width)*100+"% "+Qt/parseInt(k.style.height)*100+"%")}},_onDragStart:function(e,n){var o=this,a=e.dataTransfer,i=o.options;if(G("dragStart",this,{evt:e}),E.eventCanceled){this._onDrop();return}G("setupClone",this),E.eventCanceled||(L=xn(b),L.removeAttribute("id"),L.draggable=!1,L.style["will-change"]="",this._hideClone(),K(L,this.options.chosenClass,!1),E.clone=L),o.cloneId=dt(function(){G("clone",o),!E.eventCanceled&&(o.options.removeCloneOnHide||A.insertBefore(L,b),o._hideClone(),V({sortable:o,name:"clone"}))}),!n&&K(b,i.dragClass,!0),n?(mt=!0,o._loopId=setInterval(o._emulateDragOver,50)):(I(document,"mouseup",o._onDrop),I(document,"touchend",o._onDrop),I(document,"touchcancel",o._onDrop),a&&(a.effectAllowed="move",i.setData&&i.setData.call(o,a,b)),T(document,"drop",o),_(b,"transform","translateZ(0)")),_e=!0,o._dragStartId=dt(o._dragStarted.bind(o,n,e)),T(document,"selectstart",o),je=!0,window.getSelection().removeAllRanges(),Ue&&_(document.body,"user-select","none")},_onDragOver:function(e){var n=this.el,o=e.target,a,i,r,s=this.options,l=s.group,c=E.active,g=tt===l,d=s.sort,v=F||c,f,m=this,h=!1;if(Nt)return;function x(Ne,Nn){G(Ne,m,oe({evt:e,isOwner:g,axis:f?"vertical":"horizontal",revert:r,dragRect:a,targetRect:i,canSort:d,fromSortable:v,target:o,completed:w,onMove:function(Ut,Pn){return at(A,n,b,a,Ut,M(Ut),e,Pn)},changed:y},Nn))}function D(){x("dragOverAnimationCapture"),m.captureAnimationState(),m!==v&&v.captureAnimationState()}function w(Ne){return x("dragOverCompleted",{insertion:Ne}),Ne&&(g?c._hideClone():c._showClone(m),m!==v&&(K(b,F?F.options.ghostClass:c.options.ghostClass,!1),K(b,s.ghostClass,!0)),F!==m&&m!==E.active?F=m:m===E.active&&F&&(F=null),v===m&&(m._ignoreWhileAnimating=o),m.animateAll(function(){x("dragOverAnimationComplete"),m._ignoreWhileAnimating=null}),m!==v&&(v.animateAll(),v._ignoreWhileAnimating=null)),(o===b&&!b.animated||o===n&&!o.animated)&&(xe=null),!s.dragoverBubble&&!e.rootEl&&o!==document&&(b.parentNode[W]._isOutsideThisEl(e.target),!Ne&&be(e)),!s.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),h=!0}function y(){Y=X(b),ue=X(b,s.draggable),V({sortable:m,name:"change",toEl:n,newIndex:Y,newDraggableIndex:ue,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),o=Q(o,s.draggable,n,!0),x("dragOver"),E.eventCanceled)return h;if(b.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||m._ignoreWhileAnimating===o)return w(!1);if(mt=!1,c&&!s.disabled&&(g?d||(r=P!==A):F===this||(this.lastPutMode=tt.checkPull(this,c,b,e))&&l.checkPut(this,c,b,e))){if(f=this._getDirection(e,o)==="vertical",a=M(b),x("dragOverValid"),E.eventCanceled)return h;if(r)return P=A,D(),this._hideClone(),x("revert"),E.eventCanceled||(ve?A.insertBefore(b,ve):A.appendChild(b)),w(!0);var C=Rt(n,s.draggable);if(!C||ko(e,f,this)&&!C.animated){if(C===b)return w(!1);if(C&&n===e.target&&(o=C),o&&(i=M(o)),at(A,n,b,a,o,i,e,!!o)!==!1)return D(),C&&C.nextSibling?n.insertBefore(b,C.nextSibling):n.appendChild(b),P=n,y(),w(!0)}else if(C&&Eo(e,f,this)){var H=De(n,0,s,!0);if(H===b)return w(!1);if(o=H,i=M(o),at(A,n,b,a,o,i,e,!1)!==!1)return D(),n.insertBefore(b,H),P=n,y(),w(!0)}else if(o.parentNode===n){i=M(o);var N=0,j,R=b.parentNode!==n,q=!vo(b.animated&&b.toRect||a,o.animated&&o.toRect||i,f),Be=f?"top":"left",le=Xt(o,"top","top")||Xt(b,"top","top"),Ae=le?le.scrollTop:void 0;xe!==o&&(j=i[Be],Ke=!1,nt=!q&&s.invertSwap||R),N=So(e,o,i,f,q?1:s.swapThreshold,s.invertedSwapThreshold==null?s.swapThreshold:s.invertedSwapThreshold,nt,xe===o);var ae;if(N!==0){var me=X(b);do me-=N,ae=P.children[me];while(ae&&(_(ae,"display")==="none"||ae===k))}if(N===0||ae===o)return w(!1);xe=o,We=N;var Le=o.nextElementSibling,ce=!1;ce=N===1;var et=at(A,n,b,a,o,i,e,ce);if(et!==!1)return(et===1||et===-1)&&(ce=et===1),Nt=!0,setTimeout(_o,30),D(),ce&&!Le?n.appendChild(b):o.parentNode.insertBefore(b,ce?Le:o),le&&wn(le,0,Ae-le.scrollTop),P=b.parentNode,j!==void 0&&!nt&&(ct=Math.abs(j-M(o)[Be])),y(),w(!0)}if(n.contains(b))return w(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){I(document,"mousemove",this._onTouchMove),I(document,"touchmove",this._onTouchMove),I(document,"pointermove",this._onTouchMove),I(document,"dragover",be),I(document,"mousemove",be),I(document,"touchmove",be)},_offUpEvents:function(){var e=this.el.ownerDocument;I(e,"mouseup",this._onDrop),I(e,"touchend",this._onDrop),I(e,"pointerup",this._onDrop),I(e,"pointercancel",this._onDrop),I(e,"touchcancel",this._onDrop),I(document,"selectstart",this)},_onDrop:function(e){var n=this.el,o=this.options;if(Y=X(b),ue=X(b,o.draggable),G("drop",this,{evt:e}),P=b&&b.parentNode,Y=X(b),ue=X(b,o.draggable),E.eventCanceled){this._nulling();return}_e=!1,nt=!1,Ke=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Pt(this.cloneId),Pt(this._dragStartId),this.nativeDraggable&&(I(document,"drop",this),I(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ue&&_(document.body,"user-select",""),_(b,"transform",""),e&&(je&&(e.cancelable&&e.preventDefault(),!o.dropBubble&&e.stopPropagation()),k&&k.parentNode&&k.parentNode.removeChild(k),(A===P||F&&F.lastPutMode!=="clone")&&L&&L.parentNode&&L.parentNode.removeChild(L),b&&(this.nativeDraggable&&I(b,"dragend",this),St(b),b.style["will-change"]="",je&&!_e&&K(b,F?F.options.ghostClass:this.options.ghostClass,!1),K(b,this.options.chosenClass,!1),V({sortable:this,name:"unchoose",toEl:P,newIndex:null,newDraggableIndex:null,originalEvent:e}),A!==P?(Y>=0&&(V({rootEl:P,name:"add",toEl:P,fromEl:A,originalEvent:e}),V({sortable:this,name:"remove",toEl:P,originalEvent:e}),V({rootEl:P,name:"sort",toEl:P,fromEl:A,originalEvent:e}),V({sortable:this,name:"sort",toEl:P,originalEvent:e})),F&&F.save()):Y!==Se&&Y>=0&&(V({sortable:this,name:"update",toEl:P,originalEvent:e}),V({sortable:this,name:"sort",toEl:P,originalEvent:e})),E.active&&((Y==null||Y===-1)&&(Y=Se,ue=Ge),V({sortable:this,name:"end",toEl:P,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){G("nulling",this),A=b=P=k=ve=L=lt=pe=he=Z=je=Y=ue=Se=Ge=xe=We=F=tt=E.dragged=E.ghost=E.clone=E.active=null,ht.forEach(function(e){e.checked=!0}),ht.length=_t=Et=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":b&&(this._onDragOver(e),xo(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],n,o=this.el.children,a=0,i=o.length,r=this.options;a<i;a++)n=o[a],Q(n,r.draggable,this.el,!1)&&e.push(n.getAttribute(r.dataIdAttr)||Co(n));return e},sort:function(e,n){var o={},a=this.el;this.toArray().forEach(function(i,r){var s=a.children[r];Q(s,this.options.draggable,a,!1)&&(o[i]=s)},this),n&&this.captureAnimationState(),e.forEach(function(i){o[i]&&(a.removeChild(o[i]),a.appendChild(o[i]))}),n&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,n){return Q(e,n||this.options.draggable,this.el,!1)},option:function(e,n){var o=this.options;if(n===void 0)return o[e];var a=Qe.modifyOption(this,e,n);typeof a<"u"?o[e]=a:o[e]=n,e==="group"&&Sn(o)},destroy:function(){G("destroy",this);var e=this.el;e[W]=null,I(e,"mousedown",this._onTapStart),I(e,"touchstart",this._onTapStart),I(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(I(e,"dragover",this),I(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ft.splice(ft.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!pe){if(G("hideClone",this),E.eventCanceled)return;_(L,"display","none"),this.options.removeCloneOnHide&&L.parentNode&&L.parentNode.removeChild(L),pe=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(pe){if(G("showClone",this),E.eventCanceled)return;b.parentNode==A&&!this.options.group.revertClone?A.insertBefore(L,b):ve?A.insertBefore(L,ve):A.appendChild(L),this.options.group.revertClone&&this.animate(b,L),_(L,"display",""),pe=!1}}};function xo(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function at(t,e,n,o,a,i,r,s){var l,c=t[W],g=c.options.onMove,d;return window.CustomEvent&&!se&&!Ze?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=t,l.dragged=n,l.draggedRect=o,l.related=a||e,l.relatedRect=i||M(e),l.willInsertAfter=s,l.originalEvent=r,t.dispatchEvent(l),g&&(d=g.call(c,l,r)),d}function St(t){t.draggable=!1}function _o(){Nt=!1}function Eo(t,e,n){var o=M(De(n.el,0,n.options,!0)),a=_n(n.el,n.options,k),i=10;return e?t.clientX<a.left-i||t.clientY<o.top&&t.clientX<o.right:t.clientY<a.top-i||t.clientY<o.bottom&&t.clientX<o.left}function ko(t,e,n){var o=M(Rt(n.el,n.options.draggable)),a=_n(n.el,n.options,k),i=10;return e?t.clientX>a.right+i||t.clientY>o.bottom&&t.clientX>o.left:t.clientY>a.bottom+i||t.clientX>o.right&&t.clientY>o.top}function So(t,e,n,o,a,i,r,s){var l=o?t.clientY:t.clientX,c=o?n.height:n.width,g=o?n.top:n.left,d=o?n.bottom:n.right,v=!1;if(!r){if(s&&ct<c*a){if(!Ke&&(We===1?l>g+c*i/2:l<d-c*i/2)&&(Ke=!0),Ke)v=!0;else if(We===1?l<g+ct:l>d-ct)return-We}else if(l>g+c*(1-a)/2&&l<d-c*(1-a)/2)return Io(e)}return v=v||r,v&&(l<g+c*i/2||l>d-c*i/2)?l>g+c/2?1:-1:0}function Io(t){return X(b)<X(t)?1:-1}function Co(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,o=0;n--;)o+=e.charCodeAt(n);return o.toString(36)}function To(t){ht.length=0;for(var e=t.getElementsByTagName("input"),n=e.length;n--;){var o=e[n];o.checked&&ht.push(o)}}function dt(t){return setTimeout(t,0)}function Pt(t){return clearTimeout(t)}vt&&T(document,"touchmove",function(t){(E.active||_e)&&t.cancelable&&t.preventDefault()});E.utils={on:T,off:I,css:_,find:vn,is:function(e,n){return!!Q(e,n,e,!1)},extend:co,throttle:yn,closest:Q,toggleClass:K,clone:xn,index:X,nextTick:dt,cancelNextTick:Pt,detectDirection:kn,getChild:De,expando:W};E.get=function(t){return t[W]};E.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach(function(o){if(!o.prototype||!o.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(o));o.utils&&(E.utils=oe(oe({},E.utils),o.utils)),Qe.mount(o)})};E.create=function(t,e){return new E(t,e)};E.version=so;var O=[],Re,$t,Ot=!1,It,Ct,bt,Fe;function Do(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(n){var o=n.originalEvent;this.sortable.nativeDraggable?T(document,"dragover",this._handleAutoScroll):this.options.supportPointer?T(document,"pointermove",this._handleFallbackAutoScroll):o.touches?T(document,"touchmove",this._handleFallbackAutoScroll):T(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var o=n.originalEvent;!this.options.dragOverBubble&&!o.rootEl&&this._handleAutoScroll(o)},drop:function(){this.sortable.nativeDraggable?I(document,"dragover",this._handleAutoScroll):(I(document,"pointermove",this._handleFallbackAutoScroll),I(document,"touchmove",this._handleFallbackAutoScroll),I(document,"mousemove",this._handleFallbackAutoScroll)),tn(),ut(),uo()},nulling:function(){bt=$t=Re=Ot=Fe=It=Ct=null,O.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,o){var a=this,i=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,s=document.elementFromPoint(i,r);if(bt=n,o||this.options.forceAutoScrollFallback||Ze||se||Ue){Tt(n,this.options,s,o);var l=ge(s,!0);Ot&&(!Fe||i!==It||r!==Ct)&&(Fe&&tn(),Fe=setInterval(function(){var c=ge(document.elementFromPoint(i,r),!0);c!==l&&(l=c,ut()),Tt(n,a.options,c,o)},10),It=i,Ct=r)}else{if(!this.options.bubbleScroll||ge(s,!0)===te()){ut();return}Tt(n,this.options,ge(s,!1),!1)}}},re(t,{pluginName:"scroll",initializeByDefault:!0})}function ut(){O.forEach(function(t){clearInterval(t.pid)}),O=[]}function tn(){clearInterval(Fe)}var Tt=yn(function(t,e,n,o){if(e.scroll){var a=(t.touches?t.touches[0]:t).clientX,i=(t.touches?t.touches[0]:t).clientY,r=e.scrollSensitivity,s=e.scrollSpeed,l=te(),c=!1,g;$t!==n&&($t=n,ut(),Re=e.scroll,g=e.scrollFn,Re===!0&&(Re=ge(n,!0)));var d=0,v=Re;do{var f=v,m=M(f),h=m.top,x=m.bottom,D=m.left,w=m.right,y=m.width,C=m.height,H=void 0,N=void 0,j=f.scrollWidth,R=f.scrollHeight,q=_(f),Be=f.scrollLeft,le=f.scrollTop;f===l?(H=y<j&&(q.overflowX==="auto"||q.overflowX==="scroll"||q.overflowX==="visible"),N=C<R&&(q.overflowY==="auto"||q.overflowY==="scroll"||q.overflowY==="visible")):(H=y<j&&(q.overflowX==="auto"||q.overflowX==="scroll"),N=C<R&&(q.overflowY==="auto"||q.overflowY==="scroll"));var Ae=H&&(Math.abs(w-a)<=r&&Be+y<j)-(Math.abs(D-a)<=r&&!!Be),ae=N&&(Math.abs(x-i)<=r&&le+C<R)-(Math.abs(h-i)<=r&&!!le);if(!O[d])for(var me=0;me<=d;me++)O[me]||(O[me]={});(O[d].vx!=Ae||O[d].vy!=ae||O[d].el!==f)&&(O[d].el=f,O[d].vx=Ae,O[d].vy=ae,clearInterval(O[d].pid),(Ae!=0||ae!=0)&&(c=!0,O[d].pid=setInterval((function(){o&&this.layer===0&&E.active._onTouchMove(bt);var Le=O[this.layer].vy?O[this.layer].vy*s:0,ce=O[this.layer].vx?O[this.layer].vx*s:0;typeof g=="function"&&g.call(E.dragged.parentNode[W],ce,Le,t,bt,O[this.layer].el)!=="continue"||wn(O[this.layer].el,ce,Le)}).bind({layer:d}),24))),d++}while(e.bubbleScroll&&v!==l&&(v=ge(v,!1)));Ot=c}},30),Tn=function(e){var n=e.originalEvent,o=e.putSortable,a=e.dragEl,i=e.activeSortable,r=e.dispatchSortableEvent,s=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(n){var c=o||i;s();var g=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,d=document.elementFromPoint(g.clientX,g.clientY);l(),c&&!c.el.contains(d)&&(r("spill"),this.onSpill({dragEl:a,putSortable:o}))}};function Ft(){}Ft.prototype={startIndex:null,dragStart:function(e){var n=e.oldDraggableIndex;this.startIndex=n},onSpill:function(e){var n=e.dragEl,o=e.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var a=De(this.sortable.el,this.startIndex,this.options);a?this.sortable.el.insertBefore(n,a):this.sortable.el.appendChild(n),this.sortable.animateAll(),o&&o.animateAll()},drop:Tn};re(Ft,{pluginName:"revertOnSpill"});function zt(){}zt.prototype={onSpill:function(e){var n=e.dragEl,o=e.putSortable,a=o||this.sortable;a.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),a.animateAll()},drop:Tn};re(zt,{pluginName:"removeOnSpill"});E.mount(new Do);E.mount(zt,Ft);function qt(t){const e=document.getElementById("notes-grid");if(!e)return;e.innerHTML="";const n=u.currentView==="all"?u.notes.filter(r=>{const s=u.categories.find(l=>l.id===r.categoryId);return!s||!s.passwordHash}):u.notes.filter(r=>r.categoryId===u.currentView),o=n.filter(r=>r.pinned),a=n.filter(r=>!r.pinned),i=r=>{const s=document.createElement("div");s.className="note-card note-animate-in relative group",s.dataset.id=r.id;const l=Ye.find(v=>v.id===r.themeId)||Ye[0],c=u.settings.theme==="dark"?l.dark:l.light;r.themeId!=="default"&&(s.style.backgroundColor=c,s.style.borderColor=u.settings.theme==="dark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)");const g=u.categories.find(v=>v.id===r.categoryId),d=u.unlockedNotes.has(r.id);return s.innerHTML=`
            <div class="note-card-content">
                <div class="flex items-start justify-between mb-2">
                    <h3 class="font-bold text-base line-clamp-2 leading-snug flex-1 pr-3">${r.title}</h3>
                    <div class="flex items-center gap-2 shrink-0 pt-0.5">
                        ${r.pinned?'<i data-lucide="pin" class="w-4 h-4 fill-current text-primary"></i>':""}
                        ${r.passwordHash?`<i data-lucide="${d?"unlock":"lock"}" class="w-4 h-4 lock-indicator cursor-pointer opacity-80" data-id="${r.id}"></i>`:""}
                    </div>
                </div>
                <div class="text-[13px] opacity-70 line-clamp-6 leading-relaxed mb-4 flex-1">
                    ${r.passwordHash&&!d?`<div class="flex items-center gap-3 py-8 italic opacity-50"><i data-lucide="shield-alert" class="w-6 h-6"></i> ${p("common.restricted_access")}</div>`:r.content}
                </div>
                ${g&&u.currentView==="all"?`
                <div class="mt-auto">
                    <span class="flex items-center gap-2 text-[10px] px-3 py-1.5 rounded-full bg-primary border border-primary/20 font-bold text-primary-foreground uppercase tracking-widest">
                        <i data-lucide="${g.icon||"tag"}" class="w-3.5 h-3.5 text-primary-foreground"></i>
                        ${g.name}
                    </span>
                </div>`:""}
            </div>
        `,s.onclick=async v=>{if(!v.target.closest(".delete-note-btn")){if(r.passwordHash&&!u.unlockedNotes.has(r.id)){try{const f=await ne(p("common.security_prompt"),p("common.security_desc_prompt"));if(!f)return;if(await $.hash(f)!==r.passwordHash){S(p("auth.incorrect_pass"));return}u.unlockedNotes.add(r.id),t(r),setTimeout(()=>qt(t),300)}catch(f){console.error("Error unlocking note:",f),S("‚ùå Error al desbloquear")}return}t(r)}},s};if(o.length>0){const r=document.createElement("h3");if(r.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2 flex items-center gap-2",r.innerHTML='<i data-lucide="pin" class="w-3 h-3"></i> '+p("header.pinned"),e.appendChild(r),o.forEach(s=>e.appendChild(i(s))),a.length>0){const s=document.createElement("div");s.className="col-span-full h-px bg-border my-4",e.appendChild(s)}}if(a.length>0){if(o.length>0){const r=document.createElement("h3");r.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2",r.innerText=p("sidebar.all_notes"),e.appendChild(r)}a.forEach(r=>e.appendChild(i(r)))}n.length===0&&(e.innerHTML=`<div class="col-span-full text-center py-20 text-muted-foreground opacity-50">
            <i data-lucide="ghost" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
            <p>${p("notes.no_notes")}</p>
        </div>`),z(),Bo()}function Bo(t){const e=document.getElementById("notes-grid");e&&(e.sortable&&e.sortable.destroy(),e.sortable=E.create(e,{animation:250,ghostClass:"opacity-50",delay:500,delayOnTouchOnly:!0,onEnd:async()=>{const n=[];e.querySelectorAll(".note-card").forEach(i=>{const r=u.notes.find(s=>s.id===i.dataset.id);r&&n.push(r)});const o=new Set(n.map(i=>i.id)),a=u.notes.filter(i=>!o.has(i.id));u.notes=[...n,...a],await J()}}))}const Ao="974464877836-721dprai6taijtuufmrkh438q68e97sp.apps.googleusercontent.com";let Pe=null;async function nn(){console.log("Iniciando aplicaci√≥n modular..."),qn();const t=localStorage.getItem("cn_vault_key_v3");t&&sessionStorage.setItem("cn_vault_key_v3",t),Lo(),jn(),Bn(),Kn(ee),no(),No();const e=localStorage.getItem("cn_last_version");if(e&&e!==Oe){localStorage.setItem("cn_last_version",Oe),console.log(`Nueva versi√≥n detectada (${Oe}). Recargando...`),S("üöÄ Actualizando a la √∫ltima versi√≥n..."),setTimeout(()=>location.reload(!0),1500);return}localStorage.setItem("cn_last_version",Oe),await gn(ee),Po(),$o(),Mo(),Ho(),Oo(),Ro(),Fo(),z(),console.log("Aplicaci√≥n lista.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",nn):nn();function Lo(){const t=document.getElementById("root");if(!t)return console.error("No se encontr√≥ el elemento #root");t.innerHTML=`
        ${pn()}
        ${Gn()}
        ${Wn()}
        ${Jn()}
        ${to()}
        ${oo()}
    `,console.log("Estructura inyectada.")}function ee(){qt(ze),Ht(yt,u.categories),Dn(),z()}function yt(t,e){u.currentView=t,Dn(e),qt(ze),document.querySelectorAll("[data-view]").forEach(n=>{n.classList.toggle("active",n.dataset.view===t)}),Ht(yt)}function Dn(t=null){const e=document.getElementById("view-title"),n=document.getElementById("view-desc");if(!e)return;const o=u.categories.find(i=>i.id===u.currentView),a=t||(o?o.name:p("header.view_title_all"));e.innerText=a,n&&(n.innerText=u.currentView==="all"?"Organiza tus pensamientos y protege tu privacidad.":"",n.style.display=u.currentView==="all"?"block":"none")}function Bn(){const t=u.settings.theme==="dark";document.documentElement.classList.toggle("dark",t),document.documentElement.classList.toggle("light",!t)}function B(t,e){const n=document.getElementById(t);n&&(n.onclick=e)}function No(){B("add-note-btn",()=>ze()),B("mobile-add-btn",()=>ze()),B("sync-btn",Ce),B("mobile-sync-btn",Ce),B("mobile-sync-btn-bottom",Ce),B("settings-trigger",sn),B("mobile-settings-btn",()=>{Ee(),sn()}),B("sidebar-collapse-btn",()=>{const i=document.querySelector("aside");i.classList.toggle("collapsed");const r=i.classList.contains("collapsed");localStorage.setItem("sidebar_collapsed",r),Ln()}),B("mobile-force-reload-btn",Lt),document.body.addEventListener("click",i=>{i.target.closest("#logout-btn, #mobile-logout-btn")&&rn(),i.target.id==="mobile-sidebar-overlay"&&Ee()});const t=async()=>{u.settings.drivePath=document.getElementById("config-drive-path").value,u.settings.algo=document.getElementById("config-algo").value,u.settings.notesPerChunk=parseInt(document.getElementById("config-notes-per-chunk").value)||50,await J(),S("‚úÖ Configuraci√≥n guardada"),on()};B("save-sync-config",t),B("save-security-config",t),B("connect-drive-btn",An),B("theme-light",()=>ln("light")),B("theme-dark",()=>ln("dark")),document.querySelectorAll(".nav-link[data-view], .nav-link-mobile[data-view], .nav-link-mobile-drawer[data-view]").forEach(i=>{i.onclick=()=>{const r=i.dataset.view,s=u.categories.find(c=>c.id===r),l=s?s.name:r==="all"?p("header.view_title_all"):"";yt(r,l),Ee()}}),document.querySelectorAll(".nav-link-mobile-drawer[data-category]").forEach(i=>{i.onclick=r=>{r.preventDefault();const s=i.dataset.category;u.currentView=s,document.querySelectorAll(".nav-link[data-view], .nav-link-mobile[data-view]").forEach(l=>l.classList.remove("active")),document.querySelectorAll("#sidebar-categories .nav-link").forEach(l=>l.classList.remove("active")),document.querySelectorAll(".nav-link-mobile-drawer").forEach(l=>{const c=l.dataset.category===s;l.classList.toggle("active",c);const g=l.querySelector("i");g&&g.classList.toggle("text-primary",c);const d=l.querySelector("span");d&&d.classList.toggle("text-primary",c)}),Ee(),ee()}}),B("sidebar-manage-cats",an),B("mobile-manage-cats",()=>{Ee(),an()}),B("add-cat-btn",jo);const n=i=>{const r=i.target.closest("#settings-modal, #categories-modal, #editor-modal");r&&r.classList.add("hidden")};document.querySelectorAll(".close-modal, .close-settings, .close-categories").forEach(i=>{i.onclick=n}),document.body.addEventListener("click",i=>{const r=i.target.closest(".toggle-pass");if(!r)return;const s=document.getElementById(r.dataset.target);if(!s)return;const l=s.type==="password";s.type=l?"text":"password",r.innerHTML=`<i data-lucide="${l?"eye-off":"eye"}" class="w-4 h-4"></i>`,z()}),document.body.addEventListener("keydown",i=>{if(i.key==="Enter"){const r=document.getElementById("auth-shield");if(r&&!r.classList.contains("hidden")){const s=document.getElementById("master-password"),l=document.getElementById("confirm-password");(document.activeElement===s||document.activeElement===l)&&Bt(ee)}}}),B("auth-submit",()=>Bt(ee)),B("auth-biometric",()=>{it(()=>Promise.resolve().then(()=>Vn),void 0).then(i=>{i.handleBiometricAuth(ee)})});const o=document.getElementById("factory-reset-confirm"),a=document.getElementById("factory-reset");if(o&&a){const i=p("settings.reset_keyword").toLowerCase();o.oninput=()=>{a.disabled=o.value.toLowerCase()!==i},a.onclick=()=>{o.value.toLowerCase()===i&&(localStorage.clear(),sessionStorage.clear(),location.reload())}}window.triggerAutoSync=on,window.handleLogout=rn,window.openEditor=ze}function Po(){const t=o=>{const a=o.target.value.toLowerCase();document.querySelectorAll(".note-card").forEach(r=>{const s=u.notes.find(c=>c.id===r.dataset.id);if(!s)return;const l=s.title.toLowerCase().includes(a)||s.content.toLowerCase().includes(a);r.classList.toggle("hidden",!l)})},e=document.getElementById("search-input"),n=document.getElementById("mobile-search-input-top");e&&(e.oninput=t),n&&(n.oninput=t)}function $o(){const t=document.getElementById("mobile-sidebar-overlay"),e=()=>{t==null||t.classList.remove("hidden"),Ht(yt,u.categories)};B("mobile-sidebar-trigger",e),B("mobile-sidebar-trigger-bottom",e),B("close-mobile-sidebar",Ee);const n=document.getElementById("mobile-search-bar"),o=document.getElementById("mobile-search-input-top"),a=()=>{n==null||n.classList.remove("hidden"),o==null||o.focus()};B("mobile-search-btn",a),B("mobile-search-trigger",a),B("close-mobile-search",()=>{n&&n.classList.add("hidden"),o&&(o.value="",o.dispatchEvent(new Event("input")))}),B("mobile-search-trigger",async()=>{const i=await ne("Buscar Notas","Ingresa t√©rmino de b√∫squeda:");if(i!==null){const r=document.getElementById("search-input");if(r){r.value=i,r.dispatchEvent(new Event("input"));const s=document.getElementById("notes-viewport");s&&(s.scrollTop=0)}}})}function Oo(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(e=>{console.log("SW registrado corectamente:",e.scope)}).catch(e=>{console.log("Fallo al registrar SW:",e)})})}function Mo(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),Pe=e,["pwa-install-btn","sidebar-pwa-install-btn","mobile-pwa-install-btn"].forEach(o=>{var a;return(a=document.getElementById(o))==null?void 0:a.classList.remove("hidden")})});const t=async()=>{if(!Pe)return;Pe.prompt();const{outcome:e}=await Pe.userChoice;e==="accepted"&&["pwa-install-btn","sidebar-pwa-install-btn","mobile-pwa-install-btn"].forEach(o=>{var a;return(a=document.getElementById(o))==null?void 0:a.classList.add("hidden")}),Pe=null};B("pwa-install-btn",t),B("sidebar-pwa-install-btn",t),B("mobile-pwa-install-btn",t)}function Ho(){const t=setInterval(()=>{typeof gapi<"u"&&typeof google<"u"&&google.accounts&&(clearInterval(t),gapi.load("client",async()=>{await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),u.gapiLoaded=!0,u.tokenClient=google.accounts.oauth2.initTokenClient({client_id:Ao,scope:"https://www.googleapis.com/auth/drive.file",callback:async n=>{if(n.error)return S("‚ùå Error de vinculaci√≥n");const o=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(!o)return S("‚ùå Error: Sesi√≥n no v√°lida");try{const a=new dn("notev3_",u.settings.drivePath,u.settings.notesPerChunk),i=await a.getOrCreateFolder(u.settings.drivePath);gapi.client.setToken(n),await a.loadChunks(i,o)&&S("‚úÖ Drive verificado: Contrase√±a correcta"),localStorage.setItem("gdrive_token_v3",JSON.stringify(n)),gapi.client.setToken(n),$e(!0),S("‚úÖ Vinculado con Google Drive"),Ce()}catch(a){console.error("Drive connection error:",a),S("‚ùå Error al verificar Drive")}}});const e=localStorage.getItem("gdrive_token_v3");if(e){const n=JSON.parse(e);gapi.client.setToken(n),$e(!0),setTimeout(()=>$e(!0),500),setTimeout(()=>$e(!0),2e3)}else $e(!1)}))},500)}function An(){if(!u.tokenClient)return S(typeof gapi>"u"||typeof google>"u"?"‚è≥ Cargando librer√≠as de Google...":"‚è≥ Inicializando API de Google...");u.tokenClient.requestAccessToken({prompt:""})}function $e(t){const e=document.getElementById("drive-status"),n=document.getElementById("sync-btn");e&&(e.innerHTML=t?'<span class="flex items-center gap-2 text-green-500 font-bold"><i data-lucide="check-circle" class="w-4 h-4"></i> Conectado</span>':'<span class="flex items-center gap-2 text-muted-foreground font-bold font-mono uppercase"><i data-lucide="x-circle" class="w-4 h-4"></i> No conectado</span>',e.className=t?"text-[10px] px-2 py-0.5 rounded-full bg-primary/10 text-primary":"text-[10px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground"),n&&(n.style.opacity=t?"1":"0.3",n.style.pointerEvents=t?"auto":"none"),z()}let Dt=!1;async function Ce(){if(Dt)return;const t=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(!t)return;const e=document.querySelectorAll('#sync-icon, [data-lucide="refresh-cw"]'),n=document.querySelectorAll("#sync-btn, #mobile-sync-btn, #mobile-sync-btn-bottom");Dt=!0,e.forEach(o=>o.classList.add("animate-spin")),n.forEach(o=>o.classList.add("text-primary"));try{const o=new dn("notev3_",u.settings.drivePath,u.settings.notesPerChunk),a=await o.getOrCreateFolder(u.settings.drivePath),i=await o.loadChunks(a,t);if(i)try{if(i&&Array.isArray(i.notes)){const r=new Map(i.notes.map(f=>[f.id,f])),s=new Map(u.notes.map(f=>[f.id,f])),l=new Set([...r.keys(),...s.keys()]),c=Array.from(l).map(f=>{const m=s.get(f),h=r.get(f);return m?h&&h.updatedAt>m.updatedAt?h:m:h});u.notes=c.sort((f,m)=>m.updatedAt-f.updatedAt);const g=new Map(i.categories.map(f=>[f.id,f])),d=new Map(u.categories.map(f=>[f.id,f])),v=new Set([...g.keys(),...d.keys()]);u.categories=Array.from(v).map(f=>d.get(f)||g.get(f)),await J(),ee()}}catch(r){console.error("Decryption failed during sync pull",r),S("‚ö†Ô∏è No se pudo descargar: Contrase√±a no coincide")}await o.saveChunks(u.notes,u.categories,t,a),S("‚úÖ Sincronizaci√≥n completa")}catch(o){console.error("Sync error:",o),o.status===401||o.result&&o.result.error&&o.result.error.code===401?(S("‚ö†Ô∏è Sesi√≥n de Drive expirada. Re-conectando..."),An()):S("‚ùå Error de sincronizaci√≥n")}finally{Dt=!1;const o=document.querySelectorAll('#sync-icon, [data-lucide="refresh-cw"]'),a=document.querySelectorAll("#sync-btn, #mobile-sync-btn, #mobile-sync-btn-bottom");o.forEach(i=>i.classList.remove("animate-spin")),a.forEach(i=>i.classList.remove("text-primary"))}}function on(){const t=localStorage.getItem("gdrive_token_v3"),e=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");u.gapiLoaded&&t&&e&&Ce()}function an(){const t=document.getElementById("categories-modal");t&&(t.classList.remove("hidden"),Je(ee,u.categories))}function Ee(){const t=document.getElementById("mobile-sidebar-overlay"),e=document.getElementById("mobile-sidebar-drawer");!t||t.classList.contains("hidden")||(e?(e.classList.add("animate-out","slide-out-to-left"),t.classList.add("fade-out"),setTimeout(()=>{t.classList.add("hidden"),e.classList.remove("animate-out","slide-out-to-left")},200)):t.classList.add("hidden"))}async function jo(){const t=document.getElementById("new-cat-name"),e=t==null?void 0:t.value.trim();if(!e)return;const n={id:"cat_"+Date.now(),name:e,icon:"tag",passwordHash:null};u.categories.push(n),await J(),t&&(t.value=""),Je(ee,u.categories),ee(),localStorage.getItem("gdrive_token_v3")&&Ce()}function rn(){localStorage.removeItem("cn_vault_key_v3"),sessionStorage.removeItem("cn_vault_key_v3"),localStorage.removeItem("cn_pass_plain_v3"),sessionStorage.removeItem("cn_pass_plain_v3"),location.reload()}function Ro(){["app-version","settings-version-display","mobile-app-version"].forEach(t=>{const e=document.getElementById(t);e&&(e.innerText=Oe)})}function sn(){const t=document.getElementById("settings-modal");if(t){t.classList.remove("hidden"),document.getElementById("config-drive-path").value=u.settings.drivePath,document.getElementById("config-algo").value=u.settings.algo,document.getElementById("config-sync-chunk-size")&&(document.getElementById("config-sync-chunk-size").value=u.settings.syncChunkSize||500);const e=t.querySelector('.settings-tab[data-tab="appearance"]');if(e&&window.innerWidth>=768&&e.click(),window.innerWidth<768){const n=document.getElementById("settings-sidebar"),o=document.getElementById("settings-content-area");n&&o&&(n.classList.remove("hidden"),o.classList.add("hidden"))}}}function Fo(){const t=localStorage.getItem("sidebar_collapsed")==="true",e=document.querySelector("aside");e&&t&&(e.classList.add("collapsed"),Ln())}function Ln(){const t=document.querySelector("aside");if(!t)return;const e=t.classList.contains("collapsed"),n=document.getElementById("sidebar-collapse-icon");n&&(n.setAttribute("data-lucide",e?"chevrons-right":"chevrons-left"),z())}function ln(t){u.settings.theme=t,Bn(),J()}
