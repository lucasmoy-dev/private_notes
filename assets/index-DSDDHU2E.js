(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}})();class M{static async hash(e,o="salt_cloud_notes_2026"){const i=new TextEncoder().encode(e+o),a=await crypto.subtle.digest("SHA-512",i);return Array.from(new Uint8Array(a)).map(s=>s.toString(16).padStart(2,"0")).join("")}static async deriveVaultKey(e){return await this.hash(e,"vault_v3_internal_key")}static async compress(e){const n=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip"));return await new Response(n).arrayBuffer()}static async decompress(e){const n=new Blob([e]).stream().pipeThrough(new DecompressionStream("gzip"));return await new Response(n).text()}static async deriveKey(e,o){const n=new TextEncoder,i=await crypto.subtle.importKey("raw",n.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:n.encode(o),iterations:25e4,hash:"SHA-512"},i,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}static async encrypt(e,o,n={algo:"aes-256-gcm"}){try{const i=crypto.getRandomValues(new Uint8Array(16)),a=crypto.getRandomValues(new Uint8Array(12)),r=await this.deriveKey(o,this.bufToBase64(i)),s=typeof e=="string"?e:JSON.stringify(e),l=await this.compress(s),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},r,l);return{payload:this.bufToBase64(new Uint8Array(c)),iv:this.bufToBase64(a),salt:this.bufToBase64(i),algo:n.algo||"aes-256-gcm",compressed:!0,v:"4.0"}}catch(i){throw console.error("[Security] Encryption failed:",i),new Error("No se pudo encriptar la informaci√≥n")}}static async decrypt(e,o){try{if(!e||!e.payload||!e.iv||!e.salt)throw new Error("Formato de datos encriptados inv√°lido");const{payload:n,iv:i,salt:a,compressed:r}=e,s=await this.deriveKey(o,a),l=await crypto.subtle.decrypt({name:"AES-GCM",iv:this.base64ToBuf(i)},s,this.base64ToBuf(n)),c=r?await this.decompress(l):new TextDecoder().decode(l);try{return JSON.parse(c)}catch{return c}}catch(n){throw console.error("[Security] Decryption failed:",n),new Error("Contrase√±a incorrecta o datos corruptos")}}static bufToBase64(e){return btoa(String.fromCharCode(...new Uint8Array(e)))}static base64ToBuf(e){return new Uint8Array(atob(e).split("").map(o=>o.charCodeAt(0)))}}const u={notes:[],categories:[],settings:{theme:"dark",drivePath:"/backup/notes/",algo:"aes-256-gcm",notesPerChunk:50},currentView:"all",editingNoteId:null,unlockedNotes:new Set,unlockedCategories:new Set,gapiLoaded:!1,tokenClient:null};async function K(){const t=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(t){const e=await M.encrypt(u.notes,t),o=await M.encrypt(u.categories,t);localStorage.setItem("cn_notes_v3_enc",JSON.stringify(e)),localStorage.setItem("cn_categories_v3_enc",JSON.stringify(o)),localStorage.removeItem("cn_notes_v3"),localStorage.removeItem("cn_categories_v3")}localStorage.setItem("cn_settings_v3",JSON.stringify(u.settings))}async function nn(t){try{const e=localStorage.getItem("cn_notes_v3_enc"),o=localStorage.getItem("cn_categories_v3_enc");if(e)u.notes=await M.decrypt(JSON.parse(e),t);else{const n=localStorage.getItem("cn_notes_v3");n&&(u.notes=JSON.parse(n))}if(o)u.categories=await M.decrypt(JSON.parse(o),t);else{const n=localStorage.getItem("cn_categories_v3");n&&(u.categories=JSON.parse(n))}}catch(e){throw console.error("Failed to load encrypted data",e),e}}function _n(){const t=localStorage.getItem("cn_settings_v3");t&&(u.settings={...u.settings,...JSON.parse(t)},u.settings.syncChunkSize!==void 0&&(u.settings.notesPerChunk||(u.settings.notesPerChunk=50),delete u.settings.syncChunkSize))}const Pe="v3.6.40",Xe=[{id:"default",light:"#ffffff",dark:"#09090b"},{id:"red",light:"#fef2f2",dark:"#450a0a"},{id:"orange",light:"#fff7ed",dark:"#431407"},{id:"yellow",light:"#fefce8",dark:"#422006"},{id:"green",light:"#f0fdf4",dark:"#064e3b"},{id:"teal",light:"#f0fdfa",dark:"#134e4a"},{id:"blue",light:"#eff6ff",dark:"#1e3a8a"},{id:"darkblue",light:"#eef2ff",dark:"#1e1b4b"},{id:"purple",light:"#faf5ff",dark:"#3b0764"},{id:"pink",light:"#fdf2f8",dark:"#500724"},{id:"brown",light:"#fffaf5",dark:"#2d1a10"},{id:"gold",light:"#fef3c7",dark:"#451a03"},{id:"rose",light:"#fff1f2",dark:"#4c0519"},{id:"indigo",light:"#eef2ff",dark:"#312e81"},{id:"slate",light:"#f1f5f9",dark:"#1e293b"},{id:"gray",light:"#f8fafc",dark:"#0f172a"}],Cn=["#ffffff","#f28b82","#fbbc04","#fff475","#ccff90","#a7ffeb","#cbf0f8","#aecbfa","#d7aefb","#fdcfe8","#e6c9a8","#e8eaed","#6366f1","#ec4899","#f43f5e","#10b981","#f59e0b","#06b6d4","#1e293b","#450a0a","#422006","#064e3b","#134e4a","#1e3a8a","#1e1b4b","#4c1d95","#500724","#27272a","#09090b","#312e81"],Tn=["üòä","üòÇ","ü•∞","üòé","ü§î","üò¥","üî•","‚ú®","üöÄ","üéâ","‚ù§Ô∏è","üëç","üí°","üìÖ","‚úÖ","‚ùå","üîí","üîë","üìå","üé®","üìÅ","üè†","üåü","üåç","üíª","üì±","üçé","üçï","üç∫","üåà","‚òÄÔ∏è","üåô","‚ö°","üíé","üéÅ","üéà","üéµ","üì∑","üîç","üõ∏","üëæ","ü§ñ","üëª","ü¶Ñ","üêæ","üèÄ","‚öΩ","üöó","‚úàÔ∏è","üïπÔ∏è","üéÆ","üé≤","üß©","üé≠","üé¨","üé§","üéß","üéπ","üé∏","üéª","üé∫","üé∑","ü•Å","üèπ","üé£","üöµ","üßó","üßò","üõÅ","üõå","üóùÔ∏è","üõ°Ô∏è","‚öîÔ∏è","üó∫Ô∏è","üïØÔ∏è","‚åõ","‚öñÔ∏è","‚öôÔ∏è","‚öíÔ∏è","üõ†Ô∏è","‚õèÔ∏è","‚õìÔ∏è","üî≠","üî¨","üíä","üíâ","üß¨","ü©∏","üß™","üå°Ô∏è","üß¥","üßπ","üß∫","üßº","üßΩ","ü™£","ü™í","üßª","üõÄ","üöø","üöΩ"],Dn=["tag","briefcase","home","user","heart","star","shopping-cart","book","code","coffee","graduation-cap","music","camera","plane","bike","gift","bell","calendar","map-pin","search","folder","database","globe","terminal","cpu","layers","layout","activity","archive","award","bar-chart","bookmark","box","briefcase","check-circle","clock","cloud","compass","edit","external-link","eye","file-text","flag","folder-open","image","info","key","life-buoy","link","list","mail","message-circle","mic","monitor","moon","mouse-pointer","package","paperclip","phone","pie-chart","play","plus","printer","save","send","settings","share-2","shield","shopping-bag","slack","smartphone","speaker","sun","tablet","target","tool","truck","tv","umbrella","video","watch","wifi","zap"];function D(t,e=3e3){const o=document.getElementById("toast");o&&(o.querySelector("div").innerText=t,o.classList.add("show"),setTimeout(()=>o.classList.remove("show"),e))}function fe(t,e,o=!0){return new Promise(n=>{const i=document.getElementById("prompt-modal"),a=document.getElementById("prompt-input");if(!i||!a)return n(null);document.getElementById("prompt-title").innerText=t,document.getElementById("prompt-desc").innerText=e,a.type=o?"password":"text",a.value="",i.classList.remove("hidden"),R(),a.focus();const r=()=>{i.classList.add("hidden"),window.removeEventListener("keydown",s)},s=f=>{f.key==="Enter"&&l(),f.key==="Escape"&&c()};window.addEventListener("keydown",s);const l=()=>{const f=a.value;r(),n(f)},c=()=>{r(),n(null)};document.getElementById("prompt-confirm").onclick=l,document.getElementById("prompt-cancel").onclick=c})}function Bn(t){if(!t)return!0;const e=t.replace("#",""),o=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),i=parseInt(e.substr(4,2),16);return isNaN(o)||isNaN(n)||isNaN(i)?!0:(o*299+n*587+i*114)/1e3<128}function R(){typeof lucide<"u"&&lucide.createIcons&&lucide.createIcons()}class on{constructor(e="notev3_",o="/backup/notes/",n=50){this.basePath=o,this.dbPrefix=e,this.notesPerChunk=n,this.metaFile=e+"meta_v4.bin",this.groupPrefix=e+"group_v4_"}async getOrCreateFolder(e){const o=e.split("/").filter(i=>i);let n="root";for(const i of o){const a=`name = '${i}' and mimeType = 'application/vnd.google-apps.folder' and '${n}' in parents and trashed = false`,s=(await gapi.client.drive.files.list({q:a,fields:"files(id, name)"})).result.files;if(s.length>0)n=s[0].id;else{const l={name:i,mimeType:"application/vnd.google-apps.folder",parents:[n]};n=(await gapi.client.drive.files.create({resource:l,fields:"id"})).result.id}}return n}async calculateHash(e){const o=JSON.stringify(e),n=new TextEncoder().encode(o),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(r=>r.toString(16).padStart(2,"0")).join("")}async saveChunks(e,o,n,i){console.log(`[Drive] Saving ${e.length} notes in groups of ${this.notesPerChunk}`);const a=`'${i}' in parents and trashed = false`,s=(await gapi.client.drive.files.list({q:a,fields:"files(id, name)"})).result.files||[],l=new Map(s.map(h=>[h.name,h.id]));let c=null;const f=l.get(this.metaFile);if(f)try{const h=gapi.auth.getToken().access_token,_=`https://www.googleapis.com/drive/v3/files/${f}?alt=media`,y=await(await fetch(_,{headers:{Authorization:`Bearer ${h}`}})).json();c=await M.decrypt(y,n)}catch{console.log("Failed to load previous meta.")}const d={},m=[];for(let h=0;h<e.length;h+=this.notesPerChunk)m.push(e.slice(h,h+this.notesPerChunk));for(let h=0;h<m.length;h++){const _=await this.calculateHash(m[h]);d[h]=_;const C=!c||!c.groupHashes||c.groupHashes[h]!==_,y=`${this.groupPrefix}${h.toString().padStart(5,"0")}.bin`;if(C||!l.has(y)){const v=await M.encrypt(m[h],n);await this.uploadFileWithId(y,JSON.stringify(v),i,l.get(y)),console.log(`[Drive] ${l.has(y)?"Updated":"Created"} ${y}`)}}if(c&&c.groupHashes){const h=Object.keys(c.groupHashes).map(Number);for(const _ of h)if(_>=m.length){const C=`${this.groupPrefix}${_.toString().padStart(5,"0")}.bin`,y=l.get(C);y&&(await gapi.client.drive.files.delete({fileId:y}),console.log(`[Drive] Deleted orphaned group: ${C}`))}}const g={categories:o,groupHashes:d},b=await M.encrypt(g,n);return await this.uploadFileWithId(this.metaFile,JSON.stringify(b),i,f),console.log("[Drive] Push complete."),m.length}async loadChunks(e,o){const n=`'${e}' in parents and trashed = false`,a=(await gapi.client.drive.files.list({q:n,fields:"files(id, name)"})).result.files||[],r=new Map(a.map(f=>[f.name,f.id])),s=r.get(this.metaFile);if(s)try{const f=gapi.auth.getToken().access_token,d=`https://www.googleapis.com/drive/v3/files/${s}?alt=media`,g=await(await fetch(d,{headers:{Authorization:`Bearer ${f}`}})).json(),b=await M.decrypt(g,o);console.log(`[Drive] Loading v4 data. Groups: ${Object.keys(b.groupHashes).length}`);const h=[],_=Object.keys(b.groupHashes).sort((C,y)=>C-y);for(const C of _){const y=`${this.groupPrefix}${C.toString().padStart(5,"0")}.bin`,v=r.get(y);if(v){const I=`https://www.googleapis.com/drive/v3/files/${v}?alt=media`,O=await(await fetch(I,{headers:{Authorization:`Bearer ${f}`}})).json(),$=await M.decrypt(O,o);h.push(...$)}}return{notes:h,categories:b.categories}}catch(f){console.error("[Drive] v4 Load failed",f)}const l="data_part_",c=a.filter(f=>f.name.startsWith(this.dbPrefix+l)).sort((f,d)=>f.name.localeCompare(d.name));if(c.length>0){console.log(`[Drive] Migrating ${c.length} legacy chunks...`);const f=gapi.auth.getToken().access_token;let d="";for(const m of c){const g=`https://www.googleapis.com/drive/v3/files/${m.id}?alt=media`,b=await fetch(g,{headers:{Authorization:`Bearer ${f}`}});d+=await b.text()}try{const m=JSON.parse(d);return await M.decrypt(m,o)}catch(m){console.error("[Drive] Legacy migration failed",m)}}return null}async uploadFileWithId(e,o,n,i=null){const a={name:e,parents:i?[]:[n]},r=new Blob([o],{type:"application/json"}),s=gapi.auth.getToken().access_token;if(i){const l=`https://www.googleapis.com/upload/drive/v3/files/${i}?uploadType=media`;await fetch(l,{method:"PATCH",headers:{Authorization:`Bearer ${s}`},body:r})}else{const l="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",c=new FormData;c.append("metadata",new Blob([JSON.stringify(a)],{type:"application/json"})),c.append("file",r),await fetch(l,{method:"POST",headers:{Authorization:`Bearer ${s}`},body:c})}}}function An(){const t=!!(sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3"));return`
    <div id="auth-shield" class="fixed inset-0 z-[100] flex items-center justify-center bg-background/95 backdrop-blur-sm transition-opacity duration-300 ${t?"opacity-0 pointer-events-none":""}" style="${t?"display: none":""}">
        <div class="w-full max-w-sm p-8 space-y-6 bg-card border rounded-lg shadow-lg">
            <div class="text-center space-y-2">
                <div class="mx-auto w-10 h-10 bg-primary rounded-md flex items-center justify-center text-primary-foreground">
                    <i data-lucide="lock" class="w-5 h-5"></i>
                </div>
                <h1 class="text-2xl font-semibold tracking-tight" id="auth-title">B√≥veda Protegida</h1>
                <p class="text-sm text-muted-foreground" id="auth-desc">Ingresa tu contrase√±a maestra para continuar</p>
            </div>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="password" id="master-password" placeholder="Tu contrase√±a" class="h-11 w-full pl-4 pr-12 text-base">
                    <button type="button" class="absolute right-0 top-0 h-11 w-11 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass" data-target="master-password">
                        <i data-lucide="eye" class="w-4 h-4 icon-show"></i>
                    </button>
                </div>
                <div class="relative group hidden" id="confirm-password-wrapper">
                    <input type="password" id="confirm-password" placeholder="Repite la contrase√±a" class="h-11 w-full pl-4 pr-12 text-base">
                    <button type="button" class="absolute right-0 top-0 h-11 w-11 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass" data-target="confirm-password">
                        <i data-lucide="eye" class="w-4 h-4 icon-show"></i>
                    </button>
                </div>
                
                <div class="flex items-center gap-2 py-1">
                    <input type="checkbox" id="auth-remember" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary">
                    <label for="auth-remember" class="text-xs text-muted-foreground cursor-pointer select-none">Recordar mi contrase√±a en este navegador</label>
                </div>

                <button id="auth-submit" class="btn-shad btn-shad-primary w-full h-11 font-bold">Desbloquear</button>
                
                <div id="auth-extra-actions" class="hidden pt-4 border-t border-border/50">
                    <button id="auth-force-reload" class="flex items-center justify-center gap-2 w-full p-3 text-xs text-destructive bg-destructive/5 hover:bg-destructive/10 rounded-lg border border-destructive/10 transition-all font-medium">
                        <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i> ¬øProblemas? Forzar limpieza y recarga
                    </button>
                </div>
            </div>
        </div>
    </div>`}async function Ln(t){const e=document.getElementById("auth-shield"),o=!localStorage.getItem("cn_master_hash_v3"),n=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(o)Nn();else if(n){e.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>e.style.display="none",300);const i=document.getElementById("app");i&&i.classList.remove("opacity-0");try{await nn(n),t()}catch{console.error("Auto-auth failed, clearing keys."),sessionStorage.removeItem("cn_vault_key_v3"),localStorage.removeItem("cn_vault_key_v3"),$t()}}else $t()}function Nn(){const t=document.getElementById("auth-title"),e=document.getElementById("auth-desc"),o=document.getElementById("confirm-password-wrapper"),n=document.getElementById("auth-submit");t&&(t.innerText="Configura tu B√≥veda"),e&&(e.innerText="Crea una contrase√±a maestra. Introduce la contrase√±a dos veces para asegurar que es correcta."),o&&o.classList.remove("hidden"),n&&(n.innerText="Crear mi B√≥veda",n.classList.remove("btn-shad-primary"),n.classList.add("btn-shad-success"));const i=document.getElementById("auth-extra-actions");i&&i.classList.remove("hidden");const a=document.getElementById("auth-force-reload");a&&(a.onclick=()=>{confirm("Esto limpiar√° todos los datos locales y recargar√° la aplicaci√≥n. ¬øContinuar?")&&(localStorage.clear(),sessionStorage.clear(),window.location.reload(!0))}),R()}function $t(){const t=document.getElementById("auth-title"),e=document.getElementById("auth-desc"),o=document.getElementById("confirm-password-wrapper"),n=document.getElementById("auth-submit");t&&(t.innerText="B√≥veda Protegida"),e&&(e.innerText="Ingresa tu contrase√±a maestra para continuar"),o&&o.classList.add("hidden"),n&&(n.innerText="Desbloquear",n.classList.add("btn-shad-primary"),n.classList.remove("btn-shad-success"));const i=document.getElementById("auth-extra-actions");i&&i.classList.remove("hidden");const a=document.getElementById("auth-force-reload");a&&(a.onclick=()=>{confirm("Esto limpiar√° todos los datos locales y recargar√° la aplicaci√≥n. ¬øContinuar?")&&(localStorage.clear(),sessionStorage.clear(),window.location.reload(!0))}),R()}async function zt(t){const e=document.getElementById("master-password").value,o=document.getElementById("confirm-password").value,n=!localStorage.getItem("cn_master_hash_v3");if(!e)return D("Ingresa una contrase√±a");if(n){if(!o)return D("Confirma tu contrase√±a");if(e!==o)return D("‚ö†Ô∏è ¬°Las contrase√±as no coinciden!");if(e.length<4)return D("La contrase√±a debe tener al menos 4 caracteres")}const i=await M.hash(e),a=await M.deriveVaultKey(e),r=localStorage.getItem("cn_master_hash_v3"),s=document.getElementById("auth-remember").checked;if(localStorage.removeItem("cn_pass_plain_v3"),sessionStorage.removeItem("cn_pass_plain_v3"),!r)localStorage.setItem("cn_master_hash_v3",i),sessionStorage.setItem("cn_vault_key_v3",a),s&&localStorage.setItem("cn_vault_key_v3",a),D("‚úÖ B√≥veda creada con √©xito");else if(r===i)sessionStorage.setItem("cn_vault_key_v3",a),s?localStorage.setItem("cn_vault_key_v3",a):localStorage.removeItem("cn_vault_key_v3"),D("B√≥veda abierta");else return D("‚ùå Contrase√±a incorrecta");const l=document.getElementById("auth-shield");l.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>l.style.display="none",300),document.getElementById("app").classList.remove("opacity-0"),await nn(a),t()}function Pn(){return`
    <div id="app" class="flex h-screen overflow-hidden opacity-100 transition-opacity duration-300">
        <!-- Sidebar Desktop -->
        <aside class="w-64 hidden md:flex flex-col border-r bg-sidebar">
            <style>
                @keyframes logo-rainbow {
                    0% { color: #6366f1; filter: drop-shadow(0 0 2px #6366f1); }
                    33% { color: #ec4899; filter: drop-shadow(0 0 2px #ec4899); }
                    66% { color: #10b981; filter: drop-shadow(0 0 2px #10b981); }
                    100% { color: #6366f1; filter: drop-shadow(0 0 2px #6366f1); }
                }
                .logo-animate { animation: logo-rainbow 8s infinite linear; }
            </style>
            <div class="p-6 flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 overflow-hidden" id="sidebar-logo-container">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 p-2 flex items-center justify-center border border-primary/20 shadow-inner shrink-0">
                        <svg viewBox="0 0 24 24" fill="none" class="w-full h-full logo-animate" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                        </svg>
                    </div>
                    <div class="sidebar-title-text transition-opacity duration-300">
                        <h1 class="text-sm font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent truncate">Private Notes</h1>
                    </div>
                </div>
                <button id="sidebar-collapse-btn" class="p-2 hover:bg-accent rounded-md text-muted-foreground transition-all shrink-0" title="Contraer men√∫">
                    <i data-lucide="chevrons-left" class="w-4 h-4" id="sidebar-collapse-icon"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto px-4 space-y-8">
                <div class="space-y-1">
                    <button class="nav-link w-full" data-view="all">
                        <i data-lucide="layout-grid" class="w-4 h-4"></i> <span class="sidebar-label text-foreground/90 font-bold">Todas las notas</span>
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center justify-between px-4" id="sidebar-categories-header">
                        <h3 class="sidebar-section-title text-[11px] font-bold text-muted-foreground uppercase tracking-wider">Etiquetas</h3>
                    </div>
                    <div id="sidebar-categories" class="space-y-1"></div>
                </div>
            </div>

            <div class="p-6 space-y-2 mt-auto">
                <button id="sidebar-manage-cats" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="tag" class="w-3.5 h-3.5"></i> <span class="sidebar-label">Gestionar Etiquetas</span>
                </button>
                <button id="settings-trigger" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="settings" class="w-3.5 h-3.5"></i> <span class="sidebar-label">Configuraci√≥n</span>
                </button>
                <button id="sidebar-pwa-install-btn" class="hidden flex items-center gap-3 w-full px-4 py-3 rounded-lg text-sm font-bold text-indigo-600 dark:text-indigo-400 bg-indigo-500/10 hover:bg-indigo-500/20 transition-all">
                    <i data-lucide="download" class="w-4 h-4"></i> <span class="sidebar-label">Instalar Aplicaci√≥n</span>
                </button>
                <div class="mt-auto pt-4 border-t border-border/20 px-4">
                    <div id="app-version" class="text-[9px] text-muted-foreground font-mono opacity-50">v3.6.0</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col bg-background relative overflow-hidden h-full">
            <!-- Desktop Header -->
            <header class="hidden md:flex h-16 items-center justify-between px-8 border-b shrink-0">
                <div class="flex items-center gap-4 flex-1">
                    <div class="relative w-full max-w-sm">
                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                        <input type="text" id="search-input" placeholder="Buscar notas..." class="pl-12 h-9 w-full" autocomplete="off">
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="sync-btn" class="p-2 hover:bg-accent rounded-md text-muted-foreground transition-colors" title="Sincronizar ahora">
                        <i data-lucide="refresh-cw" class="w-5 h-5" id="sync-icon"></i>
                    </button>
                    <button id="pwa-install-btn" class="hidden btn-shad btn-shad-outline h-9 px-3">
                        <i data-lucide="download" class="w-4 h-4 mr-2"></i> Instalar
                    </button>
                    <button id="add-note-btn" class="btn-shad btn-shad-primary h-9">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Nueva Nota
                    </button>
                </div>
            </header>

            <!-- Mobile Top Bar Removed -->

            <!-- Grid -->
            <div id="notes-viewport" class="flex-1 overflow-y-auto p-4 md:p-8 pb-24 md:pb-8">
                <div class="max-w-7xl mx-auto space-y-8">
                    <div class="flex items-end justify-between">
                        <div>
                            <h1 id="view-title" class="text-3xl font-bold tracking-tight">Todas las notas</h1>
                        </div>
                    </div>
                    <div id="notes-grid" class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                </div>
            </div>

            <!-- Mobile Bottom Nav -->
            <nav class="md:hidden fixed bottom-0 left-0 right-0 h-16 bg-background/95 backdrop-blur-2xl border-t flex items-center justify-around z-40 pb-safe">
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-sidebar-trigger-bottom">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors nav-link-mobile" data-view="all">
                    <i data-lucide="home" class="w-6 h-6"></i>
                </button>
                <button class="flex items-center justify-center relative w-full h-full" id="mobile-add-btn">
                    <div class="w-14 h-14 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 text-white rounded-2xl shadow-xl shadow-indigo-500/40 flex items-center justify-center transform -translate-y-5 hover:scale-105 active:scale-90 transition-all">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </div>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-sync-btn-bottom">
                    <i data-lucide="refresh-cw" class="w-6 h-6"></i>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-search-trigger">
                    <i data-lucide="search" class="w-6 h-6"></i>
                </button>
            </nav>
        </main>

        <!-- Mobile Sidebar Drawer -->
        <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-background/80 backdrop-blur-sm z-[100] hidden">
            <div id="mobile-sidebar-drawer" class="w-[80vw] h-full bg-card border-r flex flex-col animate-in slide-in-from-left duration-300">
                <div class="p-6 flex items-center justify-between border-b">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 p-2 flex items-center justify-center border border-primary/20 shadow-inner shrink-0">
                            <svg viewBox="0 0 24 24" fill="none" class="w-full h-full logo-animate" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                        </div>
                        <h1 class="text-sm font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent truncate">Private Notes</h1>
                    </div>
                    <button id="close-mobile-sidebar" class="p-2 hover:bg-accent rounded-md">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-8">
                    <div class="space-y-1">
                        <button class="nav-link-mobile-drawer w-full" data-view="all">
                            <i data-lucide="layout-grid" class="w-4 h-4"></i> Todas las notas
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2" id="mobile-sidebar-categories-header">
                            <h3 class="sidebar-section-title">Etiquetas</h3>
                        </div>
                        <div id="mobile-sidebar-categories" class="space-y-1 px-2"></div>
                    </div>
                </div>
                <div class="p-6 border-t space-y-2">
                    <button id="mobile-pwa-install-btn" class="hidden flex items-center gap-3 w-full p-4 rounded-xl bg-gradient-to-r from-indigo-600 to-violet-600 text-white text-sm font-bold shadow-lg shadow-indigo-500/30">
                        <i data-lucide="download" class="w-5 h-5"></i> Instalar Aplicaci√≥n
                    </button>
                    <button id="mobile-manage-cats" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="tag" class="w-4 h-4"></i> Gestionar Etiquetas
                    </button>
                    <button id="mobile-settings-btn" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="settings" class="w-4 h-4"></i> Configuraci√≥n
                    </button>
                    <div class="pt-4 border-t space-y-3">
                        <div class="flex items-center justify-between px-3">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground/50">Sistema</span>
                            <span id="mobile-app-version" class="text-[10px] font-bold font-mono px-2 py-0.5 rounded bg-primary/10 text-primary">v3.6.0</span>
                        </div>
                        <button id="mobile-force-reload-btn" class="flex items-center gap-3 w-full p-3 rounded-md bg-destructive/5 text-destructive text-sm font-medium border border-destructive/10">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i> Forzar Limpieza y Recarga
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>`}let _t=null,le=null;function On(){return`
    <div id="editor-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-background/80 backdrop-blur-sm dialog-overlay"></div>
        <div class="dialog-content max-w-2xl h-[80vh] flex flex-col p-0">
            <div class="flex items-center gap-2 border-b pb-3 px-4 pt-4">
                <button id="close-editor" class="text-muted-foreground hover:text-foreground p-2 -ml-2" title="Volver">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <input type="text" id="edit-title" placeholder="T√≠tulo de la nota"
                    class="bg-transparent text-xl font-bold outline-none border-none placeholder:text-muted-foreground w-full">
                
                <div class="flex items-center gap-1">
                    <button id="note-expand-btn" class="editor-tool hidden md:inline-flex" title="Expandir">
                        <i data-lucide="maximize-2" class="w-5 h-5"></i>
                    </button>
                    <div class="relative">
                        <button id="note-options-btn" class="editor-tool" title="M√°s opciones">
                            <i data-lucide="more-vertical" class="w-5 h-5"></i>
                        </button>
                        <div id="note-options-menu" class="hidden absolute right-0 top-full mt-1 bg-popover border shadow-2xl rounded-xl p-1 z-[120] min-w-[170px]">
                            <button id="opt-copy-all" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors">
                                <i data-lucide="copy" class="w-4 h-4 text-muted-foreground"></i> Copiar todo
                            </button>
                            <button id="opt-download" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors border-b pb-2.5 mb-1.5">
                                <i data-lucide="download" class="w-4 h-4 text-muted-foreground"></i> Descargar .txt
                            </button>
                            <button id="opt-toggle-pin" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors">
                                <i data-lucide="pin" class="w-4 h-4 text-muted-foreground" id="opt-pin-icon"></i> <span id="opt-pin-label">Fijar nota</span>
                            </button>
                            <button id="opt-toggle-lock" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-accent rounded-md transition-colors border-b pb-2.5 mb-1.5">
                                <i data-lucide="lock" class="w-4 h-4 text-muted-foreground" id="opt-lock-icon"></i> <span id="opt-lock-label">Restringir</span>
                            </button>
                             <button id="opt-delete-note" class="flex items-center gap-3 w-full px-3 py-2.5 text-sm hover:bg-destructive/5 text-destructive rounded-md transition-colors font-medium">
                                <i data-lucide="trash-2" class="w-4 h-4"></i> Eliminar nota
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Toolbar (Unified top) -->
            <div class="px-4 border-b py-2 flex items-center bg-muted/20">
                <div class="flex items-center gap-1.5 flex-1 min-w-0 overflow-x-auto no-scrollbar py-0.5">
                    <button data-cmd="bold" class="editor-tool border bg-background shrink-0"><i data-lucide="bold" class="w-4 h-4"></i></button>
                    <button data-cmd="italic" class="editor-tool border bg-background shrink-0"><i data-lucide="italic" class="w-4 h-4"></i></button>
                    <button data-cmd="underline" class="editor-tool border bg-background shrink-0"><i data-lucide="underline" class="w-4 h-4"></i></button>
                    <div class="w-px h-6 bg-border mx-0.5 shrink-0"></div>
                    <button id="checklist-btn" class="editor-tool border bg-background shrink-0"><i data-lucide="check-square" class="w-4 h-4"></i></button>
                    <button id="mobile-checklist-btn" class="hidden editor-tool border bg-background shrink-0"><i data-lucide="check-square" class="w-4 h-4"></i></button>
                    <button data-cmd="insertUnorderedList" class="editor-tool border bg-background shrink-0"><i data-lucide="list" class="w-4 h-4"></i></button>
                    <button data-cmd="insertOrderedList" class="editor-tool border bg-background shrink-0"><i data-lucide="list-ordered" class="w-4 h-4"></i></button>
                    <div class="w-px h-6 bg-border mx-0.5 shrink-0"></div>
                    <button id="add-link" class="editor-tool border bg-background shrink-0"><i data-lucide="link" class="w-4 h-4"></i></button>
                    <button id="mobile-link-btn" class="hidden editor-tool border bg-background shrink-0"><i data-lucide="link" class="w-4 h-4"></i></button>
                    <button id="open-text-colors" class="editor-tool border bg-background shrink-0 relative"><i data-lucide="type" class="w-4 h-4"></i><div class="w-3 h-[2px] bg-red-500 rounded-full absolute bottom-1 right-2"></div></button>
                    <button id="mobile-text-color-btn" class="hidden editor-tool border bg-background shrink-0"><i data-lucide="type" class="w-4 h-4"></i></button>
                    <button id="open-emojis" class="editor-tool hidden md:inline-flex border bg-background shrink-0"><i data-lucide="smile" class="w-4 h-4"></i></button>
                </div>
            </div>

            <div class="flex-1 py-4 overflow-y-auto px-4 relative">
                <div id="edit-content" contenteditable="true"
                    class="min-h-[300px] outline-none text-base leading-relaxed prose prose-slate dark:prose-invert max-w-none"
                    placeholder="Empieza a escribir..."></div>
            </div>

            <div class="border-t py-2 px-4 flex items-center justify-between gap-3 editor-bottom-bar shrink-0">
                <div class="flex items-center gap-2 flex-1 min-w-0">
                    <button id="open-colors" class="editor-tool border border-input bg-background/50 transition-all shrink-0" title="Color de nota">
                        <i data-lucide="palette" class="w-4 h-4"></i>
                    </button>
                    <button id="open-colors-mobile" class="hidden editor-tool border border-input bg-background/50 shrink-0"><i data-lucide="palette" class="w-4 h-4"></i></button>

                    <div class="relative flex-1 min-w-0" id="cat-select-wrapper">
                        <button id="cat-dropdown-trigger"
                            class="h-9 w-full px-2 rounded-md border border-input bg-background/50 text-xs flex items-center justify-between gap-1 hover:bg-accent transition-all">
                            <i data-lucide="tag" id="selected-cat-icon" class="w-3.5 h-3.5 text-muted-foreground/60"></i>
                            <span id="selected-cat-label" class="truncate flex-1 text-left">Sin categor√≠a</span>
                            <i data-lucide="chevron-down" class="w-3 h-3 text-muted-foreground shrink-0"></i>
                        </button>
                        <div id="cat-dropdown-menu"
                            class="absolute bottom-full mb-2 left-0 w-48 bg-popover border rounded-md shadow-xl hidden z-50 py-1 overflow-hidden">
                        </div>
                        <select id="edit-category" class="hidden">
                            <option value="">Sin categor√≠a</option>
                        </select>
                    </div>
                </div>

                <button id="save-note" class="hidden md:flex btn-shad btn-shad-primary h-9 px-6 font-bold">Hecho</button>
                <button id="save-note-mobile" class="md:hidden btn-shad btn-shad-primary h-9 px-4 font-bold">OK</button>
            </div>
            
         </div>
    </div>
    
    <!-- Popovers -->
    <div id="color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="bg-color-grid"></div>
    </div>
    <div id="text-color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="text-color-grid"></div>
    </div>
    <div id="emoji-popover" class="fixed z-[60] hidden popover-content w-80">
        <div class="grid grid-cols-8 gap-2 h-64 overflow-y-auto" id="emoji-grid"></div>
    </div>`}function Mn(t){const e=document.getElementById("editor-modal");document.getElementById("edit-title");const o=document.getElementById("edit-content"),n=document.getElementById("close-editor"),i=document.getElementById("save-note");n.onclick=()=>ge();const a=async()=>{await ge(),t()};i.onclick=a;const r=document.getElementById("save-note-mobile");r&&(r.onclick=a);const s=async()=>{u.editingNoteId&&confirm("¬øEliminar esta nota?")&&(u.notes=u.notes.filter(v=>v.id!==u.editingNoteId),await K(),nt(),t())};document.getElementById("opt-delete-note").onclick=s,document.querySelectorAll(".editor-tool[data-cmd]").forEach(v=>{v.dataset.cmd&&(v.onmousedown=I=>{I.preventDefault(),ke(),document.execCommand(v.dataset.cmd,!1,v.dataset.val||null),ve()})}),jn(),o.onkeyup=()=>{Fe(),ve()},o.onmouseup=()=>{Fe(),ve()},o.onfocus=()=>{Fe(),ve()};const l=document.getElementById("edit-title");l.onfocus=()=>l.select(),l.onclick=()=>l.select();const c=document.getElementById("note-expand-btn");c.onclick=()=>{const v=e.querySelector(".dialog-content");v.classList.toggle("fullscreen");const I=v.classList.contains("fullscreen");c.innerHTML=`<i data-lucide="${I?"minimize-2":"maximize-2"}" class="w-5 h-5"></i>`,R()};const f=()=>{const v=document.getElementById("opt-toggle-pin").dataset.active==="true";At(!v),ge(!1)};document.getElementById("opt-toggle-pin").onclick=v=>{v.stopPropagation(),f()};const d=async()=>{if(document.getElementById("opt-toggle-lock").dataset.active==="true")lt(!1),u.tempEditorPassword=null,ge(!1);else{const I=await fe("Restringir Nota","Crea una contrase√±a para esta nota:");if(I){const H=document.getElementById("opt-toggle-lock");H.dataset.tempHash=await M.hash(I),lt(!0),ge(!1)}}};document.getElementById("opt-toggle-lock").onclick=v=>{v.stopPropagation(),d()};const m=document.getElementById("mobile-checklist-btn");m&&(m.onclick=()=>y());const g=document.getElementById("mobile-link-btn");g&&(g.onclick=()=>C());const b=document.getElementById("mobile-text-color-btn");b&&(b.onclick=v=>{ke(),Oe(v,"text-color-popover")});const h=document.getElementById("note-options-btn"),_=document.getElementById("note-options-menu");h.onclick=v=>{v.stopPropagation(),_.classList.toggle("hidden")},document.getElementById("opt-copy-all").onclick=()=>{const v=document.getElementById("edit-content").innerText;navigator.clipboard.writeText(v).then(()=>{D("‚úÖ Contenido copiado"),_.classList.add("hidden")})},document.getElementById("opt-download").onclick=()=>{const v=document.getElementById("edit-title").value||"nota",I=document.getElementById("edit-content").innerText,H=new Blob([I],{type:"text/plain"}),O=URL.createObjectURL(H),$=document.createElement("a");$.href=O,$.download=`${v}.txt`,$.click(),_.classList.add("hidden")},document.addEventListener("click",()=>{_&&_.classList.add("hidden")});const C=async()=>{const v=await fe("Insertar Enlace","Ingresa la URL:",!1);v&&(ke(),document.execCommand("createLink",!1,v.startsWith("http")?v:"https://"+v),o.querySelectorAll("a").forEach(H=>H.target="_blank"))};document.getElementById("add-link").onclick=C,document.getElementById("checklist-btn").onclick=()=>y();const y=()=>{var I;ke();const v=window.getSelection();if(v.rangeCount>0){const O=(I=v.getRangeAt(0).commonAncestorContainer.parentElement)==null?void 0:I.closest("li");O&&O.parentElement.classList.contains("checklist")?O.parentElement.classList.remove("checklist"):(document.execCommand("insertUnorderedList"),setTimeout(()=>{const $=window.getSelection();if($.rangeCount>0){let q=$.focusNode;for(;q&&q.nodeName!=="UL"&&q!==o;)q=q.parentNode;q&&q.nodeName==="UL"&&(q.classList.add("checklist"),q.querySelectorAll("li").forEach(z=>{z.dataset.checked||(z.dataset.checked="false")}))}},10))}ve()};o.onkeydown=v=>{v.key==="Tab"&&(v.preventDefault(),v.shiftKey?document.execCommand("outdent"):document.execCommand("indent"))},o.addEventListener("click",v=>{const I=v.target.closest(".checklist li");if(I){const H=I.getBoundingClientRect();v.clientX-H.left<35&&(v.preventDefault(),I.dataset.checked=I.dataset.checked==="true"?"false":"true",ge(!1),ve())}}),e.querySelector(".dialog-overlay").onclick=()=>{ge()}}function ve(){document.querySelectorAll(".editor-tool[data-cmd]").forEach(n=>{const i=n.dataset.cmd;try{const a=document.queryCommandState(i);n.classList.toggle("active",a)}catch{}});const t=document.getElementById("opt-toggle-pin");t&&At(t.dataset.active==="true");const e=document.getElementById("opt-toggle-lock");e&&lt(e.dataset.active==="true");const o=n=>{const i=document.getElementById(n);if(!i)return;let a=!1;try{const r=window.getSelection();if(r.rangeCount>0){let s=r.anchorNode;for(;s&&s.id!=="edit-content";){if(s.nodeName==="UL"&&s.classList.contains("checklist")){a=!0;break}s=s.parentNode}}}catch{}i.classList.toggle("active",a)};o("checklist-btn"),o("mobile-checklist-btn")}function ze(t=null){const e=document.getElementById("editor-modal"),o=document.getElementById("edit-title"),n=document.getElementById("edit-content"),i=document.getElementById("edit-category"),a=e.querySelector(".dialog-content");u.editingNoteId=t?t.id:null,o.value=(t==null?void 0:t.title)||"",n.innerHTML=(t==null?void 0:t.content)===void 0||(t==null?void 0:t.content)==="undefined"?"":(t==null?void 0:t.content)||"";let r="";!t&&u.currentView!=="all"&&(r=u.currentView),i.value=t?t.categoryId||"":r;const s=Xe.find(d=>d.id===(t?t.themeId:"default"))||Xe[0],l=u.settings.theme==="dark"?s.dark:s.light,c=s.id==="default"?u.settings.theme==="dark":Bn(l);a.style.backgroundColor=l,a.style.color=c?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",a.dataset.themeId=s.id,o.style.color=c?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",n.style.color=c?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",e.querySelectorAll(".editor-tool:not(.active), #cat-dropdown-trigger").forEach(d=>{d.style.color=c?"rgba(255,255,255,0.7)":"rgba(0,0,0,0.7)",d.style.borderColor=c?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",d.style.backgroundColor=c?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}),e.querySelectorAll(".editor-tool.active").forEach(d=>{d.style.backgroundColor="",d.style.color="",d.style.borderColor=""}),At(t?t.pinned:!1),lt(t?!!t.passwordHash:!1),Hn(),e.classList.remove("hidden"),n.focus(),le={title:(t==null?void 0:t.title)||"",content:(t==null?void 0:t.content)===void 0||(t==null?void 0:t.content)==="undefined"?"":(t==null?void 0:t.content)||"",categoryId:t?t.categoryId||"":r,pinned:t?t.pinned:!1,themeId:s.id,passwordHash:t?t.passwordHash:null}}function nt(){const t=document.getElementById("editor-modal"),e=t.querySelector(".dialog-content");e.classList.add("dialog-hide"),setTimeout(()=>{t.classList.add("hidden"),e.classList.remove("dialog-hide"),u.editingNoteId=null,u.tempEditorPassword=null;const o=document.getElementById("opt-toggle-lock");o&&(o.dataset.tempHash=""),document.getElementById("edit-title").value="",document.getElementById("edit-content").innerHTML="",window.refreshUI&&window.refreshUI()},200)}async function ge(t=!0){const e=document.getElementById("edit-title"),o=document.getElementById("edit-content"),n=document.getElementById("edit-category"),i=document.querySelector("#editor-modal .dialog-content");if(!e||!o)return;let a=e.value.trim();const r=o.innerHTML,s=n?n.value:"",l=i?i.dataset.themeId:"default";if(!a&&(!r||r.trim()===""||r==="<br>")){if(u.editingNoteId){const y=u.notes.findIndex(v=>v.id===u.editingNoteId);y>=0&&(u.notes.splice(y,1),await K(),window.refreshUI&&window.refreshUI(),window.triggerAutoSync&&window.triggerAutoSync())}t&&nt();return}if(!a){const y=new Date;a=y.getFullYear()+"-"+String(y.getMonth()+1).padStart(2,"0")+"-"+String(y.getDate()).padStart(2,"0")+", "+String(y.getHours()).padStart(2,"0")+":"+String(y.getMinutes()).padStart(2,"0")}const f=u.notes.findIndex(y=>y.id===u.editingNoteId),d=document.getElementById("opt-toggle-pin"),m=document.getElementById("opt-toggle-lock"),g=d?d.dataset.active==="true":!1,b=m?m.dataset.active==="true":!1,h=m&&m.dataset.tempHash||"",_=b?h||(f>=0?u.notes[f].passwordHash:null):null;if(le&&u.editingNoteId&&a===le.title&&r===le.content&&s===le.categoryId&&g===le.pinned&&l===le.themeId&&_===le.passwordHash&&t){nt();return}const C={id:u.editingNoteId||Date.now().toString(),title:a,content:r,categoryId:s||null,pinned:g,themeId:l||"default",passwordHash:_,updatedAt:Date.now()};if(b&&!C.passwordHash){const y=await fe("Seguridad","Establece una contrase√±a para esta nota:");if(y)C.passwordHash=await M.hash(y);else return}f>=0?u.notes[f]=C:u.notes.unshift(C),u.editingNoteId||(u.editingNoteId=C.id),await K(),t&&nt(),window.refreshUI&&window.refreshUI(),setTimeout(()=>{window.triggerAutoSync&&window.triggerAutoSync()},50)}function Fe(){const t=window.getSelection();t.rangeCount>0&&(_t=t.getRangeAt(0))}function ke(){if(_t){const t=window.getSelection();t.removeAllRanges(),t.addRange(_t)}}function Hn(){const t=document.getElementById("edit-category").value,e=u.categories.find(o=>o.id===t);document.getElementById("selected-cat-label")&&(document.getElementById("selected-cat-label").innerText=e?e.name:"Sin categor√≠a"),document.getElementById("selected-cat-icon")&&(document.getElementById("selected-cat-icon").setAttribute("data-lucide",e&&e.icon||"tag"),R())}function At(t){const e=document.getElementById("opt-toggle-pin");if(!e)return;e.dataset.active=t.toString();const o=document.getElementById("opt-pin-label"),n=document.getElementById("opt-pin-icon");o&&(o.innerText=t?"Desfijar nota":"Fijar nota"),n&&n.setAttribute("class",t?"w-4 h-4 text-violet-600":"w-4 h-4 text-muted-foreground"),e.classList.toggle("menu-active-violet",t)}function lt(t){const e=document.getElementById("opt-toggle-lock");if(!e)return;e.dataset.active=t.toString();const o=document.getElementById("opt-lock-label"),n=document.getElementById("opt-lock-icon");o&&(o.innerText=t?"Quitar restricci√≥n":"Restringir"),n&&(n.setAttribute("data-lucide",t?"lock":"lock-open"),n.setAttribute("class",t?"w-4 h-4 text-violet-600":"w-4 h-4 text-muted-foreground")),e.classList.toggle("menu-active-violet",t),R()}function jn(){document.getElementById("open-colors").onclick=s=>Oe(s,"color-popover");const t=document.getElementById("open-colors-mobile");t&&(t.onclick=s=>Oe(s,"color-popover")),document.getElementById("open-text-colors").onmousedown=s=>{s.preventDefault(),Fe()},document.getElementById("open-text-colors").onclick=s=>Oe(s,"text-color-popover");const e=s=>{s.preventDefault(),Fe(),Oe(s,"emoji-popover")};document.getElementById("open-emojis").onmousedown=s=>s.preventDefault(),document.getElementById("open-emojis").onclick=e;const o=document.getElementById("mobile-open-emojis");o&&(o.onmousedown=s=>s.preventDefault(),o.onclick=e);const n=document.getElementById("bg-color-grid");Xe.forEach(s=>{const l=document.createElement("div");l.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",l.style.backgroundColor=u.settings.theme==="dark"?s.dark:s.light,l.onclick=()=>{const c=document.querySelector("#editor-modal .dialog-content");c.style.backgroundColor=u.settings.theme==="dark"?s.dark:s.light,c.dataset.themeId=s.id,Me()},n.appendChild(l)});const i=document.getElementById("text-color-grid");Cn.forEach(s=>{const l=document.createElement("div");l.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",l.style.backgroundColor=s,l.onmousedown=c=>c.preventDefault(),l.onclick=()=>{ke(),document.execCommand("foreColor",!1,s),Me()},i.appendChild(l)});const a=document.getElementById("emoji-grid");Tn.forEach(s=>{const l=document.createElement("span");l.className="cursor-pointer hover:bg-accent p-2 rounded text-xl text-center",l.innerText=s,l.onclick=()=>{ke(),document.execCommand("insertHTML",!1,s),Me()},a.appendChild(l)}),document.addEventListener("click",s=>{!s.target.closest(".editor-tool")&&!s.target.closest(".popover-content")&&!s.target.closest("#cat-dropdown-trigger")&&Me()});const r=document.getElementById("cat-dropdown-trigger");r.onclick=s=>{s.stopPropagation(),document.getElementById("cat-dropdown-menu").classList.toggle("hidden")}}function Oe(t,e){t.stopPropagation();const o=document.getElementById(e),n=t.currentTarget.getBoundingClientRect();Me(e),o.classList.remove("hidden"),window.innerHeight-n.bottom<250?(o.style.top="auto",o.style.bottom=`${window.innerHeight-n.top+8}px`):(o.style.top=`${n.bottom+8}px`,o.style.bottom="auto"),o.style.left=`${Math.min(n.left,window.innerWidth-o.offsetWidth-20)}px`,n.left+300>window.innerWidth&&(o.style.left="auto",o.style.right="20px")}function Me(t=null){["color-popover","text-color-popover","emoji-popover","cat-dropdown-menu"].forEach(e=>{const o=document.getElementById(e);e!==t&&o&&o.classList.add("hidden")})}function $n(){return`
    <div id="categories-modal" class="fixed inset-0 z-[70] hidden">
        <div class="dialog-overlay close-categories"></div>
        <div class="dialog-content w-full h-full md:w-auto md:max-w-lg md:h-auto md:rounded-xl rounded-none flex flex-col shadow-2xl p-0 overflow-hidden">
            <div class="p-6 flex justify-between items-center border-b bg-background/50 backdrop-blur-md sticky top-0 z-10">
                <div>
                    <h2 class="text-xl font-bold text-foreground">Etiquetas</h2>
                    <p class="text-xs text-muted-foreground">Organiza tus pensamientos por categor√≠as</p>
                </div>
                <button class="close-categories p-2 hover:bg-accent rounded-full transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>

            <div class="p-4 bg-muted/20 border-b">
                <div class="flex items-center gap-3">
                    <div class="relative flex-1">
                        <i data-lucide="tag" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-foreground/50"></i>
                        <input type="text" id="new-cat-name" placeholder="Nueva etiqueta..." 
                               class="pl-12 h-12 w-full bg-background border-none ring-1 ring-border focus:ring-2 focus:ring-violet-500 rounded-2xl transition-all" autocomplete="off">
                    </div>
                    <button id="add-cat-btn" class="w-12 h-12 bg-violet-600 hover:bg-violet-700 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-violet-500/20 active:scale-95 transition-all">
                        <i data-lucide="plus" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-3" id="cat-manager-list">
                <!-- Items injected here -->
            </div>
            
            <div class="p-4 border-t bg-background/50 backdrop-blur-md md:hidden">
                <button class="close-categories w-full h-12 bg-secondary text-secondary-foreground font-bold rounded-2xl hover:bg-secondary/80 transition-all">Hecho</button>
            </div>
        </div>
        <div id="cat-icon-picker" class="fixed z-[80] hidden popover-content p-2 w-64 max-h-64 overflow-y-auto bg-popover border shadow-2xl rounded-2xl backdrop-blur-xl">
            <div class="grid grid-cols-6 gap-2 p-1" id="cat-icons-grid"></div>
        </div>
    </div>`}function Ye(t,e=null){const o=document.getElementById("cat-manager-list");o&&(o.innerHTML="",e&&(u.categories=e),u.categories.forEach(n=>{const i=document.createElement("div");i.className="flex items-center gap-3 p-2 rounded-lg border bg-card/50 hover:bg-accent/30 transition-all group",i.innerHTML=`
            <div class="w-12 h-12 rounded-xl cursor-pointer hover:bg-accent border bg-background flex items-center justify-center shrink-0 transition-all active:scale-95" 
                 id="icon-trigger-${n.id}" title="Cambiar icono">
                 <i data-lucide="${n.icon||"tag"}" class="w-5 h-5 text-foreground/80"></i>
            </div>
            
            <div class="flex flex-col flex-1 min-w-0">
                <input type="text" value="${n.name}" 
                       class="bg-transparent border-none outline-none font-bold text-base w-full focus:ring-0 transition-colors h-7 px-0 rounded"
                       id="cn-${n.id}" autocomplete="off">
                <span class="text-[10px] text-muted-foreground uppercase tracking-widest font-medium">${n.passwordHash?"Restringida":"P√∫blica"}</span>
            </div>
            
            <div class="flex items-center gap-2">
                <button class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-violet-500/10 transition-all ${n.passwordHash?"text-violet-500 bg-violet-500/5 border border-violet-500/20":"text-muted-foreground border border-transparent"}"
                        id="lock-${n.id}" title="${n.passwordHash?"Restringido":"Restricci√≥n"}">
                    <i data-lucide="${n.passwordHash?"lock":"unlock"}" class="w-4 h-4"></i>
                </button>
                <button class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-destructive/10 hover:text-destructive text-muted-foreground border border-transparent transition-all"
                        id="del-${n.id}" title="Eliminar">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        `,o.appendChild(i),document.getElementById(`icon-trigger-${n.id}`).onclick=r=>{r.stopPropagation(),zn(n.id,t,r.currentTarget)};const a=document.getElementById(`cn-${n.id}`);a.oninput=r=>{n.name=r.target.value,t()},a.onchange=async()=>{await K(),t(),window.triggerAutoSync&&window.triggerAutoSync()},document.getElementById(`lock-${n.id}`).onclick=()=>Rn(n.id,t),document.getElementById(`del-${n.id}`).onclick=()=>Fn(n.id,t)}),R())}async function zn(t,e,o){const n=u.categories.find(l=>l.id===t);if(!n)return;const i=document.getElementById("cat-icon-picker"),a=document.getElementById("cat-icons-grid");a.innerHTML="",Dn.forEach(l=>{const c=document.createElement("button");c.className="w-9 h-9 flex items-center justify-center rounded-md hover:bg-primary/10 hover:text-primary transition-all text-muted-foreground",c.innerHTML=`<i data-lucide="${l}" class="w-5 h-5"></i>`,c.onclick=async()=>{n.icon=l,await K(),Ye(e),e(),i.classList.add("hidden"),window.triggerAutoSync&&window.triggerAutoSync()},a.appendChild(c)}),R();const r=o.getBoundingClientRect();i.style.top=`${r.bottom+8}px`,i.style.left=`${r.left}px`,i.classList.remove("hidden");const s=l=>{!i.contains(l.target)&&!o.contains(l.target)&&(i.classList.add("hidden"),document.removeEventListener("click",s))};setTimeout(()=>document.addEventListener("click",s),10)}async function Fn(t,e){const o=u.categories.find(n=>n.id===t);if(o){if(o.passwordHash){const n=await fe("Seguridad","Etiqueta restringida. Ingresa contrase√±a para eliminar:");if(!n)return;if(await M.hash(n)!==o.passwordHash)return D("‚ùå Error: Contrase√±a incorrecta")}confirm(`¬øEliminar la etiqueta "${o.name}"? Las notas no se borrar√°n.`)&&(u.categories=u.categories.filter(n=>n.id!==t),u.notes.forEach(n=>{n.categoryId===t&&(n.categoryId=null)}),u.currentView===t&&(u.currentView="all"),await K(),Ye(e),e(),window.triggerAutoSync&&window.triggerAutoSync())}}async function Rn(t,e){const o=u.categories.find(n=>n.id===t);if(o){if(o.passwordHash){const n=await fe("Seguridad","Ingresa la contrase√±a para quitar la restricci√≥n:");if(!n)return;if(await M.hash(n)!==o.passwordHash)return D("‚ùå Error: Contrase√±a incorrecta");o.passwordHash=null,D("üîì Restricci√≥n quitada")}else{const n=await fe("Seguridad","Define una contrase√±a para restringir esta etiqueta:");n&&(o.passwordHash=await M.hash(n),D("üîí Etiqueta restringida"))}await K(),Ye(e),e(),window.triggerAutoSync&&window.triggerAutoSync()}}function qn(){return`
    <div id="settings-modal" class="fixed inset-0 z-[80] hidden">
        <div class="dialog-overlay"></div>
        <div class="dialog-content w-full h-full md:w-auto md:max-w-2xl md:h-[500px] p-0 overflow-hidden flex flex-col md:flex-row rounded-none md:rounded-xl">
            <!-- Sidebar Settings -->
            <div id="settings-sidebar" class="w-full md:w-48 bg-muted/50 border-b md:border-b-0 md:border-r p-4 flex flex-col gap-2 overflow-y-auto">
                <div class="flex items-center justify-between mb-4 md:hidden">
                    <h3 class="font-bold text-2xl">Configuraci√≥n</h3>
                    <button class="close-settings p-2 hover:bg-accent rounded-full">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <button class="settings-tab py-3 px-4 text-base" data-tab="appearance">
                    <i data-lucide="palette" class="w-5 h-5"></i> General
                </button>
                <button class="settings-tab py-3 px-4 text-base" data-tab="sync">
                    <i data-lucide="refresh-cw" class="w-5 h-5"></i> Sincronizaci√≥n
                </button>
                <button class="settings-tab py-3 px-4 text-base" data-tab="security">
                    <i data-lucide="shield" class="w-5 h-5"></i> Seguridad
                </button>
                <button class="settings-tab text-destructive mt-auto py-3 px-4 text-base" data-tab="danger">
                    <i data-lucide="alert-triangle" class="w-5 h-5"></i> Zona Peligrosa
                </button>
            </div>

            <!-- Content Area -->
            <div class="flex-1 flex flex-col min-w-0" id="settings-content-area">
                <div class="p-4 border-b flex items-center gap-3">
                    <button class="md:hidden p-2 hover:bg-accent rounded-md group" id="settings-back-btn">
                        <i data-lucide="arrow-left" class="w-5 h-5 text-muted-foreground group-hover:text-foreground"></i>
                    </button>
                    <h2 id="settings-tab-title" class="font-bold flex-1">Configuraci√≥n</h2>
                    <button class="close-settings p-2 hover:bg-accent rounded-md group">
                        <i data-lucide="x" class="w-5 h-5 text-muted-foreground group-hover:text-foreground"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-6" id="settings-panels">
                    <!-- Panel: Apariencia -->
                    <div id="panel-appearance" class="settings-panel space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Tema Visual</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button id="theme-light" class="flex flex-col items-center gap-2 p-4 rounded-lg border bg-card hover:bg-accent transition-all group">
                                    <div class="w-full aspect-video bg-zinc-100 rounded border flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-300 rounded"></div>
                                    </div>
                                    <span class="text-xs font-medium">Claro</span>
                                </button>
                                <button id="theme-dark" class="flex flex-col items-center gap-2 p-4 rounded-lg border bg-zinc-950 hover:bg-zinc-900 transition-all group ring-primary">
                                    <div class="w-full aspect-video bg-zinc-800 rounded border border-zinc-700 flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-600 rounded"></div>
                                    </div>
                                    <span class="text-xs font-medium text-white">Oscuro</span>
                                </button>
                            </div>
                        </section>

                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Mantenimiento</h3>
                            <div class="p-4 rounded-lg border bg-primary/5 space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-xs font-medium">Versi√≥n Instalada</span>
                                    <span class="text-xs font-bold font-mono text-primary" id="settings-version-display">v3.6.0</span>
                                </div>
                                <p class="text-[10px] text-muted-foreground">Si la aplicaci√≥n no se actualiza o ves errores visuales, usa el bot√≥n de abajo para forzar una limpieza del sistema.</p>
                                <button id="force-reload-btn" class="btn-shad btn-shad-outline w-full h-10 flex items-center justify-center gap-2 group">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500"></i>
                                    Forzar Actualizaci√≥n Completa
                                </button>
                            </div>
                        </section>
                    </div>

                    <!-- Panel: Sincronizaci√≥n -->
                    <div id="panel-sync" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Google Drive</h3>
                                <div id="drive-status" class="text-[10px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground font-bold uppercase">Desconectado</div>
                            </div>
                            
                            <button id="connect-drive-btn" class="btn-shad btn-shad-outline w-full h-10 flex items-center justify-center gap-2">
                                <i data-lucide="link" class="w-4 h-4"></i> Conectar con Google Drive
                            </button>

                            <div class="space-y-2 pt-4 border-t border-dashed">
                                <label class="text-xs font-medium">Nombre de carpeta en Drive</label>
                                <input type="text" id="config-drive-path" class="h-10 px-4 w-full" placeholder="p.ej. CloudNotesV3" autocomplete="off">
                                <p class="text-[10px] text-muted-foreground">Las notas se guardar√°n encriptadas dentro de esta carpeta.</p>
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs font-medium">Notas por archivo (Grupo)</label>
                                <div class="flex items-center gap-3">
                                    <input type="number" id="config-notes-per-chunk" class="h-10 px-4 w-full" placeholder="50" min="10" max="500">
                                    <span class="text-xs text-muted-foreground shrink-0 font-bold">NOTAS</span>
                                </div>
                                <p class="text-[10px] text-muted-foreground">Define cu√°ntas notas se agrupar√°n en cada archivo (ej. 50). Solo se subir√°n los archivos que contengan notas modificadas.</p>
                            </div>
                            <button id="save-sync-config" class="btn-shad btn-shad-primary w-full h-10">Guardar Cambios</button>
                        </section>
                    </div>

                    <!-- Panel: Seguridad -->
                    <div id="panel-security" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Seguridad de la Sesi√≥n</h3>
                            <div class="p-4 rounded-lg border bg-muted/20 space-y-3">
                                <p class="text-xs text-muted-foreground">Cerrar la sesi√≥n actual eliminar√° la clave de acceso de la memoria y te llevar√° a la pantalla de desbloqueo.</p>
                                <button id="logout-btn" class="btn-shad bg-destructive/10 text-destructive hover:bg-destructive hover:text-white w-full h-10 flex items-center justify-center gap-2 transition-all">
                                    <i data-lucide="log-out" class="w-4 h-4"></i> Cerrar Sesi√≥n
                                </button>
                            </div>
                        </section>
                        
                        <section class="space-y-4 pt-4 border-t">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Encriptaci√≥n</h3>
                            <div class="space-y-2">
                                <label class="text-xs font-medium">Algoritmo preferido</label>
                                <select id="config-algo" class="h-10 w-full px-3">
                                    <option value="aes-256-gcm">AES-256-GCM (Recomendado)</option>
                                    <option value="kyber">CRYSTALS-Kyber (Experimental)</option>
                                </select>
                            </div>
                             <button id="save-security-config" class="btn-shad btn-shad-primary w-full h-10">Actualizar Algoritmo</button>
                        </section>
                    </div>

                    <!-- Panel: Danger Zone -->
                    <div id="panel-danger" class="settings-panel hidden space-y-6">
                        <section class="p-4 rounded-lg border border-destructive/20 bg-destructive/5 space-y-4">
                            <h3 class="text-sm font-semibold text-destructive uppercase tracking-wider">Restablecer Aplicaci√≥n</h3>
                            <p class="text-xs text-muted-foreground underline">Esta acci√≥n borrar√° permanentemente todas las notas y categor√≠as almacenadas localmente en este navegador.</p>
                            <div class="space-y-2">
                                <label class="text-[10px] uppercase font-bold text-destructive/70">Para confirmar, escribe "confirmar" a continuaci√≥n:</label>
                                <input type="text" id="factory-reset-confirm" class="h-10 px-4 mt-1 w-full border rounded-md" placeholder="Escribe la palabra..." autocomplete="off">
                            </div>
                            <button id="factory-reset" class="btn-shad bg-destructive text-destructive-foreground hover:bg-destructive/90 w-full h-10 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i> Eliminar todos los datos locales
                            </button>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>`}function Gn(){const t=document.querySelectorAll(".settings-panel"),e=document.querySelectorAll(".settings-tab"),o=document.getElementById("settings-tab-title"),n=document.getElementById("settings-sidebar"),i=n.nextElementSibling,a=document.getElementById("settings-back-btn"),r=l=>{e.forEach(f=>f.classList.toggle("active",f.dataset.tab===l)),t.forEach(f=>f.classList.toggle("hidden",f.id!==`panel-${l}`));const c={appearance:"General",sync:"Sincronizaci√≥n Cloud",security:"Seguridad y Sesi√≥n",danger:"Zona Peligrosa"};o.innerText=c[l]||"Configuraci√≥n",window.innerWidth<768&&(n.classList.add("hidden"),i.classList.remove("hidden"),a.classList.remove("hidden")),R()};e.forEach(l=>{l.onclick=()=>r(l.dataset.tab)}),a.onclick=()=>{n.classList.remove("hidden"),i.classList.add("hidden"),a.classList.add("hidden"),o.innerText="Configuraci√≥n"},window.innerWidth<768?(i.classList.add("hidden"),a.classList.add("hidden"),e.forEach(l=>l.classList.remove("active"))):r("appearance");const s=document.getElementById("force-reload-btn");s&&(s.onclick=an)}async function an(){if(confirm("Esto reiniciar√° la aplicaci√≥n, limpiar√° la cach√© y eliminar√° el Service Worker para forzar la √∫ltima versi√≥n. ¬øContinuar?"))try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const o of e)await o.unregister()}if("caches"in window){const e=await caches.keys();for(const o of e)await caches.delete(o)}sessionStorage.clear();const t=new URL(window.location.href);t.searchParams.set("t",Date.now()),window.location.href=t.toString()}catch(t){console.error("Error clearing cache:",t),window.location.reload()}}function Un(){return`
    <!-- Prompt Modal -->
    <div id="prompt-modal" class="fixed inset-0 z-[250] hidden flex items-start justify-center pt-24 md:pt-0 md:items-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="relative w-full max-w-[340px] bg-card border shadow-2xl rounded-2xl p-6 space-y-6 animate-in zoom-in-95 duration-200">
            <div class="space-y-2">
                <h2 id="prompt-title" class="text-xl font-bold tracking-tight">Seguridad</h2>
                <p id="prompt-desc" class="text-sm text-muted-foreground leading-relaxed">Ingresa la contrase√±a para continuar</p>
            </div>
            <div class="space-y-4">
                <div class="relative group">
                    <input type="password" id="prompt-input" placeholder="Tu contrase√±a"
                        class="h-12 w-full text-center tracking-widest outline-none pr-12 bg-muted/50 border border-border focus:border-indigo-500/50 transition-all rounded-xl">
                    <button type="button"
                        class="absolute right-0 top-0 h-12 w-12 flex items-center justify-center text-muted-foreground hover:text-foreground toggle-pass"
                        data-target="prompt-input">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="flex gap-3 pt-2">
                    <button id="prompt-cancel" class="h-11 px-4 rounded-xl border bg-background hover:bg-accent text-sm font-medium flex-1">Cancelar</button>
                    <button id="prompt-confirm" class="h-11 px-4 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold flex-1 shadow-lg shadow-indigo-500/20">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast">
        <div class="border">
            ¬°Acci√≥n completada!
        </div>
    </div>`}function Lt(t,e=null){const o=document.getElementById("sidebar-categories"),n=document.getElementById("mobile-sidebar-categories"),i=document.getElementById("edit-category"),a=document.getElementById("cat-dropdown-menu");e&&(u.categories=e),o&&(o.innerHTML=""),n&&(n.innerHTML=""),i&&(i.innerHTML='<option value="">Sin categor√≠a</option>'),a&&(a.innerHTML='<div class="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer border-b" data-id="">Sin categor√≠a</div>');const r=u.categories.length>0,s=document.getElementById("sidebar-categories-header"),l=document.getElementById("mobile-sidebar-categories-header");s&&s.classList.toggle("hidden",!r),l&&l.classList.toggle("hidden",!r),document.querySelectorAll('.nav-link[data-view="all"], .nav-link-mobile[data-view="all"], .nav-link-mobile-drawer[data-view="all"]').forEach(d=>{d.classList.toggle("active",u.currentView==="all")});const c=(d,m,g)=>{if(!a)return;const b=document.createElement("div");b.className="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer flex items-center gap-2",b.innerHTML=`<i data-lucide="${g||"tag"}" class="w-3.5 h-3.5 text-foreground/70"></i> ${m}`,b.onclick=()=>{i&&(i.value=d),f(),a.classList.add("hidden")},a.appendChild(b)},f=()=>{const d=document.getElementById("edit-category").value,m=u.categories.find(g=>g.id===d);document.getElementById("selected-cat-label").innerText=m?m.name:"Sin categor√≠a"};if(a){const d=a.querySelector('[data-id=""]');d&&(d.onclick=()=>{i&&(i.value=""),f(),a.classList.add("hidden")})}u.categories.forEach(d=>{const m=(g=!1)=>{const b=document.createElement("button");return b.className=g?"nav-link-mobile-drawer w-full group":"nav-link w-full group",b.setAttribute("data-view",d.id),u.currentView===d.id&&b.classList.add("active"),b.onclick=async()=>{if(d.passwordHash){const h=await fe("Acceso Restringido",`Ingresa la contrase√±a para "${d.name}":`);if(!h)return;if(await M.hash(h)!==d.passwordHash){D("Contrase√±a incorrecta");return}}if(t(d.id,d.name),g){const h=document.getElementById("mobile-sidebar-overlay");h&&h.classList.add("hidden")}},b.innerHTML=`
                <div class="flex items-center justify-between w-full">
                    <div class="flex items-center gap-3">
                        <i data-lucide="${d.icon||"tag"}" class="w-4 h-4 text-foreground/70 group-hover:text-violet-500 transition-colors"></i>
                        <span class="truncate sidebar-label">${d.name}</span>
                    </div>
                    <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        ${d.passwordHash?'<i data-lucide="lock" class="w-3 h-3 text-muted-foreground"></i>':""}
                    </div>
                </div>
            `,b};if(o&&o.appendChild(m(!1)),n&&n.appendChild(m(!0)),i){const g=document.createElement("option");g.value=d.id,g.innerText=d.name,i.appendChild(g)}c(d.id,d.name,d.icon)}),R()}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ft(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),o.push.apply(o,n)}return o}function ee(t){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?arguments[e]:{};e%2?Ft(Object(o),!0).forEach(function(n){Wn(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):Ft(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function ot(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ot=function(e){return typeof e}:ot=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ot(t)}function Wn(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function ie(){return ie=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},ie.apply(this,arguments)}function Xn(t,e){if(t==null)return{};var o={},n=Object.keys(t),i,a;for(a=0;a<n.length;a++)i=n[a],!(e.indexOf(i)>=0)&&(o[i]=t[i]);return o}function Yn(t,e){if(t==null)return{};var o=Xn(t,e),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var Vn="1.15.6";function ne(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var ae=ne(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ve=ne(/Edge/i),Rt=ne(/firefox/i),Re=ne(/safari/i)&&!ne(/chrome/i)&&!ne(/android/i),Nt=ne(/iP(ad|od|hone)/i),rn=ne(/chrome/i)&&ne(/android/i),sn={capture:!1,passive:!1};function S(t,e,o){t.addEventListener(e,o,!ae&&sn)}function k(t,e,o){t.removeEventListener(e,o,!ae&&sn)}function ct(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function ln(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Z(t,e,o,n){if(t){o=o||document;do{if(e!=null&&(e[0]===">"?t.parentNode===o&&ct(t,e):ct(t,e))||n&&t===o)return t;if(t===o)break}while(t=ln(t))}return null}var qt=/\s+/g;function X(t,e,o){if(t&&e)if(t.classList)t.classList[o?"add":"remove"](e);else{var n=(" "+t.className+" ").replace(qt," ").replace(" "+e+" "," ");t.className=(n+(o?" "+e:"")).replace(qt," ")}}function w(t,e,o){var n=t&&t.style;if(n){if(o===void 0)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(o=t.currentStyle),e===void 0?o:o[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=o+(typeof o=="string"?"":"px")}}function Ie(t,e){var o="";if(typeof t=="string")o=t;else do{var n=w(t,"transform");n&&n!=="none"&&(o=n+" "+o)}while(!e&&(t=t.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(o)}function cn(t,e,o){if(t){var n=t.getElementsByTagName(e),i=0,a=n.length;if(o)for(;i<a;i++)o(n[i],i);return n}return[]}function Q(){var t=document.scrollingElement;return t||document.documentElement}function P(t,e,o,n,i){if(!(!t.getBoundingClientRect&&t!==window)){var a,r,s,l,c,f,d;if(t!==window&&t.parentNode&&t!==Q()?(a=t.getBoundingClientRect(),r=a.top,s=a.left,l=a.bottom,c=a.right,f=a.height,d=a.width):(r=0,s=0,l=window.innerHeight,c=window.innerWidth,f=window.innerHeight,d=window.innerWidth),(e||o)&&t!==window&&(i=i||t.parentNode,!ae))do if(i&&i.getBoundingClientRect&&(w(i,"transform")!=="none"||o&&w(i,"position")!=="static")){var m=i.getBoundingClientRect();r-=m.top+parseInt(w(i,"border-top-width")),s-=m.left+parseInt(w(i,"border-left-width")),l=r+a.height,c=s+a.width;break}while(i=i.parentNode);if(n&&t!==window){var g=Ie(i||t),b=g&&g.a,h=g&&g.d;g&&(r/=h,s/=b,d/=b,f/=h,l=r+f,c=s+d)}return{top:r,left:s,bottom:l,right:c,width:d,height:f}}}function Gt(t,e,o){for(var n=ue(t,!0),i=P(t)[e];n;){var a=P(n)[o],r=void 0;if(r=i>=a,!r)return n;if(n===Q())break;n=ue(n,!1)}return!1}function Ce(t,e,o,n){for(var i=0,a=0,r=t.children;a<r.length;){if(r[a].style.display!=="none"&&r[a]!==x.ghost&&(n||r[a]!==x.dragged)&&Z(r[a],o.draggable,t,!1)){if(i===e)return r[a];i++}a++}return null}function Pt(t,e){for(var o=t.lastElementChild;o&&(o===x.ghost||w(o,"display")==="none"||e&&!ct(o,e));)o=o.previousElementSibling;return o||null}function V(t,e){var o=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==x.clone&&(!e||ct(t,e))&&o++;return o}function Ut(t){var e=0,o=0,n=Q();if(t)do{var i=Ie(t),a=i.a,r=i.d;e+=t.scrollLeft*a,o+=t.scrollTop*r}while(t!==n&&(t=t.parentNode));return[e,o]}function Kn(t,e){for(var o in t)if(t.hasOwnProperty(o)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t[o][n])return Number(o)}return-1}function ue(t,e){if(!t||!t.getBoundingClientRect)return Q();var o=t,n=!1;do if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var i=w(o);if(o.clientWidth<o.scrollWidth&&(i.overflowX=="auto"||i.overflowX=="scroll")||o.clientHeight<o.scrollHeight&&(i.overflowY=="auto"||i.overflowY=="scroll")){if(!o.getBoundingClientRect||o===document.body)return Q();if(n||e)return o;n=!0}}while(o=o.parentNode);return Q()}function Jn(t,e){if(t&&e)for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}function ht(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var qe;function dn(t,e){return function(){if(!qe){var o=arguments,n=this;o.length===1?t.call(n,o[0]):t.apply(n,o),qe=setTimeout(function(){qe=void 0},e)}}}function Zn(){clearTimeout(qe),qe=void 0}function un(t,e,o){t.scrollLeft+=e,t.scrollTop+=o}function fn(t){var e=window.Polymer,o=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):o?o(t).clone(!0)[0]:t.cloneNode(!0)}function pn(t,e,o){var n={};return Array.from(t.children).forEach(function(i){var a,r,s,l;if(!(!Z(i,e.draggable,t,!1)||i.animated||i===o)){var c=P(i);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((r=n.top)!==null&&r!==void 0?r:1/0,c.top),n.right=Math.max((s=n.right)!==null&&s!==void 0?s:-1/0,c.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var W="Sortable"+new Date().getTime();function Qn(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(i){if(!(w(i,"display")==="none"||i===x.ghost)){t.push({target:i,rect:P(i)});var a=ee({},t[t.length-1].rect);if(i.thisAnimationDuration){var r=Ie(i,!0);r&&(a.top-=r.f,a.left-=r.e)}i.fromRect=a}})}},addAnimationState:function(n){t.push(n)},removeAnimationState:function(n){t.splice(Kn(t,{target:n}),1)},animateAll:function(n){var i=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,r=0;t.forEach(function(s){var l=0,c=s.target,f=c.fromRect,d=P(c),m=c.prevFromRect,g=c.prevToRect,b=s.rect,h=Ie(c,!0);h&&(d.top-=h.f,d.left-=h.e),c.toRect=d,c.thisAnimationDuration&&ht(m,d)&&!ht(f,d)&&(b.top-d.top)/(b.left-d.left)===(f.top-d.top)/(f.left-d.left)&&(l=to(b,m,g,i.options)),ht(d,f)||(c.prevFromRect=f,c.prevToRect=d,l||(l=i.options.animation),i.animate(c,b,d,l)),l&&(a=!0,r=Math.max(r,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},r):typeof n=="function"&&n(),t=[]},animate:function(n,i,a,r){if(r){w(n,"transition",""),w(n,"transform","");var s=Ie(this.el),l=s&&s.a,c=s&&s.d,f=(i.left-a.left)/(l||1),d=(i.top-a.top)/(c||1);n.animatingX=!!f,n.animatingY=!!d,w(n,"transform","translate3d("+f+"px,"+d+"px,0)"),this.forRepaintDummy=eo(n),w(n,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),w(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){w(n,"transition",""),w(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},r)}}}}function eo(t){return t.offsetWidth}function to(t,e,o,n){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-o.top,2)+Math.pow(e.left-o.left,2))*n.animation}var ye=[],bt={initializeByDefault:!0},Ke={mount:function(e){for(var o in bt)bt.hasOwnProperty(o)&&!(o in e)&&(e[o]=bt[o]);ye.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),ye.push(e)},pluginEvent:function(e,o,n){var i=this;this.eventCanceled=!1,n.cancel=function(){i.eventCanceled=!0};var a=e+"Global";ye.forEach(function(r){o[r.pluginName]&&(o[r.pluginName][a]&&o[r.pluginName][a](ee({sortable:o},n)),o.options[r.pluginName]&&o[r.pluginName][e]&&o[r.pluginName][e](ee({sortable:o},n)))})},initializePlugins:function(e,o,n,i){ye.forEach(function(s){var l=s.pluginName;if(!(!e.options[l]&&!s.initializeByDefault)){var c=new s(e,o,e.options);c.sortable=e,c.options=e.options,e[l]=c,ie(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var r=this.modifyOption(e,a,e.options[a]);typeof r<"u"&&(e.options[a]=r)}},getEventProperties:function(e,o){var n={};return ye.forEach(function(i){typeof i.eventProperties=="function"&&ie(n,i.eventProperties.call(o[i.pluginName],e))}),n},modifyOption:function(e,o,n){var i;return ye.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[o]=="function"&&(i=a.optionListeners[o].call(e[a.pluginName],n))}),i}};function no(t){var e=t.sortable,o=t.rootEl,n=t.name,i=t.targetEl,a=t.cloneEl,r=t.toEl,s=t.fromEl,l=t.oldIndex,c=t.newIndex,f=t.oldDraggableIndex,d=t.newDraggableIndex,m=t.originalEvent,g=t.putSortable,b=t.extraEventProperties;if(e=e||o&&o[W],!!e){var h,_=e.options,C="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!ae&&!Ve?h=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(h=document.createEvent("Event"),h.initEvent(n,!0,!0)),h.to=r||o,h.from=s||o,h.item=i||o,h.clone=a,h.oldIndex=l,h.newIndex=c,h.oldDraggableIndex=f,h.newDraggableIndex=d,h.originalEvent=m,h.pullMode=g?g.lastPutMode:void 0;var y=ee(ee({},b),Ke.getEventProperties(n,e));for(var v in y)h[v]=y[v];o&&o.dispatchEvent(h),_[C]&&_[C].call(e,h)}}var oo=["evt"],U=function(e,o){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n.evt,a=Yn(n,oo);Ke.pluginEvent.bind(x)(e,o,ee({dragEl:p,parentEl:L,ghostEl:E,rootEl:B,nextEl:be,lastDownEl:it,cloneEl:A,cloneHidden:de,dragStarted:He,putSortable:j,activeSortable:x.active,originalEvent:i,oldIndex:Se,oldDraggableIndex:Ge,newIndex:Y,newDraggableIndex:ce,hideGhostForTarget:bn,unhideGhostForTarget:vn,cloneNowHidden:function(){de=!0},cloneNowShown:function(){de=!1},dispatchSortableEvent:function(s){G({sortable:o,name:s,originalEvent:i})}},a))};function G(t){no(ee({putSortable:j,cloneEl:A,targetEl:p,rootEl:B,oldIndex:Se,oldDraggableIndex:Ge,newIndex:Y,newDraggableIndex:ce},t))}var p,L,E,B,be,it,A,de,Se,Y,Ge,ce,Ze,j,xe=!1,dt=!1,ut=[],me,J,vt,yt,Wt,Xt,He,we,Ue,We=!1,Qe=!1,at,F,wt=[],Ct=!1,ft=[],gt=typeof document<"u",et=Nt,Yt=Ve||ae?"cssFloat":"float",io=gt&&!rn&&!Nt&&"draggable"in document.createElement("div"),gn=function(){if(gt){if(ae)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),mn=function(e,o){var n=w(e),i=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=Ce(e,0,o),r=Ce(e,1,o),s=a&&w(a),l=r&&w(r),c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+P(a).width,f=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+P(r).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&s.float&&s.float!=="none"){var d=s.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===d)?"vertical":"horizontal"}return a&&(s.display==="block"||s.display==="flex"||s.display==="table"||s.display==="grid"||c>=i&&n[Yt]==="none"||r&&n[Yt]==="none"&&c+f>i)?"vertical":"horizontal"},ao=function(e,o,n){var i=n?e.left:e.top,a=n?e.right:e.bottom,r=n?e.width:e.height,s=n?o.left:o.top,l=n?o.right:o.bottom,c=n?o.width:o.height;return i===s||a===l||i+r/2===s+c/2},ro=function(e,o){var n;return ut.some(function(i){var a=i[W].options.emptyInsertThreshold;if(!(!a||Pt(i))){var r=P(i),s=e>=r.left-a&&e<=r.right+a,l=o>=r.top-a&&o<=r.bottom+a;if(s&&l)return n=i}}),n},hn=function(e){function o(a,r){return function(s,l,c,f){var d=s.options.group.name&&l.options.group.name&&s.options.group.name===l.options.group.name;if(a==null&&(r||d))return!0;if(a==null||a===!1)return!1;if(r&&a==="clone")return a;if(typeof a=="function")return o(a(s,l,c,f),r)(s,l,c,f);var m=(r?s:l).options.group.name;return a===!0||typeof a=="string"&&a===m||a.join&&a.indexOf(m)>-1}}var n={},i=e.group;(!i||ot(i)!="object")&&(i={name:i}),n.name=i.name,n.checkPull=o(i.pull,!0),n.checkPut=o(i.put),n.revertClone=i.revertClone,e.group=n},bn=function(){!gn&&E&&w(E,"display","none")},vn=function(){!gn&&E&&w(E,"display","")};gt&&!rn&&document.addEventListener("click",function(t){if(dt)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),dt=!1,!1},!0);var he=function(e){if(p){e=e.touches?e.touches[0]:e;var o=ro(e.clientX,e.clientY);if(o){var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);n.target=n.rootEl=o,n.preventDefault=void 0,n.stopPropagation=void 0,o[W]._onDragOver(n)}}},so=function(e){p&&p.parentNode[W]._isOutsideThisEl(e.target)};function x(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=ie({},e),t[W]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return mn(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,s){r.setData("Text",s.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:x.supportPointer!==!1&&"PointerEvent"in window&&(!Re||Nt),emptyInsertThreshold:5};Ke.initializePlugins(this,t,o);for(var n in o)!(n in e)&&(e[n]=o[n]);hn(e);for(var i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this));this.nativeDraggable=e.forceFallback?!1:io,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?S(t,"pointerdown",this._onTapStart):(S(t,"mousedown",this._onTapStart),S(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(S(t,"dragover",this),S(t,"dragenter",this)),ut.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ie(this,Qn())}x.prototype={constructor:x,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(we=null)},_getDirection:function(e,o){return typeof this.options.direction=="function"?this.options.direction.call(this,e,o,p):this.options.direction},_onTapStart:function(e){if(e.cancelable){var o=this,n=this.el,i=this.options,a=i.preventOnFilter,r=e.type,s=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(s||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,f=i.filter;if(ho(n),!p&&!(/mousedown|pointerdown/.test(r)&&e.button!==0||i.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Re&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Z(l,i.draggable,n,!1),!(l&&l.animated)&&it!==l)){if(Se=V(l),Ge=V(l,i.draggable),typeof f=="function"){if(f.call(this,e,l,this)){G({sortable:o,rootEl:c,name:"filter",targetEl:l,toEl:n,fromEl:n}),U("filter",o,{evt:e}),a&&e.preventDefault();return}}else if(f&&(f=f.split(",").some(function(d){if(d=Z(c,d.trim(),n,!1),d)return G({sortable:o,rootEl:d,name:"filter",targetEl:l,fromEl:n,toEl:n}),U("filter",o,{evt:e}),!0}),f)){a&&e.preventDefault();return}i.handle&&!Z(c,i.handle,n,!1)||this._prepareDragStart(e,s,l)}}},_prepareDragStart:function(e,o,n){var i=this,a=i.el,r=i.options,s=a.ownerDocument,l;if(n&&!p&&n.parentNode===a){var c=P(n);if(B=a,p=n,L=p.parentNode,be=p.nextSibling,it=n,Ze=r.group,x.dragged=p,me={target:p,clientX:(o||e).clientX,clientY:(o||e).clientY},Wt=me.clientX-c.left,Xt=me.clientY-c.top,this._lastX=(o||e).clientX,this._lastY=(o||e).clientY,p.style["will-change"]="all",l=function(){if(U("delayEnded",i,{evt:e}),x.eventCanceled){i._onDrop();return}i._disableDelayedDragEvents(),!Rt&&i.nativeDraggable&&(p.draggable=!0),i._triggerDragStart(e,o),G({sortable:i,name:"choose",originalEvent:e}),X(p,r.chosenClass,!0)},r.ignore.split(",").forEach(function(f){cn(p,f.trim(),xt)}),S(s,"dragover",he),S(s,"mousemove",he),S(s,"touchmove",he),r.supportPointer?(S(s,"pointerup",i._onDrop),!this.nativeDraggable&&S(s,"pointercancel",i._onDrop)):(S(s,"mouseup",i._onDrop),S(s,"touchend",i._onDrop),S(s,"touchcancel",i._onDrop)),Rt&&this.nativeDraggable&&(this.options.touchStartThreshold=4,p.draggable=!0),U("delayStart",this,{evt:e}),r.delay&&(!r.delayOnTouchOnly||o)&&(!this.nativeDraggable||!(Ve||ae))){if(x.eventCanceled){this._onDrop();return}r.supportPointer?(S(s,"pointerup",i._disableDelayedDrag),S(s,"pointercancel",i._disableDelayedDrag)):(S(s,"mouseup",i._disableDelayedDrag),S(s,"touchend",i._disableDelayedDrag),S(s,"touchcancel",i._disableDelayedDrag)),S(s,"mousemove",i._delayedDragTouchMoveHandler),S(s,"touchmove",i._delayedDragTouchMoveHandler),r.supportPointer&&S(s,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var o=e.touches?e.touches[0]:e;Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){p&&xt(p),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;k(e,"mouseup",this._disableDelayedDrag),k(e,"touchend",this._disableDelayedDrag),k(e,"touchcancel",this._disableDelayedDrag),k(e,"pointerup",this._disableDelayedDrag),k(e,"pointercancel",this._disableDelayedDrag),k(e,"mousemove",this._delayedDragTouchMoveHandler),k(e,"touchmove",this._delayedDragTouchMoveHandler),k(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,o){o=o||e.pointerType=="touch"&&e,!this.nativeDraggable||o?this.options.supportPointer?S(document,"pointermove",this._onTouchMove):o?S(document,"touchmove",this._onTouchMove):S(document,"mousemove",this._onTouchMove):(S(p,"dragend",this),S(B,"dragstart",this._onDragStart));try{document.selection?rt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,o){if(xe=!1,B&&p){U("dragStarted",this,{evt:o}),this.nativeDraggable&&S(document,"dragover",so);var n=this.options;!e&&X(p,n.dragClass,!1),X(p,n.ghostClass,!0),x.active=this,e&&this._appendGhost(),G({sortable:this,name:"start",originalEvent:o})}else this._nulling()},_emulateDragOver:function(){if(J){this._lastX=J.clientX,this._lastY=J.clientY,bn();for(var e=document.elementFromPoint(J.clientX,J.clientY),o=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(J.clientX,J.clientY),e!==o);)o=e;if(p.parentNode[W]._isOutsideThisEl(e),o)do{if(o[W]){var n=void 0;if(n=o[W]._onDragOver({clientX:J.clientX,clientY:J.clientY,target:e,rootEl:o}),n&&!this.options.dragoverBubble)break}e=o}while(o=ln(o));vn()}},_onTouchMove:function(e){if(me){var o=this.options,n=o.fallbackTolerance,i=o.fallbackOffset,a=e.touches?e.touches[0]:e,r=E&&Ie(E,!0),s=E&&r&&r.a,l=E&&r&&r.d,c=et&&F&&Ut(F),f=(a.clientX-me.clientX+i.x)/(s||1)+(c?c[0]-wt[0]:0)/(s||1),d=(a.clientY-me.clientY+i.y)/(l||1)+(c?c[1]-wt[1]:0)/(l||1);if(!x.active&&!xe){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(E){r?(r.e+=f-(vt||0),r.f+=d-(yt||0)):r={a:1,b:0,c:0,d:1,e:f,f:d};var m="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");w(E,"webkitTransform",m),w(E,"mozTransform",m),w(E,"msTransform",m),w(E,"transform",m),vt=f,yt=d,J=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!E){var e=this.options.fallbackOnBody?document.body:B,o=P(p,!0,et,!0,e),n=this.options;if(et){for(F=e;w(F,"position")==="static"&&w(F,"transform")==="none"&&F!==document;)F=F.parentNode;F!==document.body&&F!==document.documentElement?(F===document&&(F=Q()),o.top+=F.scrollTop,o.left+=F.scrollLeft):F=Q(),wt=Ut(F)}E=p.cloneNode(!0),X(E,n.ghostClass,!1),X(E,n.fallbackClass,!0),X(E,n.dragClass,!0),w(E,"transition",""),w(E,"transform",""),w(E,"box-sizing","border-box"),w(E,"margin",0),w(E,"top",o.top),w(E,"left",o.left),w(E,"width",o.width),w(E,"height",o.height),w(E,"opacity","0.8"),w(E,"position",et?"absolute":"fixed"),w(E,"zIndex","100000"),w(E,"pointerEvents","none"),x.ghost=E,e.appendChild(E),w(E,"transform-origin",Wt/parseInt(E.style.width)*100+"% "+Xt/parseInt(E.style.height)*100+"%")}},_onDragStart:function(e,o){var n=this,i=e.dataTransfer,a=n.options;if(U("dragStart",this,{evt:e}),x.eventCanceled){this._onDrop();return}U("setupClone",this),x.eventCanceled||(A=fn(p),A.removeAttribute("id"),A.draggable=!1,A.style["will-change"]="",this._hideClone(),X(A,this.options.chosenClass,!1),x.clone=A),n.cloneId=rt(function(){U("clone",n),!x.eventCanceled&&(n.options.removeCloneOnHide||B.insertBefore(A,p),n._hideClone(),G({sortable:n,name:"clone"}))}),!o&&X(p,a.dragClass,!0),o?(dt=!0,n._loopId=setInterval(n._emulateDragOver,50)):(k(document,"mouseup",n._onDrop),k(document,"touchend",n._onDrop),k(document,"touchcancel",n._onDrop),i&&(i.effectAllowed="move",a.setData&&a.setData.call(n,i,p)),S(document,"drop",n),w(p,"transform","translateZ(0)")),xe=!0,n._dragStartId=rt(n._dragStarted.bind(n,o,e)),S(document,"selectstart",n),He=!0,window.getSelection().removeAllRanges(),Re&&w(document.body,"user-select","none")},_onDragOver:function(e){var o=this.el,n=e.target,i,a,r,s=this.options,l=s.group,c=x.active,f=Ze===l,d=s.sort,m=j||c,g,b=this,h=!1;if(Ct)return;function _(Ae,Sn){U(Ae,b,ee({evt:e,isOwner:f,axis:g?"vertical":"horizontal",revert:r,dragRect:i,targetRect:a,canSort:d,fromSortable:m,target:n,completed:y,onMove:function(jt,In){return tt(B,o,p,i,jt,P(jt),e,In)},changed:v},Sn))}function C(){_("dragOverAnimationCapture"),b.captureAnimationState(),b!==m&&m.captureAnimationState()}function y(Ae){return _("dragOverCompleted",{insertion:Ae}),Ae&&(f?c._hideClone():c._showClone(b),b!==m&&(X(p,j?j.options.ghostClass:c.options.ghostClass,!1),X(p,s.ghostClass,!0)),j!==b&&b!==x.active?j=b:b===x.active&&j&&(j=null),m===b&&(b._ignoreWhileAnimating=n),b.animateAll(function(){_("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==m&&(m.animateAll(),m._ignoreWhileAnimating=null)),(n===p&&!p.animated||n===o&&!n.animated)&&(we=null),!s.dragoverBubble&&!e.rootEl&&n!==document&&(p.parentNode[W]._isOutsideThisEl(e.target),!Ae&&he(e)),!s.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),h=!0}function v(){Y=V(p),ce=V(p,s.draggable),G({sortable:b,name:"change",toEl:o,newIndex:Y,newDraggableIndex:ce,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=Z(n,s.draggable,o,!0),_("dragOver"),x.eventCanceled)return h;if(p.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||b._ignoreWhileAnimating===n)return y(!1);if(dt=!1,c&&!s.disabled&&(f?d||(r=L!==B):j===this||(this.lastPutMode=Ze.checkPull(this,c,p,e))&&l.checkPut(this,c,p,e))){if(g=this._getDirection(e,n)==="vertical",i=P(p),_("dragOverValid"),x.eventCanceled)return h;if(r)return L=B,C(),this._hideClone(),_("revert"),x.eventCanceled||(be?B.insertBefore(p,be):B.appendChild(p)),y(!0);var I=Pt(o,s.draggable);if(!I||fo(e,g,this)&&!I.animated){if(I===p)return y(!1);if(I&&o===e.target&&(n=I),n&&(a=P(n)),tt(B,o,p,i,n,a,e,!!n)!==!1)return C(),I&&I.nextSibling?o.insertBefore(p,I.nextSibling):o.appendChild(p),L=o,v(),y(!0)}else if(I&&uo(e,g,this)){var H=Ce(o,0,s,!0);if(H===p)return y(!1);if(n=H,a=P(n),tt(B,o,p,i,n,a,e,!1)!==!1)return C(),o.insertBefore(p,H),L=o,v(),y(!0)}else if(n.parentNode===o){a=P(n);var O=0,$,q=p.parentNode!==o,z=!ao(p.animated&&p.toRect||i,n.animated&&n.toRect||a,g),Te=g?"top":"left",re=Gt(n,"top","top")||Gt(p,"top","top"),De=re?re.scrollTop:void 0;we!==n&&($=a[Te],We=!1,Qe=!z&&s.invertSwap||q),O=po(e,n,a,g,z?1:s.swapThreshold,s.invertedSwapThreshold==null?s.swapThreshold:s.invertedSwapThreshold,Qe,we===n);var te;if(O!==0){var pe=V(p);do pe-=O,te=L.children[pe];while(te&&(w(te,"display")==="none"||te===E))}if(O===0||te===n)return y(!1);we=n,Ue=O;var Be=n.nextElementSibling,se=!1;se=O===1;var Je=tt(B,o,p,i,n,a,e,se);if(Je!==!1)return(Je===1||Je===-1)&&(se=Je===1),Ct=!0,setTimeout(co,30),C(),se&&!Be?o.appendChild(p):n.parentNode.insertBefore(p,se?Be:n),re&&un(re,0,De-re.scrollTop),L=p.parentNode,$!==void 0&&!Qe&&(at=Math.abs($-P(n)[Te])),v(),y(!0)}if(o.contains(p))return y(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){k(document,"mousemove",this._onTouchMove),k(document,"touchmove",this._onTouchMove),k(document,"pointermove",this._onTouchMove),k(document,"dragover",he),k(document,"mousemove",he),k(document,"touchmove",he)},_offUpEvents:function(){var e=this.el.ownerDocument;k(e,"mouseup",this._onDrop),k(e,"touchend",this._onDrop),k(e,"pointerup",this._onDrop),k(e,"pointercancel",this._onDrop),k(e,"touchcancel",this._onDrop),k(document,"selectstart",this)},_onDrop:function(e){var o=this.el,n=this.options;if(Y=V(p),ce=V(p,n.draggable),U("drop",this,{evt:e}),L=p&&p.parentNode,Y=V(p),ce=V(p,n.draggable),x.eventCanceled){this._nulling();return}xe=!1,Qe=!1,We=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Tt(this.cloneId),Tt(this._dragStartId),this.nativeDraggable&&(k(document,"drop",this),k(o,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Re&&w(document.body,"user-select",""),w(p,"transform",""),e&&(He&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),E&&E.parentNode&&E.parentNode.removeChild(E),(B===L||j&&j.lastPutMode!=="clone")&&A&&A.parentNode&&A.parentNode.removeChild(A),p&&(this.nativeDraggable&&k(p,"dragend",this),xt(p),p.style["will-change"]="",He&&!xe&&X(p,j?j.options.ghostClass:this.options.ghostClass,!1),X(p,this.options.chosenClass,!1),G({sortable:this,name:"unchoose",toEl:L,newIndex:null,newDraggableIndex:null,originalEvent:e}),B!==L?(Y>=0&&(G({rootEl:L,name:"add",toEl:L,fromEl:B,originalEvent:e}),G({sortable:this,name:"remove",toEl:L,originalEvent:e}),G({rootEl:L,name:"sort",toEl:L,fromEl:B,originalEvent:e}),G({sortable:this,name:"sort",toEl:L,originalEvent:e})),j&&j.save()):Y!==Se&&Y>=0&&(G({sortable:this,name:"update",toEl:L,originalEvent:e}),G({sortable:this,name:"sort",toEl:L,originalEvent:e})),x.active&&((Y==null||Y===-1)&&(Y=Se,ce=Ge),G({sortable:this,name:"end",toEl:L,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){U("nulling",this),B=p=L=E=be=A=it=de=me=J=He=Y=ce=Se=Ge=we=Ue=j=Ze=x.dragged=x.ghost=x.clone=x.active=null,ft.forEach(function(e){e.checked=!0}),ft.length=vt=yt=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":p&&(this._onDragOver(e),lo(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],o,n=this.el.children,i=0,a=n.length,r=this.options;i<a;i++)o=n[i],Z(o,r.draggable,this.el,!1)&&e.push(o.getAttribute(r.dataIdAttr)||mo(o));return e},sort:function(e,o){var n={},i=this.el;this.toArray().forEach(function(a,r){var s=i.children[r];Z(s,this.options.draggable,i,!1)&&(n[a]=s)},this),o&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(i.removeChild(n[a]),i.appendChild(n[a]))}),o&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,o){return Z(e,o||this.options.draggable,this.el,!1)},option:function(e,o){var n=this.options;if(o===void 0)return n[e];var i=Ke.modifyOption(this,e,o);typeof i<"u"?n[e]=i:n[e]=o,e==="group"&&hn(n)},destroy:function(){U("destroy",this);var e=this.el;e[W]=null,k(e,"mousedown",this._onTapStart),k(e,"touchstart",this._onTapStart),k(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(k(e,"dragover",this),k(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(o){o.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ut.splice(ut.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!de){if(U("hideClone",this),x.eventCanceled)return;w(A,"display","none"),this.options.removeCloneOnHide&&A.parentNode&&A.parentNode.removeChild(A),de=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(de){if(U("showClone",this),x.eventCanceled)return;p.parentNode==B&&!this.options.group.revertClone?B.insertBefore(A,p):be?B.insertBefore(A,be):B.appendChild(A),this.options.group.revertClone&&this.animate(p,A),w(A,"display",""),de=!1}}};function lo(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function tt(t,e,o,n,i,a,r,s){var l,c=t[W],f=c.options.onMove,d;return window.CustomEvent&&!ae&&!Ve?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=t,l.dragged=o,l.draggedRect=n,l.related=i||e,l.relatedRect=a||P(e),l.willInsertAfter=s,l.originalEvent=r,t.dispatchEvent(l),f&&(d=f.call(c,l,r)),d}function xt(t){t.draggable=!1}function co(){Ct=!1}function uo(t,e,o){var n=P(Ce(o.el,0,o.options,!0)),i=pn(o.el,o.options,E),a=10;return e?t.clientX<i.left-a||t.clientY<n.top&&t.clientX<n.right:t.clientY<i.top-a||t.clientY<n.bottom&&t.clientX<n.left}function fo(t,e,o){var n=P(Pt(o.el,o.options.draggable)),i=pn(o.el,o.options,E),a=10;return e?t.clientX>i.right+a||t.clientY>n.bottom&&t.clientX>n.left:t.clientY>i.bottom+a||t.clientX>n.right&&t.clientY>n.top}function po(t,e,o,n,i,a,r,s){var l=n?t.clientY:t.clientX,c=n?o.height:o.width,f=n?o.top:o.left,d=n?o.bottom:o.right,m=!1;if(!r){if(s&&at<c*i){if(!We&&(Ue===1?l>f+c*a/2:l<d-c*a/2)&&(We=!0),We)m=!0;else if(Ue===1?l<f+at:l>d-at)return-Ue}else if(l>f+c*(1-i)/2&&l<d-c*(1-i)/2)return go(e)}return m=m||r,m&&(l<f+c*a/2||l>d-c*a/2)?l>f+c/2?1:-1:0}function go(t){return V(p)<V(t)?1:-1}function mo(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,o=e.length,n=0;o--;)n+=e.charCodeAt(o);return n.toString(36)}function ho(t){ft.length=0;for(var e=t.getElementsByTagName("input"),o=e.length;o--;){var n=e[o];n.checked&&ft.push(n)}}function rt(t){return setTimeout(t,0)}function Tt(t){return clearTimeout(t)}gt&&S(document,"touchmove",function(t){(x.active||xe)&&t.cancelable&&t.preventDefault()});x.utils={on:S,off:k,css:w,find:cn,is:function(e,o){return!!Z(e,o,e,!1)},extend:Jn,throttle:dn,closest:Z,toggleClass:X,clone:fn,index:V,nextTick:rt,cancelNextTick:Tt,detectDirection:mn,getChild:Ce,expando:W};x.get=function(t){return t[W]};x.mount=function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(x.utils=ee(ee({},x.utils),n.utils)),Ke.mount(n)})};x.create=function(t,e){return new x(t,e)};x.version=Vn;var N=[],je,Dt,Bt=!1,Et,kt,pt,$e;function bo(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(o){var n=o.originalEvent;this.sortable.nativeDraggable?S(document,"dragover",this._handleAutoScroll):this.options.supportPointer?S(document,"pointermove",this._handleFallbackAutoScroll):n.touches?S(document,"touchmove",this._handleFallbackAutoScroll):S(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(o){var n=o.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?k(document,"dragover",this._handleAutoScroll):(k(document,"pointermove",this._handleFallbackAutoScroll),k(document,"touchmove",this._handleFallbackAutoScroll),k(document,"mousemove",this._handleFallbackAutoScroll)),Vt(),st(),Zn()},nulling:function(){pt=Dt=je=Bt=$e=Et=kt=null,N.length=0},_handleFallbackAutoScroll:function(o){this._handleAutoScroll(o,!0)},_handleAutoScroll:function(o,n){var i=this,a=(o.touches?o.touches[0]:o).clientX,r=(o.touches?o.touches[0]:o).clientY,s=document.elementFromPoint(a,r);if(pt=o,n||this.options.forceAutoScrollFallback||Ve||ae||Re){St(o,this.options,s,n);var l=ue(s,!0);Bt&&(!$e||a!==Et||r!==kt)&&($e&&Vt(),$e=setInterval(function(){var c=ue(document.elementFromPoint(a,r),!0);c!==l&&(l=c,st()),St(o,i.options,c,n)},10),Et=a,kt=r)}else{if(!this.options.bubbleScroll||ue(s,!0)===Q()){st();return}St(o,this.options,ue(s,!1),!1)}}},ie(t,{pluginName:"scroll",initializeByDefault:!0})}function st(){N.forEach(function(t){clearInterval(t.pid)}),N=[]}function Vt(){clearInterval($e)}var St=dn(function(t,e,o,n){if(e.scroll){var i=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,r=e.scrollSensitivity,s=e.scrollSpeed,l=Q(),c=!1,f;Dt!==o&&(Dt=o,st(),je=e.scroll,f=e.scrollFn,je===!0&&(je=ue(o,!0)));var d=0,m=je;do{var g=m,b=P(g),h=b.top,_=b.bottom,C=b.left,y=b.right,v=b.width,I=b.height,H=void 0,O=void 0,$=g.scrollWidth,q=g.scrollHeight,z=w(g),Te=g.scrollLeft,re=g.scrollTop;g===l?(H=v<$&&(z.overflowX==="auto"||z.overflowX==="scroll"||z.overflowX==="visible"),O=I<q&&(z.overflowY==="auto"||z.overflowY==="scroll"||z.overflowY==="visible")):(H=v<$&&(z.overflowX==="auto"||z.overflowX==="scroll"),O=I<q&&(z.overflowY==="auto"||z.overflowY==="scroll"));var De=H&&(Math.abs(y-i)<=r&&Te+v<$)-(Math.abs(C-i)<=r&&!!Te),te=O&&(Math.abs(_-a)<=r&&re+I<q)-(Math.abs(h-a)<=r&&!!re);if(!N[d])for(var pe=0;pe<=d;pe++)N[pe]||(N[pe]={});(N[d].vx!=De||N[d].vy!=te||N[d].el!==g)&&(N[d].el=g,N[d].vx=De,N[d].vy=te,clearInterval(N[d].pid),(De!=0||te!=0)&&(c=!0,N[d].pid=setInterval((function(){n&&this.layer===0&&x.active._onTouchMove(pt);var Be=N[this.layer].vy?N[this.layer].vy*s:0,se=N[this.layer].vx?N[this.layer].vx*s:0;typeof f=="function"&&f.call(x.dragged.parentNode[W],se,Be,t,pt,N[this.layer].el)!=="continue"||un(N[this.layer].el,se,Be)}).bind({layer:d}),24))),d++}while(e.bubbleScroll&&m!==l&&(m=ue(m,!1)));Bt=c}},30),yn=function(e){var o=e.originalEvent,n=e.putSortable,i=e.dragEl,a=e.activeSortable,r=e.dispatchSortableEvent,s=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(o){var c=n||a;s();var f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:o,d=document.elementFromPoint(f.clientX,f.clientY);l(),c&&!c.el.contains(d)&&(r("spill"),this.onSpill({dragEl:i,putSortable:n}))}};function Ot(){}Ot.prototype={startIndex:null,dragStart:function(e){var o=e.oldDraggableIndex;this.startIndex=o},onSpill:function(e){var o=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var i=Ce(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(o,i):this.sortable.el.appendChild(o),this.sortable.animateAll(),n&&n.animateAll()},drop:yn};ie(Ot,{pluginName:"revertOnSpill"});function Mt(){}Mt.prototype={onSpill:function(e){var o=e.dragEl,n=e.putSortable,i=n||this.sortable;i.captureAnimationState(),o.parentNode&&o.parentNode.removeChild(o),i.animateAll()},drop:yn};ie(Mt,{pluginName:"removeOnSpill"});x.mount(new bo);x.mount(Mt,Ot);function Ht(t){const e=document.getElementById("notes-grid");if(!e)return;e.innerHTML="";const o=u.currentView==="all"?u.notes.filter(r=>{const s=u.categories.find(l=>l.id===r.categoryId);return!s||!s.passwordHash}):u.notes.filter(r=>r.categoryId===u.currentView),n=o.filter(r=>r.pinned),i=o.filter(r=>!r.pinned),a=r=>{const s=document.createElement("div");s.className="note-card note-animate-in relative group",s.dataset.id=r.id;const l=Xe.find(m=>m.id===r.themeId)||Xe[0],c=u.settings.theme==="dark"?l.dark:l.light;r.themeId!=="default"&&(s.style.backgroundColor=c,s.style.borderColor=u.settings.theme==="dark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)");const f=u.categories.find(m=>m.id===r.categoryId),d=u.unlockedNotes.has(r.id);return s.innerHTML=`
            <div class="note-card-content">
                <div class="flex items-start justify-between mb-2">
                    <h3 class="font-bold text-base line-clamp-2 leading-snug flex-1 pr-3">${r.title}</h3>
                    <div class="flex items-center gap-2 shrink-0 pt-0.5">
                        ${r.pinned?'<i data-lucide="pin" class="w-4 h-4 fill-current text-primary"></i>':""}
                        ${r.passwordHash?`<i data-lucide="${d?"unlock":"lock"}" class="w-4 h-4 lock-indicator cursor-pointer opacity-80" data-id="${r.id}"></i>`:""}
                    </div>
                </div>
                <div class="text-[13px] opacity-70 line-clamp-6 leading-relaxed mb-4 flex-1">
                    ${r.passwordHash&&!d?'<div class="flex items-center gap-3 py-8 italic opacity-50"><i data-lucide="shield-alert" class="w-6 h-6"></i> Contenido restringido</div>':r.content}
                </div>
                ${f?`
                <div class="mt-auto">
                    <span class="flex items-center gap-2 text-[10px] px-3 py-1.5 rounded-full bg-primary border border-primary/20 font-bold text-primary-foreground uppercase tracking-widest">
                        <i data-lucide="${f.icon||"tag"}" class="w-3.5 h-3.5 text-primary-foreground"></i>
                        ${f.name}
                    </span>
                </div>`:""}
            </div>
        `,s.onclick=async m=>{if(!m.target.closest(".delete-note-btn")){if(r.passwordHash&&!u.unlockedNotes.has(r.id)){try{const g=await fe("Nota Protegida","Ingresa la contrase√±a para ver esta nota:");if(!g)return;if(await M.hash(g)!==r.passwordHash){D("‚ùå Contrase√±a incorrecta");return}u.unlockedNotes.add(r.id),t(r),setTimeout(()=>Ht(t),300)}catch(g){console.error("Error unlocking note:",g),D("‚ùå Error al desbloquear")}return}t(r)}},s};if(n.length>0){const r=document.createElement("h3");if(r.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2 flex items-center gap-2",r.innerHTML='<i data-lucide="pin" class="w-3 h-3"></i> Destacadas',e.appendChild(r),n.forEach(s=>e.appendChild(a(s))),i.length>0){const s=document.createElement("div");s.className="col-span-full h-px bg-border my-4",e.appendChild(s)}}if(i.length>0){if(n.length>0){const r=document.createElement("h3");r.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2",r.innerText="Notas",e.appendChild(r)}i.forEach(r=>e.appendChild(a(r)))}o.length===0&&(e.innerHTML=`<div class="col-span-full text-center py-20 text-muted-foreground opacity-50">
            <i data-lucide="ghost" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
            <p>No hay notas aqu√≠</p>
        </div>`),R(),vo()}function vo(t){const e=document.getElementById("notes-grid");e&&(e.sortable&&e.sortable.destroy(),e.sortable=x.create(e,{animation:250,ghostClass:"opacity-50",delay:500,delayOnTouchOnly:!0,onEnd:async()=>{const o=[];e.querySelectorAll(".note-card").forEach(a=>{const r=u.notes.find(s=>s.id===a.dataset.id);r&&o.push(r)});const n=new Set(o.map(a=>a.id)),i=u.notes.filter(a=>!n.has(a.id));u.notes=[...o,...i],await K()}}))}const yo="974464877836-721dprai6taijtuufmrkh438q68e97sp.apps.googleusercontent.com";let Le=null;async function Kt(){console.log("Iniciando aplicaci√≥n modular...");const t=localStorage.getItem("cn_vault_key_v3");t&&sessionStorage.setItem("cn_vault_key_v3",t),wo(),_n(),xn(),Mn(oe),Gn(),xo();const e=localStorage.getItem("cn_last_version");if(e&&e!==Pe){localStorage.setItem("cn_last_version",Pe),console.log(`Nueva versi√≥n detectada (${Pe}). Recargando...`),D("üöÄ Actualizando a la √∫ltima versi√≥n..."),setTimeout(()=>location.reload(!0),1500);return}localStorage.setItem("cn_last_version",Pe),await Ln(oe),Eo(),ko(),Io(),_o(),So(),To(),Do(),R(),console.log("Aplicaci√≥n lista.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Kt):Kt();function wo(){const t=document.getElementById("root");if(!t)return console.error("No se encontr√≥ el elemento #root");t.innerHTML=`
        ${An()}
        ${Pn()}
        ${On()}
        ${$n()}
        ${qn()}
        ${Un()}
    `,console.log("Estructura inyectada.")}function oe(){Ht(ze),Lt(mt,u.categories),wn(),R()}function mt(t,e){u.currentView=t,wn(e),Ht(ze),document.querySelectorAll("[data-view]").forEach(o=>{o.classList.toggle("active",o.dataset.view===t)}),Lt(mt)}function wn(t=null){const e=document.getElementById("view-title"),o=document.getElementById("view-desc");if(!e)return;const n=u.categories.find(a=>a.id===u.currentView),i=t||(n?n.name:"Todas las notas");e.innerText=i,o&&(o.innerText=u.currentView==="all"?"Organiza tus pensamientos y protege tu privacidad.":"",o.style.display=u.currentView==="all"?"block":"none")}function xn(){const t=u.settings.theme==="dark";document.documentElement.classList.toggle("dark",t),document.documentElement.classList.toggle("light",!t)}function T(t,e){const o=document.getElementById(t);o&&(o.onclick=e)}function xo(){T("add-note-btn",()=>ze()),T("mobile-add-btn",()=>ze()),T("sync-btn",_e),T("mobile-sync-btn",_e),T("mobile-sync-btn-bottom",_e),T("settings-trigger",en),T("mobile-settings-btn",()=>{Ee(),en()}),T("sidebar-collapse-btn",()=>{const a=document.querySelector("aside");a.classList.toggle("collapsed");const r=a.classList.contains("collapsed");localStorage.setItem("sidebar_collapsed",r),kn()}),T("mobile-force-reload-btn",an),document.body.addEventListener("click",a=>{a.target.closest("#logout-btn, #mobile-logout-btn")&&Qt(),a.target.id==="mobile-sidebar-overlay"&&Ee()});const t=async()=>{u.settings.drivePath=document.getElementById("config-drive-path").value,u.settings.algo=document.getElementById("config-algo").value,u.settings.notesPerChunk=parseInt(document.getElementById("config-notes-per-chunk").value)||50,await K(),D("‚úÖ Configuraci√≥n guardada"),Jt()};T("save-sync-config",t),T("save-security-config",t),T("connect-drive-btn",En),T("theme-light",()=>tn("light")),T("theme-dark",()=>tn("dark")),document.querySelectorAll(".nav-link[data-view], .nav-link-mobile[data-view], .nav-link-mobile-drawer[data-view]").forEach(a=>{a.onclick=()=>{const r=a.dataset.view,s=u.categories.find(c=>c.id===r),l=s?s.name:r==="all"?"Todas las notas":"";mt(r,l),Ee()}}),document.querySelectorAll(".nav-link-mobile-drawer").forEach(a=>{a.onclick=r=>{r.preventDefault();const s=a.dataset.category;u.currentView=s,document.querySelectorAll(".nav-link[data-view], .nav-link-mobile[data-view]").forEach(l=>l.classList.remove("active")),document.querySelectorAll("#sidebar-categories .nav-link").forEach(l=>l.classList.remove("active")),document.querySelectorAll(".nav-link-mobile-drawer").forEach(l=>{const c=l.dataset.category===s;l.classList.toggle("active",c);const f=l.querySelector("i");f&&f.classList.toggle("text-primary",c);const d=l.querySelector("span");d&&d.classList.toggle("text-primary",c)}),Ee(),oe()}}),T("sidebar-manage-cats",Zt),T("mobile-manage-cats",()=>{Ee(),Zt()}),T("add-cat-btn",Co);const o=a=>{const r=a.target.closest("#settings-modal, #categories-modal, #editor-modal");r&&r.classList.add("hidden")};document.querySelectorAll(".close-modal, .close-settings, .close-categories").forEach(a=>{a.onclick=o}),document.body.addEventListener("click",a=>{const r=a.target.closest(".toggle-pass");if(!r)return;const s=document.getElementById(r.dataset.target);if(!s)return;const l=s.type==="password";s.type=l?"text":"password",r.innerHTML=`<i data-lucide="${l?"eye-off":"eye"}" class="w-4 h-4"></i>`,R()}),document.body.addEventListener("keydown",a=>{if(a.key==="Enter"){const r=document.getElementById("auth-shield");if(r&&!r.classList.contains("hidden")){const s=document.getElementById("master-password"),l=document.getElementById("confirm-password");(document.activeElement===s||document.activeElement===l)&&zt(oe)}}}),T("auth-submit",()=>zt(oe));const n=document.getElementById("factory-reset-confirm"),i=document.getElementById("factory-reset");n&&i&&(n.oninput=()=>{i.disabled=n.value.toLowerCase()!=="confirmar"},i.onclick=()=>{n.value.toLowerCase()==="confirmar"&&(localStorage.clear(),sessionStorage.clear(),location.reload())}),window.triggerAutoSync=Jt,window.handleLogout=Qt,window.openEditor=ze}function Eo(){const t=n=>{const i=n.target.value.toLowerCase();document.querySelectorAll(".note-card").forEach(r=>{const s=u.notes.find(c=>c.id===r.dataset.id);if(!s)return;const l=s.title.toLowerCase().includes(i)||s.content.toLowerCase().includes(i);r.classList.toggle("hidden",!l)})},e=document.getElementById("search-input"),o=document.getElementById("mobile-search-input-top");e&&(e.oninput=t),o&&(o.oninput=t)}function ko(){const t=document.getElementById("mobile-sidebar-overlay"),e=()=>{t==null||t.classList.remove("hidden"),Lt(mt,u.categories)};T("mobile-sidebar-trigger",e),T("mobile-sidebar-trigger-bottom",e),T("close-mobile-sidebar",Ee);const o=document.getElementById("mobile-search-bar"),n=document.getElementById("mobile-search-input-top"),i=()=>{o==null||o.classList.remove("hidden"),n==null||n.focus()};T("mobile-search-btn",i),T("mobile-search-trigger",i),T("close-mobile-search",()=>{o&&o.classList.add("hidden"),n&&(n.value="",n.dispatchEvent(new Event("input")))}),T("mobile-search-trigger",()=>{o==null||o.classList.remove("hidden"),n==null||n.focus()})}function So(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(e=>{console.log("SW registrado corectamente:",e.scope)}).catch(e=>{console.log("Fallo al registrar SW:",e)})})}function Io(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),Le=e,["pwa-install-btn","sidebar-pwa-install-btn","mobile-pwa-install-btn"].forEach(n=>{var i;return(i=document.getElementById(n))==null?void 0:i.classList.remove("hidden")})});const t=async()=>{if(!Le)return;Le.prompt();const{outcome:e}=await Le.userChoice;e==="accepted"&&["pwa-install-btn","sidebar-pwa-install-btn","mobile-pwa-install-btn"].forEach(n=>{var i;return(i=document.getElementById(n))==null?void 0:i.classList.add("hidden")}),Le=null};T("pwa-install-btn",t),T("sidebar-pwa-install-btn",t),T("mobile-pwa-install-btn",t)}function _o(){const t=setInterval(()=>{typeof gapi<"u"&&typeof google<"u"&&google.accounts&&(clearInterval(t),gapi.load("client",async()=>{await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),u.gapiLoaded=!0,u.tokenClient=google.accounts.oauth2.initTokenClient({client_id:yo,scope:"https://www.googleapis.com/auth/drive.file",callback:async o=>{if(o.error)return D("‚ùå Error de vinculaci√≥n");const n=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(!n)return D("‚ùå Error: Sesi√≥n no v√°lida");try{const i=new on("notev3_",u.settings.drivePath,u.settings.notesPerChunk),a=await i.getOrCreateFolder(u.settings.drivePath);gapi.client.setToken(o),await i.loadChunks(a,n)&&D("‚úÖ Drive verificado: Contrase√±a correcta"),localStorage.setItem("gdrive_token_v3",JSON.stringify(o)),gapi.client.setToken(o),Ne(!0),D("‚úÖ Vinculado con Google Drive"),_e()}catch(i){console.error("Drive connection error:",i),D("‚ùå Error al verificar Drive")}}});const e=localStorage.getItem("gdrive_token_v3");if(e){const o=JSON.parse(e);gapi.client.setToken(o),Ne(!0),setTimeout(()=>Ne(!0),500),setTimeout(()=>Ne(!0),2e3)}else Ne(!1)}))},500)}function En(){if(!u.tokenClient)return D(typeof gapi>"u"||typeof google>"u"?"‚è≥ Cargando librer√≠as de Google...":"‚è≥ Inicializando API de Google...");u.tokenClient.requestAccessToken({prompt:""})}function Ne(t){const e=document.getElementById("drive-status"),o=document.getElementById("sync-btn");e&&(e.innerHTML=t?'<span class="flex items-center gap-2 text-green-500 font-bold"><i data-lucide="check-circle" class="w-4 h-4"></i> Conectado</span>':'<span class="flex items-center gap-2 text-muted-foreground font-bold font-mono uppercase"><i data-lucide="x-circle" class="w-4 h-4"></i> No conectado</span>',e.className=t?"text-[10px] px-2 py-0.5 rounded-full bg-primary/10 text-primary":"text-[10px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground"),o&&(o.style.opacity=t?"1":"0.3",o.style.pointerEvents=t?"auto":"none"),R()}let It=!1;async function _e(){if(It)return;const t=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");if(!t)return;const e=document.querySelectorAll('#sync-icon, [data-lucide="refresh-cw"]'),o=document.querySelectorAll("#sync-btn, #mobile-sync-btn, #mobile-sync-btn-bottom");It=!0,e.forEach(n=>n.classList.add("animate-spin")),o.forEach(n=>n.classList.add("text-primary"));try{const n=new on("notev3_",u.settings.drivePath,u.settings.notesPerChunk),i=await n.getOrCreateFolder(u.settings.drivePath),a=await n.loadChunks(i,t);if(a)try{if(a&&Array.isArray(a.notes)){const r=new Map(a.notes.map(g=>[g.id,g])),s=new Map(u.notes.map(g=>[g.id,g])),l=new Set([...r.keys(),...s.keys()]),c=Array.from(l).map(g=>{const b=s.get(g),h=r.get(g);return b?h&&h.updatedAt>b.updatedAt?h:b:h});u.notes=c.sort((g,b)=>b.updatedAt-g.updatedAt);const f=new Map(a.categories.map(g=>[g.id,g])),d=new Map(u.categories.map(g=>[g.id,g])),m=new Set([...f.keys(),...d.keys()]);u.categories=Array.from(m).map(g=>d.get(g)||f.get(g)),await K(),oe()}}catch(r){console.error("Decryption failed during sync pull",r),D("‚ö†Ô∏è No se pudo descargar: Contrase√±a no coincide")}await n.saveChunks(u.notes,u.categories,t,i),D("‚úÖ Sincronizaci√≥n completa")}catch(n){console.error("Sync error:",n),n.status===401||n.result&&n.result.error&&n.result.error.code===401?(D("‚ö†Ô∏è Sesi√≥n de Drive expirada. Re-conectando..."),En()):D("‚ùå Error de sincronizaci√≥n")}finally{It=!1;const n=document.querySelectorAll('#sync-icon, [data-lucide="refresh-cw"]'),i=document.querySelectorAll("#sync-btn, #mobile-sync-btn, #mobile-sync-btn-bottom");n.forEach(a=>a.classList.remove("animate-spin")),i.forEach(a=>a.classList.remove("text-primary"))}}function Jt(){const t=localStorage.getItem("gdrive_token_v3"),e=sessionStorage.getItem("cn_vault_key_v3")||localStorage.getItem("cn_vault_key_v3");u.gapiLoaded&&t&&e&&_e()}function Zt(){const t=document.getElementById("categories-modal");t&&(t.classList.remove("hidden"),Ye(oe,u.categories))}function Ee(){const t=document.getElementById("mobile-sidebar-overlay"),e=document.getElementById("mobile-sidebar-drawer");!t||t.classList.contains("hidden")||(e?(e.classList.add("animate-out","slide-out-to-left"),t.classList.add("fade-out"),setTimeout(()=>{t.classList.add("hidden"),e.classList.remove("animate-out","slide-out-to-left")},200)):t.classList.add("hidden"))}async function Co(){const t=document.getElementById("new-cat-name"),e=t==null?void 0:t.value.trim();if(!e)return;const o={id:"cat_"+Date.now(),name:e,icon:"tag",passwordHash:null};u.categories.push(o),await K(),t&&(t.value=""),Ye(oe,u.categories),oe(),localStorage.getItem("gdrive_token_v3")&&_e()}function Qt(){localStorage.removeItem("cn_vault_key_v3"),sessionStorage.removeItem("cn_vault_key_v3"),localStorage.removeItem("cn_pass_plain_v3"),sessionStorage.removeItem("cn_pass_plain_v3"),location.reload()}function To(){["app-version","settings-version-display","mobile-app-version"].forEach(t=>{const e=document.getElementById(t);e&&(e.innerText=Pe)})}function en(){const t=document.getElementById("settings-modal");if(t){t.classList.remove("hidden"),document.getElementById("config-drive-path").value=u.settings.drivePath,document.getElementById("config-algo").value=u.settings.algo,document.getElementById("config-sync-chunk-size")&&(document.getElementById("config-sync-chunk-size").value=u.settings.syncChunkSize||500);const e=t.querySelector('.settings-tab[data-tab="appearance"]');if(e&&window.innerWidth>=768&&e.click(),window.innerWidth<768){const o=document.getElementById("settings-sidebar"),n=document.getElementById("settings-content-area");o&&n&&(o.classList.remove("hidden"),n.classList.add("hidden"))}}}function Do(){const t=localStorage.getItem("sidebar_collapsed")==="true",e=document.querySelector("aside");e&&t&&(e.classList.add("collapsed"),kn())}function kn(){const t=document.querySelector("aside");if(!t)return;const e=t.classList.contains("collapsed"),o=document.getElementById("sidebar-collapse-icon");o&&(o.setAttribute("data-lucide",e?"chevrons-right":"chevrons-left"),R())}function tn(t){u.settings.theme=t,xn(),K()}
