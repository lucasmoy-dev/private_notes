@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
    :root {
        --background: 210 20% 98%;
        --foreground: 220 10% 10%;
        --card: 0 0% 100%;
        --card-foreground: 220 10% 10%;
        --sidebar: 210 20% 96%;
        --sidebar-foreground: 220 10% 15%;
        --popover: 0 0% 100%;
        --popover-foreground: 220 10% 10%;
        --primary: 240 5.9% 10%;
        --primary-foreground: 0 0% 98%;
        --secondary: 210 20% 90%;
        --secondary-foreground: 220 10% 10%;
        --muted: 210 20% 94%;
        --muted-foreground: 220 10% 45%;
        --accent: 210 20% 92%;
        --accent-foreground: 220 10% 10%;
        --destructive: 0 84.2% 60.2%;
        --destructive-foreground: 0 0% 98%;
        --border: 210 20% 90%;
        --input: 210 20% 90%;
        --ring: 240 5.9% 10%;
        --radius: 0.75rem;
    }

    .dark {
        --background: 240 10% 6%;
        --foreground: 0 0% 98%;
        --card: 240 10% 9%;
        --card-foreground: 0 0% 98%;
        --sidebar: 240 10% 7%;
        --sidebar-foreground: 0 0% 90%;
        --popover: 240 10% 10%;
        --popover-foreground: 0 0% 98%;
        --primary: 240 5.9% 20%;
        --primary-foreground: 0 0% 98%;
        --secondary: 240 3.7% 18.9%;
        --secondary-foreground: 0 0% 98%;
        --muted: 240 3.7% 18.9%;
        --muted-foreground: 240 5% 70%;
        --accent: 240 3.7% 22%;
        --accent-foreground: 0 0% 98%;
        --destructive: 0 84% 60%;
        --destructive-foreground: 210 40% 98%;
        --border: 240 3.7% 20%;
        --input: 240 3.7% 20%;
        --ring: 240 4.9% 83.9%;
    }
}

@layer base {
    * {
        @apply border-border;
        font-family: 'Roboto', sans-serif !important;
    }

    body {
        @apply bg-background text-foreground transition-colors duration-300 antialiased;
        font-family: 'Roboto', sans-serif !important;
        font-feature-settings: "cv02", "cv03", "cv04", "cv11";
    }
}

@layer components {
    .btn-shad {
        @apply inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2;
    }

    /* Mobile Add Button Refined */
    #mobile-add-btn {
        @apply transition-all duration-200;
    }

    #mobile-add-btn:active {
        @apply scale-90 opacity-70;
    }

    .btn-shad-primary {
        @apply bg-indigo-600 text-white hover:bg-indigo-700 shadow-md shadow-indigo-500/20 active:scale-95 transition-all;
    }

    .btn-shad-secondary {
        @apply bg-secondary text-secondary-foreground hover:bg-secondary/80;
    }

    .btn-shad-success {
        @apply bg-emerald-600 text-white hover:bg-emerald-700 shadow-md;
    }

    .btn-shad-outline {
        @apply border border-input bg-background hover:bg-accent hover:text-accent-foreground;
    }

    .btn-shad-ghost {
        @apply hover:bg-accent hover:text-accent-foreground;
    }

    .nav-link {
        @apply flex items-center justify-start gap-3 px-3 py-2 text-sm font-medium rounded-md transition-colors;
        @apply text-muted-foreground hover:bg-accent hover:text-accent-foreground;
    }

    .nav-link.active,
    .nav-link-mobile-drawer.active {
        @apply text-violet-500 font-bold bg-violet-500/5 !important;
        @apply dark:text-violet-400 dark:bg-violet-500/10 !important;
    }

    .nav-link-mobile.active {
        @apply text-foreground font-bold !important;
    }

    .nav-link.active {
        @apply border-r-4 border-violet-500;
    }

    .nav-link-mobile-drawer.active {
        @apply border-l-4 border-violet-500;
    }

    .nav-link-mobile.active i {
        @apply scale-110 text-foreground transition-transform !important;
    }

    .card-shad {
        @apply rounded-xl border bg-card text-card-foreground shadow-sm;
    }

    .dialog-overlay {
        @apply fixed inset-0 z-50 bg-black/80 backdrop-blur-sm transition-all duration-300;
    }

    .dialog-content {
        @apply fixed left-[50%] top-[50%] z-50 grid w-[90%] max-w-lg translate-x-[-50%] translate-y-[-50%] gap-0 border bg-background shadow-2xl sm:rounded-2xl;
        transform-origin: center center;
        animation: dialog-pop-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
            height 0.3s cubic-bezier(0.4, 0, 0.2, 1),
            max-width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
            max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1),
            top 0.3s cubic-bezier(0.4, 0, 0.2, 1),
            left 0.3s cubic-bezier(0.4, 0, 0.2, 1),
            transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
            border-radius 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .dialog-content.dialog-hide {
        animation: dialog-pop-out 0.2s ease-in forwards !important;
    }

    @keyframes dialog-pop-in {
        from {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.95);
        }

        to {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
    }

    @keyframes dialog-pop-out {
        from {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        to {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.95);
        }
    }

    .dialog-content.fullscreen {
        @apply w-full h-full max-w-none max-h-none rounded-none left-0 top-0 translate-x-0 translate-y-0 !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }



    .popover-content {
        @apply z-50 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none animate-in fade-in-0 zoom-in-95;
    }

    .editor-tool {
        @apply h-9 w-9 inline-flex items-center justify-center rounded-md hover:bg-accent hover:text-accent-foreground text-muted-foreground transition-all duration-200 shrink-0;
    }

    .editor-tool.active {
        @apply bg-violet-500 text-white border-violet-500 shadow-md ring-1 ring-violet-400/30 !important;
        @apply dark:bg-violet-600 dark:border-violet-700 !important;
        opacity: 1 !important;
    }

    .menu-active-violet {
        @apply bg-violet-500/10 text-violet-600 dark:text-violet-400 font-bold !important;
    }

    .editor-tool i {
        @apply transition-transform duration-200;
    }

    .editor-tool:active i {
        @apply scale-90;
    }

    /* Note Card */
    .note-card {
        @apply card-shad relative transition-all duration-200 hover:ring-1 hover:ring-ring border cursor-pointer flex flex-col min-w-0;
    }

    .note-card:hover {
        @apply shadow-md;
    }

    .note-card-content {
        @apply p-5 flex flex-col h-full gap-3;
    }

    .note-card.pinned {
        @apply border-primary/50 ring-1 ring-primary/20;
    }
}

/* Sidebar Custom Styling */
aside {
    @apply hidden md:flex flex-col border-r bg-[hsl(var(--sidebar))] transition-all duration-300 ease-in-out;
    width: 280px;
}

aside.collapsed {
    width: 80px !important;
}

main {
    @apply flex-1 flex flex-col min-w-0 transition-all duration-300 ease-in-out;
}

.ov-hidden {
    overflow: hidden;
}

/* Fix input padding overlap */
input.pl-12 {
    padding-left: 3rem !important;
    /* 48px */
}

.absolute.left-4 {
    left: 1rem !important;
    /* 16px */
}

/* Sidebar Headings */
.sidebar-section-title {
    @apply text-[10px] font-bold text-muted-foreground/60 uppercase tracking-[0.2em] px-4 mb-2;
}

/* Password eye toggle */
.toggle-pass {
    @apply transition-colors h-11 w-11 flex items-center justify-center rounded-md absolute right-0 top-1/2 -translate-y-1/2;
}

.toggle-pass i {
    @apply opacity-50;
}

/* Scrollbar styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    @apply bg-transparent;
}

#notes-viewport {
    scrollbar-gutter: stable;
}

::-webkit-scrollbar-thumb {
    @apply bg-muted rounded-full border-4 border-solid border-background hover:bg-muted-foreground/30;
}

/* Animations */
@keyframes note-in {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.note-animate-in {
    animation: note-in 0.25s ease-out forwards;
}

.no-animate .note-animate-in {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
}

/* Input Styles */
input[type="text"],
input[type="password"],
input[type="email"],
input[type="number"],
select,
textarea {
    @apply flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all;
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
    max-width: 100%;
}

@media (max-width: 640px) {

    input[type="password"],
    input[type="text"] {
        @apply h-11 !important;
    }
}

.dark input[type="text"],
.dark input[type="password"],
.dark select {
    background-color: hsl(var(--card));
    border-color: hsl(var(--border));
    color: rgba(255, 255, 255, 0.9);
}

.dark input:focus {
    border-color: hsl(var(--ring));
    background-color: hsl(var(--accent));
}

/* Custom Dropdown */
#cat-dropdown-menu {
    @apply bg-popover text-popover-foreground border shadow-2xl rounded-xl p-1.5 mt-2 w-max min-w-[140px] max-w-[220px] z-[100];
    transform-origin: top left;
    animation: dropdown-in 0.2s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes dropdown-in {
    from {
        opacity: 0;
        transform: scale(0.95) translateY(-10px);
    }

    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

#cat-dropdown-menu div {
    @apply relative flex cursor-pointer select-none items-center rounded-lg px-3 py-2 text-sm outline-none transition-all hover:bg-accent hover:text-accent-foreground gap-2 mb-0.5 last:mb-0;
}

#cat-dropdown-menu div:active {
    @apply scale-[0.98];
}

/* Grid Layout */
#notes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.25rem;
}

@media (max-width: 640px) {
    #notes-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
        gap: 0.5rem;
    }

    #notes-viewport {
        padding: 0.75rem 0.5rem 5rem 0.5rem;
    }

    .dialog-content {
        @apply w-[95%] h-auto max-h-[92vh] rounded-3xl shadow-2xl border bg-background p-0 left-[50%] top-[50%] -translate-x-1/2 -translate-y-1/2 fixed !important;
    }


    #editor-modal .dialog-content {
        @apply w-full h-full max-w-none max-h-none rounded-none left-0 top-0 translate-x-0 translate-y-0 !important;
    }

    /* Mobile Bottom Nav - Remove shadow from add button */
    #mobile-add-btn>div {
        box-shadow: none !important;
    }

    /* Settings Modal - Fullscreen on Mobile */
    #settings-modal .dialog-content {
        width: 100vw !important;
        height: 100vh !important;
        max-width: 100vw !important;
        max-height: 100vh !important;
        border-radius: 0 !important;
        margin: 0 !important;
    }

    /* Make mobile settings buttons larger */
    #mobile-manage-cats,
    #mobile-settings-btn,
    #mobile-pwa-install-btn {
        padding: 1rem !important;
        font-size: 0.9375rem !important;
        font-weight: 600 !important;
    }

    #mobile-force-reload-btn {
        padding: 1rem !important;
        font-size: 0.875rem !important;
        font-weight: 600 !important;
    }

    /* Hide Desktop Header on Mobile */
    header.md\:flex {
        display: none !important;
    }

    #mobile-search-bar {
        @apply h-full w-full z-[120] left-0 top-0;
    }

    /* Editor Mobile Tweaks */
    .editor-tool {
        @apply h-9 w-9 !important;
    }

    .editor-bottom-bar {
        @apply flex-nowrap overflow-x-hidden !important;
    }

    #editor-modal .dialog-content {
        display: flex !important;
        flex-direction: column !important;
    }


}

/* Collapsible Sidebar Support */
aside.collapsed {
    @apply w-16 !important;
}

aside.collapsed .sidebar-label,
aside.collapsed h1,
aside.collapsed #app-version,
aside.collapsed .sidebar-section-title {
    display: none !important;
}

aside.collapsed .p-5 {
    padding: 1.25rem 0 !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 0 !important;
}

aside.collapsed #sidebar-logo-container {
    padding: 0 !important;
    margin: 0 0 0.5rem 0 !important;
    display: flex !important;
    justify-content: center !important;
    width: 100% !important;
}

aside.collapsed #sidebar-collapse-btn {
    display: flex !important;
}

aside.collapsed .nav-link {
    @apply justify-center p-0 w-12 h-12 mx-auto rounded-xl flex items-center !important;
}

aside.collapsed .nav-link i {
    @apply w-5 h-5 block shrink-0 !important;
    margin: 0 auto !important;
}

/* Hide labels and text inside nav-link when collapsed */
aside.collapsed .nav-link .sidebar-label,
aside.collapsed .nav-link span,
aside.collapsed .nav-link .flex-1,
aside.collapsed .nav-link .truncate {
    display: none !important;
}

aside.collapsed .nav-link {
    @apply justify-center p-0 w-12 h-12 mx-auto rounded-xl flex items-center !important;
}

aside.collapsed .nav-link>div {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
}

aside.collapsed .nav-link i,
aside.collapsed .nav-link svg {
    @apply w-5 h-5 block shrink-0 !important;
    margin: 0 auto !important;
}

.dialog-content {
    @apply fixed left-[50%] top-[50%] z-50 flex flex-col w-[90%] max-w-lg translate-x-[-50%] translate-y-[-50%] gap-0 border bg-background shadow-2xl sm:rounded-2xl;
    transform-origin: center center;
    animation: dialog-pop-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.dialog-content.fullscreen {
    @apply w-full h-full max-w-none max-h-none rounded-none left-0 top-0 translate-x-0 translate-y-0 !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

/* Emoji / Flag Visibility Fix */
.flag-icon {
    font-family: "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", "Android Emoji", sans-serif !important;
    font-variant-emoji: emoji !important;
    display: inline-block !important;
    opacity: 1 !important;
    visibility: visible !important;
}

/* Ensure the container of the icon doesn't hide everything but the label */
aside.collapsed .nav-link .sidebar-label,
aside.collapsed .nav-link .sidebar-label-container span,
aside.collapsed .nav-link .sidebar-label-container div:nth-child(2) {
    display: none !important;
}

aside.collapsed .sidebar-label-container {
    padding: 0 !important;
    justify-content: center !important;
}

aside.collapsed .sidebar-label-container>div {
    gap: 0 !important;
}

/* Mobile Tools Menu */
#mobile-tools-menu {
    @apply absolute bottom-full left-0 mb-3 bg-popover border shadow-2xl rounded-2xl p-1 z-[120] flex-col gap-0.5 min-w-[200px] animate-in slide-in-from-bottom-2 duration-200 overflow-hidden;
}

#mobile-tools-menu.hidden {
    display: none !important;
}

#mobile-tools-menu button {
    @apply flex items-center gap-3 px-3 py-2 text-sm hover:bg-accent rounded-md transition-colors;
}

/* Status dots */
#drive-status.active {
    @apply bg-green-500/10 text-green-500;
}

/* Early Auth Check Hide */
html.auth-pre-verified #auth-shield {
    display: none !important;
}

html.auth-pre-verified #app {
    opacity: 1 !important;
}

/* Mobile Sidebar Drawer */
.nav-link-mobile-drawer {
    @apply flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-all text-muted-foreground hover:bg-accent hover:text-accent-foreground;
}

.nav-link-mobile-drawer.active {
    @apply bg-primary/10 text-primary font-bold border-l-4 border-primary;
}

.nav-link-mobile-drawer.active i {
    @apply text-primary;
}

/* Removed redundant absolute positioning for mobile add btn */

#mobile-sidebar-drawer {
    box-shadow: 20px 0 50px rgba(0, 0, 0, 0.2);
}

/* Animations */
.animate-in {
    animation-duration: 200ms;
    animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
    animation-fill-mode: forwards;
}

.slide-in-from-left {
    from {
        transform: translateX(-100%);
    }

    to {
        transform: translateX(0);
    }
}

.slide-in-from-top {
    from {
        transform: translateY(-100%);
    }

    to {
        transform: translateY(0);
    }
}

.animate-out {
    animation-duration: 250ms;
    animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
    animation-fill-mode: forwards;
}

.slide-out-to-left {
    from {
        transform: translateX(0);
    }

    to {
        transform: translateX(-100%);
    }
}

.hidden {
    display: none;
}

/* Forms and Inputs */
input,
select,
textarea {
    @apply transition-all duration-200 outline-none;
}

input:focus,
select:focus,
textarea:focus {
    @apply ring-2 ring-primary/20 border-primary shadow-sm !important;
}

/* Settings Tabs */
.settings-tab {
    @apply flex items-center gap-2 px-3 py-2 text-xs font-medium rounded-md transition-all text-muted-foreground w-full;
}

.settings-tab:hover {
    @apply bg-accent text-accent-foreground;
}

.settings-tab.active {
    @apply bg-background text-foreground shadow-sm border border-border/50;
}

.settings-tab.active i {
    @apply text-primary;
}

/* Toast System - Standard CSS for maximum reliability */
#toast {
    position: fixed;
    bottom: 5rem;
    left: 50%;
    transform: translateX(-50%) translateY(1rem);
    z-index: 500;
    pointer-events: none;
    opacity: 0;
    transition: all 0.3s ease;
    display: flex;
    justify-content: center;
    width: max-content;
}

#toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

#toast div {
    background-color: #18181b;
    /* zinc-900 */
    color: #ffffff;
    padding: 0.75rem 1.5rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    border: 1px solid #27272a;
    /* zinc-800 */
}

.dark #toast div {
    background-color: #f4f4f5;
    /* zinc-100 */
    color: #09090b;
    /* zinc-950 */
    border-color: #e4e4e7;
    /* zinc-200 */
}

/* Fix for logout button visibility */
.text-destructive {
    @apply text-red-500 dark:text-red-400 font-medium;
}

.hover\:bg-destructive:hover {
    @apply bg-red-600 text-white;
}

/* Checklist & Editor Content */
#edit-content ul,
#edit-content ol {
    padding-left: 1.5rem;
    margin-bottom: 1rem;
}

#edit-content ul {
    list-style-type: disc;
}

#edit-content ol {
    list-style-type: decimal;
}

#edit-content li {
    margin-bottom: 0.25rem;
}

/* New Checklist Implementation */
ul.checklist {
    list-style-type: none;
    padding-left: 1.5rem;
}

ul.checklist li {
    position: relative;
    cursor: pointer;
    transition: all 0.2s;
    padding-left: 0.5rem;
}

ul.checklist li::before {
    content: '';
    position: absolute;
    left: -1.3rem;
    top: 0.25rem;
    width: 1.1rem;
    height: 1.1rem;
    border: 2px solid hsl(var(--primary) / 0.3);
    border-radius: 5px;
    background: hsl(var(--background));
    transition: all 0.2s;
}

ul.checklist li[data-checked="true"] {
    @apply line-through opacity-40;
}

ul.checklist li[data-checked="true"]::before {
    @apply bg-primary border-primary;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
    background-size: 85%;
    background-position: center;
    background-repeat: no-repeat;
}

#edit-content a {
    color: #3b82f6 !important;
    /* Vibrant Blue */
    text-decoration: underline;
    font-weight: 500;
}

.dark #edit-content a {
    color: #60a5fa !important;
}

/* Scrollbar Hide for toolbar */
.no-scrollbar::-webkit-scrollbar {
    display: none;
}

.no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
}

@keyframes logo-rainbow {
    0% {
        filter: hue-rotate(0deg) drop-shadow(0 0 5px rgba(255, 255, 255, 0.2));
    }

    100% {
        filter: hue-rotate(360deg) drop-shadow(0 0 5px rgba(255, 255, 255, 0.2));
    }
}

.logo-animate {
    animation: logo-rainbow 8s infinite linear;
}